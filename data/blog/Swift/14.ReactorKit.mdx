---
title: 'ğŸ Swift - ReactorKit'
date: '2022-11-20'
tags: ['Swift']
draft: false
summary: 'í˜‘ì—…ì„ ìœ„í•œ ViewModel ì†”ë£¨ì…˜: ReactorKit'
---

# ReactorKit

ì•±ìŠ¤í† ì–´ì— ë“±ë¡ëœ ì•±ë“¤ì˜ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ í›”ì³ë³´ë©´ ê½¤ë‚˜ ìì£¼ ë³´ì˜€ë˜ ReactorKitì…ë‹ˆë‹¤.

ì‚¬ì‹¤ ë§‰ì—°í•˜ê²Œ React Nativeë‘ ê´€ë ¨ëœê±´ê°€ë³´ë‹¤~ í•˜ê³  ì§€ë‚˜ì¹˜ê³¤ í–ˆì—ˆëŠ”ë°.. ì „í˜€ ì•„ë‹ˆì˜€ì£ ? ğŸ˜œ

ê²¨ìš¸ í”„ë¡œì íŠ¸ ë™ì•ˆ ì‚¬ìš©í•´ì•¼ í•  ê²ƒ ê°™ì•„ì„œ ê³µë¶€í•´ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤!

> ReactorKit

**ReactorKit**ì€ **RxSwift**ë¥¼ ì œëŒ€ë¡œ, ë˜ í¸í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë‚˜ì˜¨ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.

ê³µì‹ githubì— ì„¤ëª…ëœ ê¸€ì„ ì½ì–´ë³´ë©´, ReactorKitì€ **ë¦¬ì•¡í‹°ë¸Œ**í•˜ê³  **ì¼ë°©ì„±**ì„ ê°–ëŠ” Swift ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì§€ì›í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡Œë‹¤ê³  í•©ë‹ˆë‹¤.

ë¦¬ì•¡í‹°ë¸Œí•œê±°ì•¼ RxSwift ê¸°ë°˜ì´ë‹ˆ ê·¸ë ‡ë‹¤ê³  ì¹˜ê³ , **ì¼ë°©ì„±**ì— ì£¼ëª©í•˜ê³  ê³µë¶€ë¥¼ í•´ë³´ë©´ ë˜ê² ë„¤ìš”!

## ê¸°ë³¸ ì»¨ì…‰

![](https://i.imgur.com/utDbuI4.png)

ReactorKitì€ `View`ì™€ `Reactor`ë¼ëŠ” ê²ƒ ì‚¬ì´ë¥¼ ìœ ì €ì˜ `Action`ê³¼ ë·°ì˜ `State`ë¥¼ `Observable stream`ì„ ë§Œë“¤ì–´ ì „ë‹¬í•œë‹¤ê³  í•©ë‹ˆë‹¤.

ë‹¹ìµœ ë¬´ìŠ¨ ë§ì¸ì§€ ì•Œ ìˆ˜ê°€ ì—†ë„¤ìš” ğŸ¤¯

í•˜ë‚˜ì”© ì°¨ê·¼ì°¨ê·¼ ë´…ì‹œë‹¤.

### View

`View`ëŠ” ìš°ë¦¬ê°€ ìƒê°í•˜ëŠ” ê·¸ `View` ìì²´ì…ë‹ˆë‹¤.

í™”ë©´ì„ í‘œì‹œí•˜ëŠ” ëª¨ë“  ìš”ì†Œë“¤ì„ `View`ë¼ê³  í•˜ê³  ì´ `View`ë“¤ì€ ìœ ì €ì˜ ì…ë ¥ì„ action streamìœ¼ë¡œ `bind`í•˜ê±°ë‚˜ ê°ê°ì˜ UI Componentë“¤ì—ê²Œ view statesë¥¼ `bind`í•œë‹¤ê³  í•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‹ˆê¹Œ **1. ìœ ì €ì˜ ì¸í„°ë™ì…˜ì„ ë°›ê±°ë‚˜** **2. í•˜ìœ„ UI Componentë“¤ì—ê²Œ Reactorì˜ ìƒíƒœë¥¼ ì•Œë ¤ì¤€ë‹¤**ëŠ” ëœ»ì¸ ê²ƒ ê°™ë„¤ìš”.

ì´ `View`ì—ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì—†ë‹¤ê³  í•©ë‹ˆë‹¤. ë‹¨ì§€ ì „ë‹¬ìì˜ ì—­í• ë§Œ í•œë‹¤ê³  ë³´ë©´ ë  ê²ƒ ê°™ì•„ìš”!

`View Controller`ê°€ `View`ë¼ëŠ” ê²ƒì„ ëª…ì‹œí•˜ê¸° ìœ„í•´ì„œ `View` í”„ë¡œí† ì½œì„ ì±„íƒí•˜ë¼ê³  í•©ë‹ˆë‹¤.

```swift
class ProfileViewController: UIViewController, View {
  var disposeBag = DisposeBag()
}
```

`View` í”„ë¡œí† ì½œì„ ì±„íƒí•˜ëŠ” ê²ƒ ë§Œìœ¼ë¡œ ì´ ë·°ì»¨ì€ `reactor` í”„ë¡œí¼í‹°ë¥¼ ê°–ê²Œ ë©ë‹ˆë‹¤.

```swift
profileViewController.reactor = UserViewReactor()
```

ìœ„ì™€ ê°™ì€ ì‘ì—…ì´ ìë™ìœ¼ë¡œ ì´ë£¨ì–´ì§„ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

ì´ë ‡ê²Œ ì£¼ì–´ì§„ `reactor`ë¼ëŠ” í”„ë¡œí¼í‹°ê°€ ë³€ê²½ë˜ê²Œ ë˜ë©´, `bind(reactor:)` ë©”ì„œë“œê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤. action streamê³¼ state streamì„ ì •ì˜í•˜ê¸° ìœ„í•´ ë·°ì»¨ ì•ˆì— ì´ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì¤ì‹œë‹¤.

```swift
func bind(reactor: ProfileViewReactor) {
  // action (View -> Reactor)
  refreshButton.rx.tap.map { Reactor.Action.refresh }
    .bind(to: reactor.action)
    .disposed(by: self.disposeBag)

  // state (Reactor -> View)
  reactor.state.map { $0.isFollowing }
    .bind(to: followButton.rx.isSelected)
    .disposed(by: self.disposeBag)
}
```

ìŠ¤í† ë¦¬ë³´ë“œë„ ì§€ì›í•œë‹¤ê³  í•©ë‹ˆë‹¤!

ìŠ¤í† ë¦¬ë³´ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë·°ì»¨ì€ `View`ê°€ ì•„ë‹ˆë¼ `StoryboardView`ë¥¼ ì±„íƒí•´ì•¼ í•©ë‹ˆë‹¤!

```swift
class MyViewController: UIViewController, StoryboardView {
  func bind(reactor: MyReactor) {
    ...
  }
}
```

### Reactor

`Reactor`ëŠ” UIì™€ëŠ” ì „í˜€ ê´€ë ¨ì—†ëŠ” ë…ë¦½ëœ ë ˆì´ì–´ ê³„ì¸µì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ `View`ì˜ ìƒíƒœë¥¼ ê²°ì •í•´ì£¼ëŠ” ì•„ì£¼ ì¤‘ëŒ€í•œ ì—­í• ì„ í•©ë‹ˆë‹¤.

ëª¨ë“  `View`ëŠ” ê°ìì˜ `Reactor`ë¥¼ ê°€ì ¸ì•¼í•˜ê³ , ëª¨ë“  ë¡œì§ì„ ê·¸ `Reactor`ì— ìœ„ì„(delegate)í•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ì„œë„ `Reactor`ëŠ” `View`ì— ëŒ€í•œ ì˜ì¡´ì„±ì´ 1ë„ ì—†ê¸° ë•Œë¬¸ì— Unit Testí•˜ê¸°ì—ë„ ìˆ˜ì›”í•˜ë‹¤ê³  í•˜ë„¤ìš”!

`Reactor`ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `View`ì™€ ë§ˆì°¬ê°€ì§€ë¡œ `Reactor` í”„ë¡œí† ì½œì„ ì±„íƒí•´ì•¼ í•©ë‹ˆë‹¤.

ì´ í”„ë¡œí† ì½œì„ ì±„íƒí•œ ê°ì²´ëŠ” `Action`, `Mutation`, `State` ì„¸ê°€ì§€ íƒ€ì…ì„ ê°€ì ¸ì•¼í•©ë‹ˆë‹¤.

ë˜í•œ `initialState`ë¼ëŠ” í”„ë¡œí¼í‹°ë„ ê°€ì ¸ì•¼ í•œë‹¤ê³  í•©ë‹ˆë‹¤.

```swift
class ProfileViewReactor: Reactor {
  // represent user actions
  enum Action {
    case refreshFollowingStatus(Int)
    case follow(Int)
  }

  // represent state changes
  enum Mutation { 
    case setFollowing(Bool)
  }

  // represents the current view state
  struct State {
    var isFollowing: Bool = false
  }

  let initialState: State = State()
}
```

- Action
ìœ ì € ì¸í„°ë™ì…˜ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

- State
Viewì˜ ìƒíƒœë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

- Mutation
`Action`ê³¼ `State`ë¥¼ ì´ì–´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

`Reactor`ëŠ” ë‘ ë‹¨ê³„ë¥¼ ê±°ì³ action streamì„ state streamìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

![](https://i.imgur.com/yJ9zsoJ.png)

ë°”ë¡œ `mutate()`ì™€ `reduce()`ë¥¼ í†µí•´ì„œì£ .

`mutate()`ëŠ” `Action`ì„ ë°›ì•„ `Observable<Mutation>`ì„ ìƒì„±í•©ë‹ˆë‹¤.

ëª¨ë“  ë¹„ë™ê¸° ì‘ì—…ë“¤ì´ë‚˜ API í˜¸ì¶œ ë“±ì´ ì—¬ê¸°ì— ë“¤ì–´ê°€ëŠ” ì‘ì—…ì´ë¼ê³  í•©ë‹ˆë‹¤.

```swift
func mutate(action: Action) -> Observable<Mutation> {
  switch action {
  case let .refreshFollowingStatus(userID): // receive action
    return UserAPI.isFollowing(userID) // create API stream
      .map { (isFollowing: Bool) -> Mutation in
        return Mutation.setFollowing(isFollowing) // convert to Mutation stream
      }
  case let .follow(userID):
    return UserAPI.follow()
      .map { _ -> Mutation in
        return Mutation.setFollowing(true)
      }
  }
}
```

`reduce()`ëŠ” ì´ì „ì˜ `State`ì™€ `Mutation`ìœ¼ë¡œë¶€í„° ìƒˆë¡œìš´ `State`ë¥¼ ë§Œë“œëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤.

ìƒˆë¡œìš´ `State`ë¥¼ ë™ê¸°ì ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” ê¸°ëŠ¥ ì™¸ì˜ ê¸°ëŠ¥ì€ ë„£ì§€ ë§ë¼ê³  í•˜ë„¤ìš”.

```swift
func reduce(state: State, mutation: Mutation) -> State {
  var state = state // create a copy of old state
  switch mutation {
  case let .setFollowing(isFollowing):
    state.isFollowing = isFollowing // manipulate the state, creating a new state
    return state // return new state
  }
}
```

`transform()`ì€ ê° streamì„ ë‹¤ë¥¸ streamìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê¸°ëŠ¥ì„ í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤.

## ì‹¬í™”

### Global States

Reduxì™€ ë‹¤ë¥´ê²Œ **ReactorKit**ì€ global app stateë¥¼ ì •ì˜í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤.

ì €ëŠ” Reduxê°€ ë­”ì§€ ëª¨ë¥´ë‹ˆ ì¼ë‹¨ ë„˜ì–´ê°€ë³¼ê²Œìš”..

ê·¸ë ‡ê¸° ë•Œë¬¸ì— global stateë¥¼ ì•„ë¬´ê±¸ë¡œë‚˜ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤. `BehaviorSubject`ë‚˜ `PublishSubject`, í˜¹ì€ `reactor`ë¥¼ ì‚¬ìš©í•´ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ê³  í•˜ë„¤ìš”.

ë™ì‹œì— global stateë¥¼ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œí•˜ì§€ë„ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤.

ReactorKitì—ëŠ” **Action â¡ï¸ Mutation â¡ï¸ State Flow**ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ global stateë¥¼ `Mutation`ìœ¼ë¡œ ë³€í™˜í•˜ë ¤ë©´ `transform(mutation:)`ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```swift
var currentUser: BehaviorSubject<User> // global state

func transform(mutation: Observable<Mutation>) -> Observable<Mutation> {
  return Observable.merge(mutation, currentUser.map(Mutation.setUser))
}
```

ìœ„ ì˜ˆì‹œëŠ” `currentUser`ê°€ ë°”ë€” ë•Œ `Mutation.setUser`ë¥¼ ì‹¤í–‰í•´ë‹¬ë¼ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

ê¸°ë³¸ì ì¸ ìŠ¤íŠ¸ë¦¼ì¸ `mutation`ê³¼ Global Stateì˜ `currentUser`ë¥¼ ë³‘í•©(`merge`)ì‹œí‚¤ëŠ” ì½”ë“œì¸ë°ìš”,

`currentUser`ëŠ” `Mutation.setUser`ë¡œ ì •ì˜ëœ `Mutation`ìœ¼ë¡œ ë³€í™˜í•´ì„œ ë“¤ì–´ê°€ê³  ìˆë„¤ìš”.

### View Communication

Viewê°„ì˜ ë°ì´í„° ì „ë‹¬ì´ ì´ë£¨ì–´ì§ˆ ë•Œ ë³´í†µ `delegate` íŒ¨í„´ì´ë‚˜ `closure`ë¥¼ ì‚¬ìš©í•˜ì£ ?

ReactorKitì€ ë°ì´í„° ì „ë‹¬ì— ìœ„ ë‘ ê°€ì§€ ë°©ë²•ì„ ì‚¬ìš©í•˜ì§€ ë§ê³  [reactive extension](https://github.com/ReactiveX/RxSwift/blob/master/RxSwift/Reactive.swift)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤ê³  í•©ë‹ˆë‹¤.

```swift
// Read as "Reactive Extension where Base is a SomeType"
extension Reactive where Base: SomeType {
  // Any specific reactive extension for SomeType
}
```

![](https://i.imgur.com/0zL1XoU.png)

View Aë¥¼ `ChatViewController`, View Bë¥¼ `MessageInputView`ë¼ê³  í•©ì‹œë‹¤.

View BëŠ” View Aì˜ `subview`ì…ë‹ˆë‹¤.

View Bê°€ View Aì— `ControlEvent`ë¥¼ ë³´ë‚´ë©´ View Aì—ì„œ ë³¸ì¸ì˜ reactorì¸ Reactor Aì— `Action`ì„ ì „ë‹¬í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ì…ë‹ˆë‹¤.

ì›ë˜ì˜ ë°©ì‹ëŒ€ë¡œ View Bì—ì„œ View Aë¡œ ì´ë²¤íŠ¸ë‚˜ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ë ¤ë©´ `delegate`ë‚˜ `closure`ë¥¼ ì‚¬ìš©í–ˆì—ˆì£ .

ëŒ€ì‹  ReactorKitì´ ì¶”ì²œí•˜ëŠ” ë°©ì‹ëŒ€ë¡œ `Reactive extension`ì„ ì‚¬ìš©í•´ì„œ êµ¬í˜„ì„ í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```swift
// MessageInputView.swift
extension Reactive where Base: MessageInputView {
  var sendButtonTap: ControlEvent<String> {
    let source = base.sendButton.rx.tap.withLatestFrom(...)
    return ControlEvent(events: source)
  }
}
```

```swift
// ChatViewController.swift
messageInputView.rx.sendButtonTap
  .map(Reactor.Action.send)
  .bind(to: reactor.action)
```
