---
title: 'ğŸ Swift - Property Wrapper'
date: '2022-12-22'
tags: ['Swift']
draft: false
summary: 'í”„ë¡œí¼í‹°ë¥¼ ëª¨ë“ˆí™”í•˜ê³  ì‹¶ë‹¤ë©´'
---

ì˜¤ëŠ˜ì€ UserDefaultsë¥¼ ì–´ë–»ê²Œ í•˜ë©´ ì¡°ê¸ˆì´ë¼ë„ ë” í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œ ê³ ë¯¼í•˜ë‹¤ê°€ ì•„ì£¼ ì¢‹ì€ ì¹œêµ¬ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

ë°”ë¡œ Property Wrapperë¼ëŠ” ì¹œêµ¬ì¸ë°ìš”.

ì´ ì¹œêµ¬ëŠ” SwiftUIì™€ Combineì˜ ê¸°ëŠ¥ì„ UIKitì—ì„œë„ ì ìš©í•  ìˆ˜ ìˆë„ë¡ Swift 5.1ë²„ì „ì— ë“±ì¥í–ˆìŠµë‹ˆë‹¤.

ë§ì€ ê²Œì‹œë¬¼ì—ì„œ SwiftUIì˜ `@State`ë¥¼ ì˜ˆì‹œë¡œ ë“¤ë©° ì„¤ëª…í•˜ê³  ìˆëŠ”ë°, ì €ëŠ” ê²½í—˜ì´ ì—†ì–´ì„œ.. ë„˜ì–´ê°€êµ¬ìš”â€¦

ì´ë¦„ì„ ë³´ë©´ í”„ë¡œí¼í‹°ë¥¼ ê°ì‹¸ì„œ ë­”ê°€ë¥¼ í•˜ëŠ” ì¹œêµ¬ì¸ ê²ƒ ê°™ì£ ?

ë°”ë¡œ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

## ìš©ë„

ì¼ë‹¨ ì–´ë–¤ ê°œë…ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê±´ì§€ë¶€í„° ì•Œì•„ë´…ì‹œë‹¤.

Swiftì—ëŠ” `lazy` í”„ë¡œí¼í‹° ë¼ëŠ” ê²ƒì´ ìˆìŠµë‹ˆë‹¤.

í•´ë‹¹ í”„ë¡œí¼í‹°ê°€ ì‚¬ìš©ë  ë•Œ ë¡œë“œë¥¼ ì‹œì‘í•˜ë„ë¡ í•´ì£¼ëŠ” í‚¤ì›Œë“œì´ì£ .

ì´ `lazy` í‚¤ì›Œë“œëŠ” ëª¨ë“  í‚¤ì›Œë“œë“¤ì— ë¶™ì¼ ìˆ˜ ìˆê³  ë™ì¼í•œ ë™ì‘ì„ í•©ë‹ˆë‹¤.

ë§Œì•½ ì´ í‚¤ì›Œë“œê°€ ì—†ë‹¤ë©´ í•´ë‹¹ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œ ì–´ë–¤ ê³¼ì •ì„ ë°Ÿê²Œ ë ê¹Œìš”?

```swift
func getMyClass() -> MyClass {
  if self.myVar == nil {
    self.myVar = MyClass()
  }
  return self.myVar
}
```

ìœ„ì™€ ê°™ì´ í•´ë‹¹ í”„ë¡œí¼í‹°ê°€ ì´ˆê¸°í™”ê°€ ëëŠ”ì§€ í™•ì¸ì„ í•œ í›„ì— ê°’ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ëª¨ë“  í”„ë¡œí¼í‹°ì— ì§ì ‘ êµ¬í˜„í•˜ë©° ì ìš©ì‹œì¼œì£¼ì–´ì•¼ í•  ê±°ì—ìš”.

ë‹¤í–‰íˆë„ ìœ„ ë™ì‘ì„ ìš°ë¦¬ëŠ”

```swift
lazy var myClass = MyClass()
```

ì´ë ‡ê²Œ ê°„í¸í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Property WrapperëŠ” `lazy`ì™€ ê°™ì´ ë™ì¼í•œ ë™ì‘ì„ í•˜ëŠ” í”„ë¡œí¼í‹°ë“¤ì— ëŒ€í•´ì„œ ê³µí†µì ìœ¼ë¡œ ë¯¸ë¦¬ êµ¬í˜„ëœ ë™ì‘ë“¤ì„ ë¶€ì—¬í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

## ì •ì˜

í”„ë¡œí¼í‹°ë¥¼ ê°ì‹¸ëŠ” ê¸°ëŠ¥ì´ê¸° ë•Œë¬¸ì— ìš°ì„  í”„ë¡œí¼í‹°ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆëŠ” class, struct, enum ì•ì— `@propertyWrapper`ë¥¼ ë¶™ì—¬ ì •ì˜í•©ë‹ˆë‹¤.

ì˜ˆì‹œë¡œ UserDefaultsë¡œ ìë™ìœ¼ë¡œ ë™ê¸°í™” ì‘ì—…ì„ í•˜ëŠ” í”„ë¡œí¼í‹°ë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.

```swift
@propertyWrapper
struct UserDeafult<T> {
  var key: String
  var defaultValue: T
}
```

ê·¸ëŸ°ë° ì´ë ‡ê²Œê¹Œì§€ë§Œ í•˜ë©´ í•´ë‹¹ í”„ë¡œí¼í‹°ì— ë³€ê²½ì´ ìˆì„ ë•Œë§ˆë‹¤ ì–´ë–¤ ì‘ì—…ì´ ì‹¤í–‰ë˜ëŠ”ì§€ì— ëŒ€í•œ ëª…ì‹œê°€ ì—†ì£ .

ê·¸ë˜ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ê³ , ê·¸ ì—ëŸ¬ë¥¼ ì‚´í´ë³´ë©´ `wrappedValue`ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`wrappedValue`ë¥¼ ì •ì˜í•´ì£¼ê³ , `get-set`ì„ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ í”„ë¡œí¼í‹°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë°œìƒí•˜ëŠ” ë¡œì§ì„ ë„£ì–´ì¤ë‹ˆë‹¤.

```swift
var wrappedValue: T {
  get {
    UserDefaults.standard.object(forKey: key) as? T ?? defaultValue
  }
  set {
    UserDefaults.standard.set(newValue, forKey: key)
  }
}
```

ì´ì œ í•©ì³ë³¼ê¹Œìš”?

```swift
@propertyWrapper
struct UserDefault<T> {
  var key: String
  var defaultValue: T

  var wrappedValue: T {
    get {
      UserDefaults.standard.object(forKey: key) as? T ?? defaultValue
    }
    set {
      UserDefaults.standard.get(newValue, forKey: key)
    }
  }
}
```

## ì‚¬ìš©

ì ê·¸ëŸ¼ ì ìš©ì€ ì–´ë–»ê²Œ í• ê¹Œìš”?

`lazy`ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì•ì— ëª…ì‹œí•´ì£¼ë©´ ë©ë‹ˆë‹¤.

```swift
struct AppData {
  @UserDefault(key: "isLoggedIn", defaultValue: false)
  static var isLoggedIn: Bool

  @UserDefault(key: "username", defaultValue: "")
  static var username: String
}

AppData.isLoggedIn = true
print(AppData.isLoggedIn) // true

print(AppData.username) // ""
```

ì¡°ê¸ˆ ë” ë‚˜ì•„ê°€ì„œ ì»¤ìŠ¤í…€ íƒ€ì…ì—ë„ ì ìš©ë  ìˆ˜ ìˆë„ë¡ ë°”ê¿”ë´…ì‹œë‹¤.

```swift
@propertyWrapper
struct UserDefault<T: Codable> {
  // keyì™€ default ê°’ì€ ë°”ë€” ì¼ì´ ì—†ìœ¼ë‹ˆ letìœ¼ë¡œ ë³€ê²½
  private let key: String
  private let defaultValue: T

  init(key: String, defaultValue: T) {
    self.key = key
    self.defaultValue = defaultValue
  }

  var wrappedValue: T {
    get {
      guard let data = Userdefaults.standard.object(forKey: key) as? Data else {
        return defaultValue
      }
      let value = try? JSONDecoder().decode(T.self, from: data)
      return value ?? defaultValue
    }
    set {
      let data = try? JSONEncoder().encode(newValue)
      UserDefaults.standard.set(data, forKey: key)
    }
  }
}
```

ì´ë ‡ê²Œ ìë™ìœ¼ë¡œ `UserDefaults`ë¡œ ê°’ì„ ë™ê¸°í™”ì‹œì¼œì£¼ëŠ” Property Wrapperë¥¼ ë§Œë“¤ê³  ì ìš©í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

## ì°¸ê³  ê²Œì‹œë¬¼

[# Create the Perfect UserDefaults Wrapper Using Property Wrapper](https://medium.com/better-programming/create-the-perfect-userdefaults-wrapper-using-property-wrapper-42ca76005ac8)
