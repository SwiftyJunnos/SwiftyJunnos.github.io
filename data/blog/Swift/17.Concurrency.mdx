---
title: 'ðŸŽ Swift - Concurrency'
date: '2023-03-09'
tags: ['Swift']
draft: false
summary: 'ë‚´ ì½”ë“œë¥¼ ë³„ë„ í¬ìž¥'
---

# Concurrency

WWDC21ì˜ ì£¼ìš” ì£¼ì œëŠ” Concurrencyë¼ê³  ìƒê°í•©ë‹ˆë‹¤.

21ë…„ì— ì²˜ìŒ ê³µê°œëœ í›„ ê´€ë ¨ëœ í¬ìŠ¤íŠ¸ë„ ë§Žì•„ì¡Œê³  ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œë„ ëŒ€ì‘ ì—…ë°ì´íŠ¸ê°€ ë§Žì´ ì´ë£¨ì–´ì§„ ìƒí™©ìž…ë‹ˆë‹¤.

ì´ì œ ìŠ¬ìŠ¬ ì‹¤ë¬´ì— ì‚¬ìš©ë˜ëŠ” ëª¨ìŠµë“¤ë„ ë³´ì´ê¸° ì‹œìž‘í•˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ì–´ë ´í’‹ì´ `â€œasync`ì™€ `await`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¬¸ë²•ì´ë‹¤.â€ ì •ë„ë¡œë§Œ ì•Œì•„ë‘ê³  ë‚˜ì¤‘ì— ê³µë¶€í•´ì•¼ê² ë‹¤ ìƒê°í–ˆì§€ë§Œ í”„ë¡œì íŠ¸ì—ì„œ `callback` ì§€ì˜¥ì„ ë³¸ ìˆœê°„.. í•™êµ¬ì—´ì´ ì˜¬ë¼ í•œ ë²ˆ í•™ìŠµí•´ë´¤ìŠµë‹ˆë‹¤.

WWDC21ì˜ ì„¸ì…˜ë“¤ì„ ì‚´íŽ´ë³´ì•˜ë”ë‹ˆ ê´€ë ¨ ì„¸ì…˜ë§Œ ê±°ì˜ 10ê°œì— ë‹¬í•˜ê³  í•˜ë‚˜í•˜ë‚˜ì˜ ë‚´ìš©ë“¤ë„ ê½‰ ì°¬ 20~30ë¶„ ì •ë„ë¥¼ ì´ë£¨ê³  ìžˆë”êµ°ìš”..

ê·¸ëž˜ì„œ ë‚´ìš©ì´ ë¬´ì§€ë¬´ì§€ ë§ŽìŠµë‹ˆë‹¤.. ðŸ« 

## ë¹„ë™ê¸° í”„ë¡œê·¸ëž˜ë°

**ë¹„ë™ê¸° ì½”ë“œ**ëŠ” **â€œë‚˜ì¤‘ì— ì–¸ì  ê°€ í˜¸ì¶œë˜ì–´ ì‹¤í–‰ë  ì½”ë“œâ€** ìž…ë‹ˆë‹¤.

ê·¸ ì‹œê¸°ëŠ” ë³´ìž¥ë˜ì§€ ì•Šìœ¼ë©° ìˆœì„œ ë˜í•œ ë³´ìž¥ë˜ì§€ ì•Šì„ ë•Œë„ ìžˆìŠµë‹ˆë‹¤.

Swiftì—ì„œëŠ” ìš°ë¦¬ê°€ í”ížˆ **GCD**ë¼ê³  ë¶€ë¥´ëŠ” `DispatchQueue`ë¥¼ í†µí•´ ì§€ì›í•˜ëŠ” ê°œë…ì´ì˜€ì£ .

```swift
print("1")
DispatchQueue.main.async {
  print("2")
}
print("3")
```

ìœ„ ì½”ë“œì˜ `print("2")` êµ¬ë¬¸ì€ ë¹„ë™ê¸° ì½”ë“œìž…ë‹ˆë‹¤.

ë”°ë¼ì„œ ìˆœì„œì™€ í˜¸ì¶œ ì‹œê¸°ê°€ ë¶ˆí™•ì‹¤í•©ë‹ˆë‹¤.

ë°”ë¡œ í˜¸ì¶œë ìˆ˜ë„ ìžˆê³  ì•„ë‹ìˆ˜ë„ ìžˆì£ .

> 1 2 3

> 1 3 2

ê·¸ëž˜ì„œ ìœ„ì™€ ê°™ì´ **ì‹¤í–‰ë§ˆë‹¤ ê²°ê³¼ê°€ ë‹¤ë¥¼ìˆ˜ë„** ìžˆìŠµë‹ˆë‹¤.

ë¹„ë™ê¸°ì½”ë“œëŠ” **1. í•´ë‹¹ ë¼ì¸ì— ë„ë‹¬ë˜ë„ ë°”ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šê³ **, **2. ì´í›„ì— ìžˆëŠ” ì½”ë“œì˜ ì‹¤í–‰ì„ Blockingí•˜ì§€ë„ ì•ŠìŠµ**ë‹ˆë‹¤.

ë¹„ë™ê¸° ì½”ë“œê°€ ì–¸ì œ ì‹¤í–‰ë˜ëŠ”ì§€ ëª¨ë¥¸ë‹¤ë©´, ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‚°ì¶œëœ ì–´ë–¤ ê°’ì„ ì–¸ì œ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?

ë‹¤í–‰ížˆë„ ë¹„ë™ê¸° ì½”ë“œê°€ **ì¢…ë£Œë˜ëŠ” ì‹œì **ì€ ìš°ë¦¬ê°€ ì•Œ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

**`@escaping` í´ë¡œì €**ë¥¼ í†µí•´ì„œìš”.

```swift
func foo() {
  print("1")
  asyncFoo(completion: { value in
    print(value)
  })
  print("3")
}

func asyncFoo(completion: @escaping (String) -> Void) {
  DispatchQueue.main.async {
    let a = "2"
    completion(a)
  }
}
```

`asyncFoo` ë©”ì„œë“œì—ì„œ `completion` í´ë¡œì €ëŠ” `async` í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ëŠ” ì‹œì ì— í˜¸ì¶œë˜ì–´ ì½œëŸ¬ì¸ `foo` ë©”ì„œë“œì— `String` íƒ€ìž… íŒŒë¼ë¯¸í„° `value`ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ì´ëŸ° ë°©ì‹ì˜ ë¬¸ë²•ì€ ì–´ë–¤ í•¨ìˆ˜ê°€ ëë‚¬ì„ ë•Œì˜ ë™ìž‘ë“¤ì˜ ë¬¶ìŒì„ ëª…ì‹œì ìœ¼ë¡œ ëª¨ì•„ë‘˜ ìˆ˜ ìžˆë‹¤ëŠ” ìž¥ì ì´ ìžˆì§€ë§Œ *(ìž¥ì ì¸ê°€..?)* `callback` ì§€ì˜¥ê³¼ ì½”ë“œ ê°€ë…ì„±ì´ ë–¨ì–´ì§„ë‹¤ëŠ” ë¬¸ì œì ì„ ê°€ì§‘ë‹ˆë‹¤.

### GCDì˜ ì§„ì§œ ë¬¸ì œì 

ì½”ë“œì˜ ê°€ë…ì„±ê³¼ ê°œë°œìžì—ê²Œ ì£¼ëŠ” ë¶ˆì¾Œí•œ ê²½í—˜ë„ ì¤‘ìš”í•˜ì§€ë§Œ GCDì—ëŠ” ë”ìš± í¬ë¦¬í‹°ì»¬í•œ ë‹¨ì ì´ ì¡´ìž¬í•©ë‹ˆë‹¤.

ë°”ë¡œ **CPUì˜ ë¶ˆí•„ìš”í•œ ì¶”ê°€ ë™ìž‘**ê³¼ **ê³¼ë„í•œ ë¦¬ì†ŒìŠ¤ì˜ ì‚¬ìš©**ì„ ìœ ë°œí•  ìˆ˜ ìžˆë‹¤ëŠ” ì ìž…ë‹ˆë‹¤.

ì´ê²Œ ë¬´ìŠ¨ ë§ì¸ì§€ ì‚´íŽ´ë³¼ê¹Œìš”?

DispatchQueueì— ë™ìž‘ì´ enqueueë˜ë©´, ì‹œìŠ¤í…œì€ í•´ë‹¹ ìž‘ì—…ì´ ìˆ˜í–‰ë  **ì“°ë ˆë“œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆ˜í–‰**ì‹œí‚µë‹ˆë‹¤.

ë§Œì•½ ë¬´ìˆ˜ížˆ ë§Žì€ ë™ìž‘ë“¤ì´ enqueueë˜ë©´, ì‹œìŠ¤í…œì€ í•´ë‹¹ ë™ìž‘ë“¤ì„ ë™ì‹œì— ìˆ˜í–‰í•˜ê¸° ìœ„í•´ **ì“°ë ˆë“œë¥¼ ê³„ì†í•´ì„œ** ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. CPUì˜ ì½”ì–´ê°€ ë” ì´ìƒì˜ ì“°ë ˆë“œ ìž‘ì—…ì„ ì¶”ê°€í•  ìˆ˜ ì—†ì„ ë•Œê¹Œì§€ìš”.

![](https://i.imgur.com/wFvTBDv.png)

> ì½”ì–´ê°€ 2ê°œì¸ í™˜ê²½ì—ì„œ ì“°ë ˆë“œë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ìƒí™©

í•˜ë‚˜ì˜ ì½”ì–´ê°€ ì—¬ëŸ¬ê°œì˜ ì“°ë ˆë“œë¥¼ ê°€ì§€ê³  ìžˆëŠ” ì´ìœ ëŠ” ì—¬ëŸ¬ê°€ì§€ìž…ë‹ˆë‹¤.

1. í•˜ë‚˜ì˜ ì“°ë ˆë“œê°€ Blockë˜ë”ë¼ë„ **ì½”ì–´ê°€ ì‰¬ì§€ì•Šê³  ë‹¤ë¥¸ ì“°ë ˆë“œì˜ ìž‘ì—…**ì„ í•  ìˆ˜ ìžˆë„ë¡ í•˜ê¸° ìœ„í•´
2. ì“°ë ˆë“œê°„ì˜ **Race Conditionì„ í•´ê²°**í•˜ê¸° ìœ„í•´ (Semaphore ì°¸ê³ )

ê·¸ëŸ°ë° ê³¼ì—° Blockingëœ ì“°ë ˆë“œê°€ ë§Žì•„ì§„ë‹¤ê³  ì“°ë ˆë“œë¥¼ ë¬´ìˆ˜ížˆ ë§Žì´ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ í•­ìƒ ì¢‹ì„ê¹Œìš”?

![](https://i.imgur.com/yQLmP2Y.png)

ë‹¹ì—°ížˆ ì•„ë‹ˆê² ì£ ..

ì“°ë ˆë“œë“¤ì´ Blockingëœ ìƒíƒœì—ì„œ ì¶”ê°€ì ìœ¼ë¡œ ì“°ë ˆë“œë¥¼ ê³„ì† ë¶ˆëŸ¬ì˜¨ë‹¤ë©´, ë” ì´ìƒ ì½”ì–´ê°€ ì“°ë ˆë“œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ëŠ” ìƒíƒœê°€ ë©ë‹ˆë‹¤.

í•´ë‹¹ í˜„ìƒì„ **Thread Explosion**ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

> SwiftëŠ” ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `DispatchSemaphore`ì™€ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìžˆê¸°ëŠ” í•©ë‹ˆë‹¤. ë¬¸ì œëŠ” ì‚¬ìš©í•˜ê¸°ì— ë„ˆë¬´ ë²ˆê±°ë¡­ë‹¤ëŠ” ê²ƒì´ì£ ..!

Thread Explosion í˜„ìƒì´ ë°œìƒí•˜ë©´ OSëŠ” ì—¬ëŸ¬ ë¬¸ì œë¥¼ ë§ˆì£¼ì¹©ë‹ˆë‹¤.

![](https://i.imgur.com/oTDfwu0.png)

- **ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ**

Blockëœ ì“°ë ˆë“œëŠ” ê°ìž **ë©”ëª¨ë¦¬ì™€ ë¦¬ì†ŒìŠ¤ë¥¼ ì ê±°**í•˜ê³  ìžˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì“°ë ˆë“œì˜ unlockì„ ìœ„í•´ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì ê±°í•˜ê³  ìžˆì„ ìˆ˜ë„ ìžˆì£ .

![](https://i.imgur.com/MrBlrHa.png)

- **ìŠ¤ì¼€ì¤„ë§ ì˜¤ë²„í—¤ë“œ**

CPUì˜ ì½”ì–´ëŠ” ì“°ë ˆë“œê°„ì˜ ì „í™˜ì„ ìœ„í•´ **ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­(Context Switching)** ì´ë¼ëŠ” ìž‘ì—…ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ì“°ë ˆë“œê°€ í­ë°œì ìœ¼ë¡œ ë§Žì•„ì§€ë©´ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ë„ ë¹ˆë²ˆížˆ ì¼ì–´ë‚˜ ë¶ˆí•„ìš”í•œ ìž‘ì—…ì´ ëŠ˜ì–´ë‚©ë‹ˆë‹¤.

ìž ê·¸ëž˜ì„œ SwiftëŠ” ì´ëŸ° í˜„ìƒì„ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠëƒ?

## async / await

ìƒˆë¡œìš´ Swiftì˜ **asynchronous** ê°œë… `async` / `await`ì™€ **concurrency**ë¥¼ í†µí•´ì„œì£ .

ì‹¤ì€ ë©€í‹° ì“°ë ˆë”©ì˜ ì´ëŸ¬í•œ ì˜¤ë²„í—¤ë“œë“¤ì€ ì´ì „ë¶€í„° ë‹¤ì–‘í•œ ì–¸ì–´ì™€ ìš´ì˜ì²´ì œ ì „ë¬¸ê°€ë“¤ì—ê²Œ ë¬¸ì œì‹œ ë˜ì–´ì™”ìŠµë‹ˆë‹¤.

ì´ë“¤ì´ ì œì‹œí•œ ë°©ë²•ì€ ë°”ë¡œ **Coroutine** ë°©ì‹ì´ì˜€ìŠµë‹ˆë‹¤.

ì˜¤ëž˜ì „ ë©€í‹°ì“°ë ˆë”© ë°©ì‹ì´ ì œì‹œë˜ê³  í†µìš©ë˜ê¸° ì‹œìž‘í•˜ë©° ìžì—°ìŠ¤ëŸ½ê²Œ ë²„ë ¤ì¡Œë˜ Coroutine ë°©ì‹ì´ í˜„ëŒ€ì— ì™€ì„œ ë‹¤ì‹œ ì—°êµ¬ë˜ê³  ë°œì „í•˜ê³  ìžˆì£ .

ì‹¤ì œë¡œ Python, Kotlinê³¼ ê°™ì€ ì–¸ì–´ë“¤ì´ ì ê·¹ì ìœ¼ë¡œ Coroutine ë°©ì‹ì„ ì‚¬ìš©í•˜ê³  ìžˆìŠµë‹ˆë‹¤.

ê·¸ëž˜ì„œ Coroutine ë°©ì‹ì€ ì–´ë–¤ ë°©ì‹ì´ëƒ?

**ì½”ë£¨í‹´(Coroutine)** ì€ **CPUì˜ ì½”ì–´ ê°œìˆ˜ë§Œí¼**ë§Œ ì“°ë ˆë“œë¥¼ ë§Œë“¤ê³  ì“°ë ˆë“œë¥¼ ì°¨ë‹¨í•˜ëŠ” ëŒ€ì‹  **ìž‘ì—…ì„ ë§‰ì•„ë‘ **ìœ¼ë¡œì¨ **ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ì„ ì°¨ë‹¨**í•©ë‹ˆë‹¤.

![](https://i.imgur.com/G8fVpID.png)

Swift ìš©ì–´ë¡œ ë°”ê¾¸ì–´ë³¼ê¹Œìš”?

Swift **Concurrency**ëŠ” **ì“°ë ˆë“œì˜ ì°¨ë‹¨(Blocking)ì„ ì—†ì• **ê³  ìž‘ì—…ì˜ ìž¬ì‹¤í–‰(Resumption of Work)ë¥¼ ì¶”ì í•˜ëŠ” `continuation`ì´ë¼ëŠ” ê°ì²´ë¥¼ í†µí•´ Context Switching ëŒ€ì‹  **ê°™ì€ ì“°ë ˆë“œ ë‚´ì—ì„œ Continuation Switchingì„ ìˆ˜í–‰**í•˜ì—¬ ë™ì‹œì„± í”„ë¡œê·¸ëž˜ë°ì„ ì§€ì›í•©ë‹ˆë‹¤.

ìž Concurrencyê°€ *(ëª¨ìˆœì ì´ê²Œë„)* í˜„ëŒ€ì ì´ê³  ì¢‹ë‹¤ëŠ” ê±´ ì•Œì•˜ì–´ìš”.

ê·¸ëž˜ì„œ `async` / `awaitì€` ì–´ë–»ê²Œ ì‚¬ìš©í• ê¹Œìš”? ðŸ˜’

WWDCì—ì„œë„ ì‚¬ìš©í•œ ê¸°ì¡´ì˜ `@escaping` í´ë¡œì €ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œë¥¼ ê°€ì ¸ì™€ë´¤ì–´ìš”.

![](https://i.imgur.com/BJ4S8qO.png)

ì‹œìŠ¤í…œì ì¸ ë‹¨ì  ë§ê³  ì½”ë“œ ìž‘ì„±ì˜ ì¸¡ë©´ì—ì„œ `@escaping` í´ë¡œì € ë°©ì‹ì€ ì„¸ê°€ì§€ ë‹¨ì ì„ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤.

1. `completion` í´ë¡œì € í˜¸ì¶œì„ ê¹Œë¨¹ê¸° ì‰½ìŠµë‹ˆë‹¤. (ì—¬ëŸ¬êµ°ë°ì— í•„ìš”)
2. callbackì´ ì¤‘ì²©í•´ì„œ ë°œìƒí•˜ëŠ” ê²½ìš°ê°€ ë§ŽìŠµë‹ˆë‹¤.
3. ì½”ë“œ ê°€ë…ì„±ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤.

ìž ê·¸ëŸ°ë° `async` / `awaitë¥¼` ì‚¬ìš©í•œ ì½”ë“œë¡œ ë°”ê¿”ë³´ë©´ìš”?

![](https://i.imgur.com/5VqRh34.png)

ì—„ì²­ ì§§ì•„ì§€ê³  ìˆ˜ë§Žì•˜ë˜ ì¤‘ê´„í˜¸ë“¤ì´ ì‚¬ë¼ì¡Œì–´ìš”! ðŸ‘

### async

í•¨ìˆ˜ì˜ íŒŒë¼ë¯¸í„°ì™€ ë°˜í™˜íƒ€ìž… ì¤‘ê°„ì— `async` ë¥¼ ë¶™ì—¬ì¤Œìœ¼ë¡œì¨ **í•´ë‹¹ í•¨ìˆ˜ê°€ ë¹„ë™ê¸°ì **ì´ë‹¤ ë¼ëŠ” ê²ƒì„ ë‚˜íƒ€ë‚´ì¤ë‹ˆë‹¤!

`throws`ë¥¼ í†µí•´ í•´ë‹¹ í•¨ìˆ˜ê°€ ì—ëŸ¬ë¥¼ ë°©ì¶œí•  ìˆ˜ ìžˆë‹¤ë¼ëŠ” ê²ƒë„ í•¨ê»˜ ëª…ì‹œí•´ì¤„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### await

`async`ë¡œ ì •ì˜ëœ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” **Concurrent Context ë‚´ë¶€**ì—ì„œ `await` í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

```swift
let (data, response) = try await URLSession.shared.data(for: request)
```

ì£¼ì˜í•  ì ì€ ì •ì˜í• ë•ŒëŠ” ìˆœì„œê°€ `async throws`ì§€ë§Œ, ì‚¬ìš©í• ë•ŒëŠ” `try await` ìˆœì„œë¼ëŠ” ê²ƒì„ ì•Œì•„ë‘ì–´ì•¼í•©ë‹ˆë‹¤.

`await` í‚¤ì›Œë“œëŠ” í•´ë‹¹ ë¼ì¸ì´ **Suspension Point**ë¼ëŠ” ê²ƒì„ ëª…ì‹œí•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

### Suspend

`await` í¬ì¸íŠ¸ë¥¼ ë§Œë‚˜ë©´ ëœë‹¤ëŠ” SuspendëŠ” ë˜ ë­˜ê¹Œìš”?

**Suspend**ëŠ” **â€œí•´ë‹¹ ìŠ¤ë ˆë“œê°€ ë‹¤ë¥¸ ë™ìž‘ì„ ìˆ˜í–‰í•  ìˆ˜ ìžˆë„ë¡ ìŠ¤ë ˆë“œì˜ í†µì œê¶Œì„ ì‹œìŠ¤í…œì—ê²Œ ë„˜ê²¨ì¤€ë‹¤â€** ë¼ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

![](https://i.imgur.com/tmlzOQQ.png)

ì¼ë°˜ì ì¸ **synchronous**í•œ ì½”ë“œì˜ ê²½ìš°ì—ëŠ” ìœ„ì™€ ê°™ì´ ë™ìž‘í•©ë‹ˆë‹¤.

`fetchThumbnail` í•¨ìˆ˜ì—ì„œ `thumbnailURLRequest` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ìžˆìŠµë‹ˆë‹¤.

ì´ ë•Œ ë‘ í•¨ìˆ˜ ëª¨ë‘ sync í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— `fetchThumbnail` í•¨ìˆ˜ëŠ” `thumbnailURLRequest` í•¨ìˆ˜ì—ê²Œ **ì“°ë ˆë“œ ì œì–´ê¶Œì„ ë„˜ê²¨ì¤ë‹ˆë‹¤.**

`thumbnailURLRequest` í•¨ìˆ˜ëŠ” ìˆ˜í–‰ì— ì–¼ë§ˆë‚˜ ë§Žì€ ì‹œê°„ì´ ê±¸ë¦¬ë˜ ì“°ë ˆë“œë¥¼ ì ìœ í•˜ê³  ìž‘ì—…ì´ ì™„ë£Œë˜ë©´ **ì œì–´ê¶Œ**ì„ ë‹¤ì‹œ Callerì¸ `fetchThumbnail` í•¨ìˆ˜ì—ê²Œ ëŒë ¤ì¤ë‹ˆë‹¤.

ì´ ê²½ìš° ì“°ë ˆë“œëŠ” ì´ ë‘ ìž‘ì—… ì™¸ì˜ **ë‹¤ë¥¸ ìž‘ì—…ë“¤ì„ ìˆ˜í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**

![](https://i.imgur.com/blAu5WR.png)

**asynchronous**í•œ ê²½ìš°ì—ëŠ” ì–´ë–¨ê¹Œìš”?

`fetchThumbnail` í•¨ìˆ˜ê°€ `data(for: request)` í•¨ìˆ˜ì—ê²Œ ì“°ë ˆë“œ ì œì–´ê¶Œì„ ë„˜ê²¨ì£¼ëŠ” ê²ƒê¹Œì§€ëŠ” ë™ì¼í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ `await`ë¡œ ëª…ì‹œëœ `data(for: request)` í•¨ìˆ˜ëŠ” **async í•¨ìˆ˜**ì´ê¸° ë•Œë¬¸ì— ì¤‘ê°„ì— **suspend** ë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

`async` í•¨ìˆ˜ê°€ suspendë˜ë©´, **ì“°ë ˆë“œ ì œì–´ê¶Œ**ì€ ë‹¤ë¦„ì•„ë‹Œ **ì‹œìŠ¤í…œ**ì—ê²Œ ë„˜ê²¨ì§‘ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ ì‹œìŠ¤í…œì€ ë‹¤ë¥¸ ìž‘ì—…ì„ í•  ìˆ˜ ìžˆê²Œ ë˜ëŠ” ê²ƒì´ì£ .

ì‹œìŠ¤í…œì€ **ì•Œì•„ì„œ** suspend ë˜ê±°ë‚˜ ìˆ˜í–‰ì´ í•„ìš”í•œ ë‹¤ë¥¸ ìž‘ì—…ë“¤ì˜ ìš°ì„ ìˆœìœ„ë“¤ì„ íŒë‹¨í•´ê°€ë©° ì²˜ë¦¬í•´ë‚˜ê°‘ë‹ˆë‹¤.

ì‹œìŠ¤í…œì´ suspend ë˜ì—ˆë˜ í•¨ìˆ˜ì˜ ì²˜ë¦¬ê°€ í•„ìš”í•´ì¡Œë‹¤ê³  íŒë‹¨í•˜ëŠ” ìˆœê°„, ì“°ë ˆë“œ ì œì–´ê¶Œì€ ë‹¤ì‹œ `async` í•¨ìˆ˜ì˜€ë˜ `data(for: request)` í•¨ìˆ˜ì—ê²Œ ìž¬ê°œ(resume)ë˜ê³  ì´í›„ì˜ ìž‘ì—…ë“¤ì´ ìˆ˜í–‰ë  ìˆ˜ ìžˆê²Œ ë©ë‹ˆë‹¤.

ìž ë‹¤ì‹œ ëŒì•„ê°€ì„œ Suspendê°€ ì´ë£¨ì–´ì§€ëŠ” ê³¼ì •ì„ ìžì„¸ížˆ ì‚´íŽ´ë³¼ê²Œìš”.

![](https://i.imgur.com/OlVlEgJ.png)

**Synchronous**í•œ í•¨ìˆ˜ì˜ ê²½ìš° ë©”ëª¨ë¦¬ì˜ **ìŠ¤íƒ ì˜ì—­**ì— í•¨ìˆ˜ë“¤ì´ `push` ë˜ë©° ìŒ“ì´ê²Œ ë©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‹¤ê°€ í•¨ìˆ˜ì˜ ì‹¤í–‰ì´ ëë‚˜ë©´ `pop` ë˜ì–´ ìŠ¤íƒì—ì„œ ì œê±°ë˜ì£ .

ì•„ì£¼ ê°„ë‹¨ëª…ë£Œí•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ **asynchronous**í•œ ê²½ìš°ì—ëŠ” ì–´ë–¨ê¹Œìš”?

![](https://i.imgur.com/kXukxOi.png)

`async` í•¨ìˆ˜ë¼ê³  ëª…ì‹œë˜ì–´ ìžˆëŠ” ê²½ìš°, scope ì „ì²´ë¥¼ í•œ ë²ˆ ëŒë©° **suspension point** (`await`) ë§ˆë‹¤ **ì–´ë–¤ ë³€ìˆ˜**ê°€ ì—¬ëŸ¬ ì“°ë ˆë“œì—ì„œ ì‚¬ìš©ë˜ëŠ”ì§€ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.

ì˜ˆì‹œì˜ ê²½ìš°, `id`ì™€ `particle`ì€ ì“°ë ˆë“œ ì‚¬ì´ë¥¼ ì˜¤ê°ˆ í•„ìš”ê°€ ì—†ëŠ” **local ë³€ìˆ˜**ì´ì£ ?

ë”°ë¼ì„œ í•´ë‹¹ ë³€ìˆ˜ë“¤ì€ synchronous í•¨ìˆ˜ì˜ ê²½ìš°ì™€ ë§ˆì°¬ê°€ì§€ë¡œ **ìŠ¤íƒ ì˜ì—­**ì— ì €ìž¥ë©ë‹ˆë‹¤.

![](https://i.imgur.com/hVDxMMn.png)

ê·¸ë ‡ë‹¤ë©´ `await`ì—ì„œ ì‚¬ìš©ëœ `newArticles` ë³€ìˆ˜*(íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•˜ê¸° ë•Œë¬¸ì— ìƒìˆ˜ì´ì§€ë§Œ íŽ¸ì˜ìƒ ë³€ìˆ˜ë¼ê³  í•˜ê² ìŠµë‹ˆë‹¤.)*ì˜ ê²½ìš°ëŠ” ì–´ë–¨ê¹Œìš”?

suspendë˜ëŠ” ì½”ë“œëŠ” ìž ê¹ ë©ˆì¶°ìžˆë‹¤ê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ì•¼í•˜ê¸° ë•Œë¬¸ì— í•„ìš”í•œ ë³€ìˆ˜ë“¤ì„ ë©ˆì¶”ê¸° **ì´ì „ê³¼ ì´í›„ ëª¨ë“  ì‹œì ì— ì‚¬ìš©**í•  ìˆ˜ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤.

SwiftëŠ” ì´ë¥¼ ìœ„í•´ **Heap ì˜ì—­**ì„ í™œìš©í•©ë‹ˆë‹¤.

![](https://i.imgur.com/zt4JmwU.png)

`add` í•¨ìˆ˜ë¥¼ íž™ ì˜ì—­ì— ì €ìž¥í•˜ê³  ë‚˜ë©´ ìŠ¤íƒ ì˜ì—­ì—ëŠ” í•´ë‹¹ í”„ë ˆìž„ì„ ê³„ì† ë¶™ìž¡ê³  ìžˆì„ í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ì‹¤í–‰ì´ í•„ìš”í•œ `save` í•¨ìˆ˜ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.

![](https://i.imgur.com/XmdB0tW.png)

ì´ `save` í•¨ìˆ˜ ì•ˆì— ë§ˆì°¬ê°€ì§€ë¡œ `await` ì½”ë“œê°€ ë‹´ê²¨ìžˆë‹¤ê³  ê°€ì •í•´ë³´ë©´, í•´ë‹¹ `save` í•¨ìˆ˜ ë˜í•œ íž™ ì˜ì—­ìœ¼ë¡œ ì˜®ê²¨ì§„ í›„ ì‹œìŠ¤í…œì— ì“°ë ˆë“œ ì œì–´ê¶Œì„ ë„˜ê²¨ì£¼ê²Œ ë©ë‹ˆë‹¤.

![](https://i.imgur.com/K1SLhLB.png)

ì“°ë ˆë“œëŠ” ë‹¤ë¥¸ ìž‘ì—…ë“¤(`otherWork1`, `otherWork2`)ì„ ë§ˆì°¬ê°€ì§€ë¡œ íž™ ì˜ì—­ì— ë³´ê´€í•˜ë©° ìˆ˜í–‰í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ íž™ ì˜ì—­ì—ëŠ” `async` í•¨ìˆ˜ë“¤ì˜ ìŠ¤íƒë“¤ì´ ëª¨ì—¬ìžˆê²Œ ë˜ëŠ” ê²ƒì´ì£ .

**Continuation**ì´ë¼ëŠ” ê²ƒì´ ì´ëŸ° íž™ ì˜ì—­ì˜ `async` ìŠ¤íƒì„ ëŒ€í‘œí•œë‹¤ê³  í•©ë‹ˆë‹¤.

> **Continuation**ì´ëž€ ë‹¨ìˆœížˆ `await` ì´í›„ì— ìˆ˜í–‰ë˜ëŠ” ìž‘ì—…ë“¤ì„ í‘œí˜„í•˜ëŠ” ë§ì´ë¼ê³  í•©ë‹ˆë‹¤.
> 
> `withCheckedThrowingContinuation(continuation:)`ê³¼ ê°™ì€ ë©”ì„œë“œì—ì„œ ì‚¬ìš©ë˜ë‹ˆ ì°¸ê³ í•´ì£¼ì„¸ìš”!

![](https://i.imgur.com/njgQmFm.png)

**ìž‘ì—…ì´ ì—†ëŠ” ì“°ë ˆë“œ**ê°€ ìƒê¸°ê³  íž™ ì˜ì—­ì— ì €ìž¥ëœ `async` continuationì´ ë‹¤ìŒ ìž‘ì—…ìœ¼ë¡œ ì„ íƒë˜ë©´, íž™ ì˜ì—­ì— ìžˆë˜ ìž‘ì—… ìŠ¤íƒì„ í•˜ë‚˜ì”© ë‹¤ì‹œ **ìŠ¤íƒ ì˜ì—­**ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ ì°¨ê·¼ì°¨ê·¼ ìž‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

> ì´ ë•Œ, **ìž‘ì—…ì´ ì—†ëŠ” ì“°ë ˆë“œ**ë¼ëŠ” ê²ƒì€ `await` ì´ì „ì— ìˆ˜í–‰í•˜ë˜ ì“°ë ˆë“œì¼ìˆ˜ë„ ìžˆê³  ì•„ë‹ ìˆ˜ë„ ìžˆìŠµë‹ˆë‹¤. **ë³´ìž¥ë˜ì§€ ì•ŠëŠ”ë‹¤**ëŠ” ê²ƒì´ì£ .

ìž ê·¸ëž˜ì„œ ì´ `async` / `awaitë¥¼` ì´ìš©í•œ ConcurrencyëŠ” ì–´ë–»ê²Œ ì‚¬ìš©í•˜ë©´ ë ê¹Œìš”?

## Task

![](https://i.imgur.com/N9K39Fh.png)

ìœ„ì˜ ì˜ˆì‹œë¥¼ ì—¬ëŸ¬ë²ˆ ìˆ˜í–‰í•˜ëŠ” ë˜ ë‹¤ë¥¸ ì˜ˆì‹œìž…ë‹ˆë‹¤.

ì´ ì˜ˆì‹œëŠ” ìƒë‹¹ížˆ ì¢‹ì€ ì˜ˆì‹œì´ê³  ì•„ì£¼ ì •ìƒì ìœ¼ë¡œ ìž˜ ë™ìž‘í•˜ëŠ” ì˜ˆì‹œìž…ë‹ˆë‹¤.

í•˜ì§€ë§Œ í•œ ê°€ì§€ ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ìžˆìŠµë‹ˆë‹¤.

`for in`ì„ í†µí•´ì„œ ì—¬ëŸ¬ë²ˆì˜ `URLSessionì„` `await`í•˜ëŠ” ê²ƒì¸ë°ìš”.. ì´ëŸ° ì‹ì˜ êµ¬í˜„ì€ **í•œ ë²ˆì— í•˜ë‚˜ì˜ ë£¨í”„**ë§Œì„ ìˆ˜í–‰í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

`async`í•˜ê²ŒëŠ” êµ¬í˜„í•˜ì˜€ì§€ë§Œ **concurrentí•˜ì§€ëŠ” ëª»í•œ ê²ƒìž…ë‹ˆë‹¤.**

ë˜í•œ `fetchThumbnails()`ì´ë¼ëŠ” í•¨ìˆ˜ ë˜í•œ ê²°êµ­ì—ëŠ” `async` í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— í”„ë¡œì íŠ¸ì˜ ì–´ë”˜ê°€ì—ì„œëŠ” `async` ì»¨í…ìŠ¤íŠ¸ë¥¼ ì œê³µí•´ì¤„ ê³³ì´ í•„ìš”í•©ë‹ˆë‹¤.

ì´ ë•Œ **Task**ê°€ ë“±ìž¥í•©ë‹ˆë‹¤.

**Task**ëŠ” concurrentí•œ ì½”ë“œ ìˆ˜í–‰ì„ ìœ„í•œ **ìƒˆë¡œìš´ async ì»¨í…ìŠ¤íŠ¸ë¥¼ ì œê³µ**í•©ë‹ˆë‹¤.

> `async` í•¨ìˆ˜ë¥¼ ë‹¨ìˆœížˆ call í•˜ëŠ” ê²ƒì€ Taskë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤! (GCD ë“±ì„ ì‚¬ìš©í•˜ë©´ call í•  ìˆ˜ëŠ” ìžˆìŠµë‹ˆë‹¤.)

í•˜ì§€ë§Œ ì–´ë–¤ Taskë“¤ì´ ìžˆë‚˜ ë³´ê¸° ì´ì „ì— **Task Tree**ë¼ëŠ” ê°œë…ì„ ì•Œì•„ë‘ì–´ì•¼ í•©ë‹ˆë‹¤.

### Task Tree

**Task Tree**ëŠ” Taskì˜ **ì·¨ì†Œ(cancellation)**, **ìš°ì„ ìˆœìœ„(priority)**, **ì§€ì—­ë³€ìˆ˜(task-local variables)** ë“±ì˜ ì†ì„±ë“¤ì„ ê²°ì •í•˜ëŠ” ì•„ì£¼ ì¤‘ìš”í•œ ê°œë…ìž…ë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œëŠ” ì–´ë–¤ `async` í•¨ìˆ˜ê°€ ë‹¤ë¥¸ **`async` í•¨ìˆ˜ë¥¼ í˜¸ì¶œ**í•˜ë©´, ë‘ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë°ì—ëŠ” **ê°™ì€ Task**ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.

![](https://i.imgur.com/OHtAIMh.png)

ì•„ëž˜ `async-let`ì—ì„œ ì‚¬ìš©ëœ ì˜ˆì‹œì˜ ê²½ìš°ë¥¼ ë¨¼ì € í•œ ë²ˆ ê°€ì ¸ì™€ë´¤ìŠµë‹ˆë‹¤.

`fetchOne()` í•¨ìˆ˜ê°€ ë‘ ê°€ì§€ì˜ Task `data`ì™€ `metadata`ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°ìž…ë‹ˆë‹¤.

`fetchOneThumbnail()` í•¨ìˆ˜ëŠ” ë‘ ê°€ì§€ Taskë¥¼ childë¡œ ê°–ê³  ìžˆë‹¤ê³  í–ˆìŠµë‹ˆë‹¤.

ì´ì²˜ëŸ¼ í•œ Taskê°€ ë‹¤ë¥¸ Taskë¥¼ ì‹¤í–‰í•˜ë©´ ì‹¤í–‰ëœ Taskë“¤ì€ í˜„ìž¬ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê³  ìžˆëŠ” Taskì˜ **Child Task**ê°€ ë©ë‹ˆë‹¤.

> TaskëŠ” í•¨ìˆ˜ì— ì¢…ì†ëœ ê°œë…ì€ ì•„ë‹ˆì§€ë§Œ í•¨ìˆ˜ì˜ ìƒëª…ì£¼ê¸°ì— ì˜í–¥ì„ ë°›ì„ ìˆ˜ëŠ” ìžˆìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  **Parent Task**ëŠ” ì¢…ì†ëœ **ëª¨ë“  Child Taskë“¤ì´ ì¢…ë£Œë˜ê¸° ì „**ì—ëŠ” **ì¢…ë£Œë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**

ë§Œì•½ `metadata` Taskê°€ ì—ëŸ¬ë¥¼ `throw`í•˜ë©´ì„œ ì¢…ë£Œë˜ì—ˆë‹¤ëŠ” ìƒí™©ì„ ê°€ì •í•´ë´…ì‹œë‹¤.

ë‘ TaskëŠ” ê°™ì€ `guard` ë¬¸ ë‚´ì— ìžˆê¸° ë•Œë¬¸ì— ì¦‰ì‹œ ì—ëŸ¬ë¥¼ `throw`í•˜ê³  í•¨ìˆ˜ë¥¼ ì¢…ë£Œí•  ìˆ˜ ìžˆê² ì£ ?

í•˜ì§€ë§Œ **Task**ì—ì„œëŠ” ê·¸ë ‡ì§€ ì•ŠìŠµë‹ˆë‹¤. ì •í™•ížˆ ë§í•˜ë©´ **â€œì¦‰ì‹œâ€** ì¢…ë£Œí•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.

`metadata` Taskê°€ ì‹¤íŒ¨í–ˆë”ë¼ë„ `data` TaskëŠ” ì—¬ì „ížˆ ë™ìž‘ì¤‘ì¼ ê²ƒìž…ë‹ˆë‹¤.

ë”°ë¼ì„œ í•´ë‹¹ Taskê°€ **ì·¨ì†Œë˜ì—ˆë‹¤ëŠ” ì •ë³´ë¥¼ ì œê³µ**í•´ì£¼ê³  Taskê°€ **ì¢…ë£Œë˜ê¸°ë¥¼ ê¸°ë‹¤ë ¸ë‹¤ê°€** ëª¨ë“  Taskê°€ ì¢…ë£Œëœ ì‹œì ì— í•¨ìˆ˜ê°€ ì¢…ë£Œë©ë‹ˆë‹¤.

> ì—¬ê¸°ì„œ **ì·¨ì†Œë˜ì—ˆë‹¤(cancelled)** ë¼ëŠ” ê²ƒì€ í•´ë‹¹ Taskë¥¼ **ì¢…ë£Œì‹œí‚¤ëŠ” ê²ƒì´ ì•„ë‹ˆê³  ê²°ê³¼ê°€ ë” ì´ìƒ í•„ìš”ì—†ë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì¤„ ë¿**ìž…ë‹ˆë‹¤.

![](https://i.imgur.com/IrOtkbg.png)

ë§Œì•½ ì·¨ì†Œëœ Taskê°€ **Child Task**ë¥¼ ê°€ì§€ê³  ìžˆë‹¤ë©´ **ëª¨ë“  Child Taskë“¤ ë˜í•œ ì·¨ì†Œ**ë©ë‹ˆë‹¤.

ì´ëŸ¬í•œ Task Tree ë™ìž‘ì€ ARCì™€ ê°™ì´ ì‹¤ìˆ˜ë¡œ ë²Œì–´ì§€ëŠ” **Task Leak**ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•¨ì´ë¼ê³  í•©ë‹ˆë‹¤.

ì´ëŸ° Task Treeì˜ íŠ¹ì„±ì„ ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ í‘œí˜„í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

**Taskì˜ ì·¨ì†Œ**ëŠ” **í˜‘ë ¥ì (cooperative)** ìœ¼ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

1. TaskëŠ” ì·¨ì†Œë˜ë”ë¼ë„ ì¦‰ì‹œ ì¢…ë£Œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
2. Taskì˜ ì·¨ì†Œ ì—¬ë¶€ëŠ” ì–´ë””ì—ì„œë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. (synchronousí•œ ì½”ë“œì—ì„œë„)

ì´ëŠ” ê°œë°œìžê°€ Taskê°€ ì·¨ì†Œë˜ì—ˆì„ ë•Œì˜ ë™ìž‘ì„ êµ¬í˜„í•  ìˆ˜ ìžˆê²Œ í•˜ê¸° ìœ„í•¨ì´ë¼ê³  í•˜ë„¤ìš”.

> ì´ ë§ì€ Taskê°€ ì˜¤ëž˜ ê±¸ë¦¬ëŠ” ë™ìž‘ì¼ìˆ˜ë¡ ì·¨ì†Œì— ëŒ€ì‘í•˜ëŠ” ì½”ë“œê°€ ê¼­ í•„ìš”í•˜ë‹¤ë¼ëŠ” ëœ» ê°™ìŠµë‹ˆë‹¤.

ì„¤ëª…ë§Œìœ¼ë¡œëŠ” ë¬´ìŠ¨ ë§ì¸ì§€ ìž˜ ëª¨ë¥´ê² ìœ¼ë‹ˆ ì˜ˆì‹œë¥¼ ë‹¤ì‹œ ê°€ì ¸ì™€ë³´ì£ !

![](https://i.imgur.com/4i9k1jL.png)

ìœ„ì™€ ê°™ì´ concurrentí•œ ë™ìž‘ì´ **ìˆ˜í–‰ë˜ê¸° ì „**ì— `Task.checkCancellation()`ë‚˜ if `Task.isCancelled { break }`ì„ í†µí•´ ë¶ˆí•„ìš”í•œ ì¸ë„¤ì¼ ìƒì„±ì˜ ë™ìž‘ì„ ë°©ì§€í•˜ê³  ì—ëŸ¬ë¥¼ ë°©ì¶œí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

> ìœ„ ì˜ˆì‹œì˜ ê²½ìš° Taskê°€ ì·¨ì†Œë˜ì—ˆë”ë¼ë„ thumbnailsì—ëŠ” ì·¨ì†Œë˜ê¸° ì´ì „ì— ì„±ê³µí•œ ë°ì´í„°ë“¤ì´ ë‹´ê²¨ìžˆê³ , ê·¸ ë°ì´í„°ë“¤ì´ ê·¸ëŒ€ë¡œ ë°˜í™˜ë©ë‹ˆë‹¤. ë¹ˆ ë°ì´í„° ë“±ì˜ ê²°ê³¼ëŠ” UIì— ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìžˆê¸° ë•Œë¬¸ì— ì—¼ë‘ì— ë‘ê³  ìž‘ì—…í•´ì•¼í•©ë‹ˆë‹¤.

ì´ì œ ìš°ë¦¬ëŠ” Taskê°€ ì–¸ì œ ì·¨ì†Œë˜ê±°ë‚˜ ì™„ë£Œë˜ëŠ”ì§€ë¥¼ ì•Œì•˜ìŠµë‹ˆë‹¤! ðŸ˜Ž

ë“œë””ì–´ Swiftê°€ ì œê³µí•˜ëŠ” ë‹¤ì–‘í•œ í˜•íƒœì˜ **Task**ë¥¼ ì•Œì•„ë³¼ ë•Œê°€ ë˜ì—ˆë„¤ìš”. í•˜ë‚˜ì”© ì‚´íŽ´ë³´ì£ !

### Structured Tasks

- **async-let Tasks**

![](https://i.imgur.com/hs0BOj3.png)

ì§€ê¸ˆê¹Œì§€ì˜ `URLSession.data()` í•¨ìˆ˜ëŠ” ìœ„ì™€ ê°™ì´ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.

í™”ì‚´í‘œì˜ ë°©í–¥ëŒ€ë¡œ **ë‹¨ í•œê°€ì§€ì˜ íë¦„**(ë‹¨ë°©í–¥)ë§Œì´ ì¡´ìž¬í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” `URLSession`ì€ ì‹œê°„ì´ ê±¸ë¦¬ëŠ” í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— ìˆ˜í–‰ ì‹œê°„ë™ì•ˆ ë‹¤ë¥¸ ìž‘ì—…ë“¤ì´ ìˆ˜í–‰ë˜ê¸¸ ì›í•©ë‹ˆë‹¤.

![](https://i.imgur.com/dcjOSV3.png)

`async-let`ì„ ì‚¬ìš©í•˜ë©´ ìœ„ì²˜ëŸ¼ íë¦„ì´ ë‘ ê°€ì§€ë¡œ ë‚˜ë‰˜ì–´ì§‘ë‹ˆë‹¤.

**Child Task**ê°€ ìƒì„±ë˜ê³ , `URLSession.data()` í•¨ìˆ˜ë¥¼ **asyncí•˜ê²Œ ì‹¤í–‰**í•¨ê³¼ ë™ì‹œì— `result`ì—ëŠ” **ìž„ì‹œ ê°’(placeholder)** ì„ ë„˜ê²¨ì¤€ì±„ë¡œ `await` í‚¤ì›Œë“œê°€ ë“±ìž¥í•  ë•Œê¹Œì§€ ìˆ˜í–‰í•©ë‹ˆë‹¤.

`await`ì—ì„œ ê¸°ë‹¤ë¦¬ë˜ ìž‘ì—…ì€ `async` í•¨ìˆ˜ê°€ ëì´ ë‚˜ë©´ `result` ê°’ì„ **ëŒ€ì²´**í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.

![](https://i.imgur.com/6AkTzcH.png)

ê·¸ë ‡ë‹¤ë©´ ìœ„ ì½”ë“œë¥¼ `async-let`ì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë°”ê¾¸ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œìš”?

`try await`ì€ **child task**ì—ê²Œ ìž‘ì—…ì„ ë„˜ê²¨ì¤¬ê¸° ë–„ë¬¸ì— ë” ì´ìƒ í•´ë‹¹ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ì§€ì ì—ì„œëŠ” í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

**Parent task**ì—ì„œ ê²°ê³¼ë¡œ ë‚˜ì˜¨ ë³€ìˆ˜ë¥¼ **ì‚¬ìš©**í•  ë•Œ í•„ìš”í•˜ì£ .

ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë°”ê¿”ì¤„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

![](https://i.imgur.com/xMhYuVI.png)

ê°ê°ì˜ `URLSession`ì—ì„œ `try await`ì„ ì œê±°í•˜ëŠ” ëŒ€ì‹  ë§¨ ì•žì— `async`ë¥¼ ë¶™ì—¬ì£¼ê³ ,

**Parent task**ì¸ `fetchOneThumbnail()` í•¨ìˆ˜ì—ì„œ `data`ì™€ `metadata`ê°€ í•„ìš”í•œ ìˆœê°„ì— `try await` ì„ ì‚¬ìš©í•˜ê³  ìžˆìŠµë‹ˆë‹¤!

- **Group Tasks**

`async-let`ì€ ìˆ˜í–‰í•´ì•¼í•˜ëŠ” **Taskì˜ ê°œìˆ˜ê°€ ì •í•´ì ¸ìžˆì„ ë•Œ** ìœ ìš©í•©ë‹ˆë‹¤.

![](https://i.imgur.com/OHtAIMh.png)

ë‹¤ì‹œ í•œë²ˆ ìœ„ ì˜ˆì‹œì˜ ê²½ìš°ë¥¼ ë³´ë©´, ëª‡ ê°œì˜ ì¸ë„¤ì¼ì„ ìƒì„±í•˜ë˜ì§€ ê°„ì— `fetchOne`ì´ë¼ëŠ” TaskëŠ” **ê³ ì •ì ìœ¼ë¡œ ë‘ ê°œì˜ Child Task**ë¥¼ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ `id`ì˜ ê°œìˆ˜ì— ë”°ë¼ì„œëŠ” ìˆ˜í–‰í•  `fetchOne()` í•¨ìˆ˜ê°€ ì‹¤í–‰ë  Taskì˜ ê°œìˆ˜ëŠ” ë‹¬ë¼ì§€ê² ì£ ?

**Task Group**ì€ ì´ëŸ° ê²½ìš°ì— ìœ ìš©í•©ë‹ˆë‹¤.

**Task Group**ì€ **ë™ì  ê°œìˆ˜ì˜ Taskì˜ ìˆ˜í–‰ì´ ë™ì‹œì— í•„ìš”í•  ë•Œ** ì‚¬ìš©ë˜ê¸° ìœ„í•´ ê³ ì•ˆë˜ì—ˆìŠµë‹ˆë‹¤.

![](https://i.imgur.com/GpMeSw2.png)

`withThrowingTaskGroup(of:)` ë¥¼ í†µí•´ì„œ **Task Group**ì„ ë§Œë“¤ì–´ì¤„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ì´ í•¨ìˆ˜ëŠ” **Child Taskë¥¼ ìƒì„±**í•˜ëŠ” **group** ì´ë¼ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” Contextë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ë˜í•œ for ë£¨í”„ì˜ ê° ë£¨í”„ë“¤ì€ `group.async`ë¥¼ í†µí•´ **ë¹„ë™ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰**ë˜ê¸° ë•Œë¬¸ì— **ëžœë¤í•œ ì‹œê¸°ì— ìˆœì„œ ìƒê´€ ì—†ì´** ìˆ˜í–‰ë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

`group` ì¸ìŠ¤í„´ìŠ¤ê°€ ë£¨í”„ë¥¼ ì „ë¶€ ëŒì•˜ë”ë¼ë„ **Task Treeì˜ íŠ¹ì„±**ì— ì˜í•´ **ëª¨ë“  Taskê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ awaitëœë‹¤**ëŠ” ê²ƒë„ ì•Œ ìˆ˜ ìžˆê² ì£ !

ê·¸ëŸ°ë°.. ëª¨ë“ ê²Œ í‰í™”ë¡œì›Œ ë³´ì´ëŠ” ìœ„ ì½”ë“œëŠ” ë†€ëžê²Œë„ **ì‹¬ê°í•œ ì—ëŸ¬**ë¥¼ ê°€ì§‘ë‹ˆë‹¤.. ðŸ˜°

ì‹¬ì§€ì–´ ë¹Œë“œë„ ì•ˆë˜ëŠ” ì»´íŒŒì¼ëŸ¬ ì—ëŸ¬ë¥¼ ë‚´ë¿œì£ ..

![](https://i.imgur.com/OkgBhZ1.png)

ë°”ë¡œ **Data Race Issue**ê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤..

> **Data Race Issue**ëŠ” í•œ ë²ˆì— **ì—¬ëŸ¬ ê°œì˜ Task**ì—ì„œ **í•˜ë‚˜ì˜ ë°ì´í„°ì— ì ‘ê·¼**í•  ë•Œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ìž…ë‹ˆë‹¤. í•˜ë‚˜ì˜ ë³€ìˆ˜ëŠ” **í•œ ë²ˆì— í•˜ë‚˜ì˜ ì—°ì‚°**ë§Œ ê°€ëŠ¥í•˜ì§€ë§Œ, **ì—¬ëŸ¬ Taskì—ì„œ ë™ì‹œì— ê°’ì„ ìˆ˜ì •**í•˜ë ¤ê³  í•˜ë©´ í¬ëŸ¬ì‰¬ê°€ ë‚˜ê±°ë‚˜ ë°ì´í„°ê°€ ì†ìƒë˜ê²Œ ë©ë‹ˆë‹¤..

ì´ ê²½ìš°ì—ëŠ” í•˜ë‚˜ì˜ `thumbnails` ë”•ì…”ë„ˆë¦¬ì— ì—¬ëŸ¬ Taskë“¤ì´ ë™ì‹œì— ê°’ì„ ë„£ì–´ì£¼ê³  ìžˆì£ ?

ì´ëŠ” Concurrency í”„ë¡œê·¸ëž˜ë°ì„ í•  ë•Œ ê°œë°œìžë“¤ì´ í”ížˆ í•˜ëŠ” ì‹¤ìˆ˜ ì¤‘ì— í•˜ë‚˜ìž…ë‹ˆë‹¤.

Data Race Issueì˜ í•´ê²°ì€ ê°œë°œìžì—ê²Œ ë‹¬ë ¤ìžˆì—ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì—…ë°ì´íŠ¸ëœ Swift ConcurrencyëŠ” ì´ë¥¼ ì»´íŒŒì¼ëŸ¬ì—ì„œ ë¯¸ë¦¬ ë°œê²¬í•˜ì—¬ ì—ëŸ¬ë¥¼ ë°œìƒì‹œì¼œì£¼ëŠ” ê²ƒì´ì£ ! ðŸ‘ *(ì´ë ‡ê²Œ ë“¤ìœ¼ë‹ˆê¹Œ ë©‹ì§€ì£ ?)*

ê·¸ëž˜ì„œ ì—ëŸ¬ë¥¼ ìž¡ì•„ì£¼ê¸´ í•˜ëŠ”ë° í•´ê²°ì€ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œìš”?

TaskëŠ” ì‚¬ì‹¤ `@Sendable` í´ë¡œì €ë¼ëŠ” í´ë¡œì €ì— ì˜í•´ ê°ì‹¸ì ¸ ìžˆìŠµë‹ˆë‹¤.

`@Sendable` í´ë¡œì €ì˜ ìº¡ì²˜ëŠ” ë…íŠ¹í•˜ê²Œë„ `mutable` ë³€ìˆ˜ì˜ ê°’ì„ ìº¡ì²˜í•˜ì§€ ëª»í•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ ì–´ë–¤ ê°’ë“¤ì„ ìº¡ì²˜í•  ìˆ˜ ìžˆëŠ”ê°€ í•˜ë©´?

**ê°’ íƒ€ìž…**(`Int`, `String`, â€¦) ë³€ìˆ˜, **actors**, ê³ ìœ í•œ **synchronizationì„ ê°€ì§„ class** ë¥¼ ìº¡ì²˜í•˜ê±°ë‚˜ ì‚¬ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ë‹¤ì‹œ ì˜ˆì‹œë¡œ ëŒì•„ê°€ì„œ ì—ëŸ¬ë¥¼ ê³ ì³ë³¼ê²Œìš”..

![](https://i.imgur.com/ArzVjpZ.png)

`thumbnails`ì— ì§ì ‘ì ìœ¼ë¡œ ê°’ì„ ëŒ€ìž…í•˜ëŠ” ëŒ€ì‹ , `String` íƒ€ìž…ê³¼ `UIImage` íƒ€ìž…ì˜ íŠœí”Œì„ ë°˜í™˜í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.

ê·¸ í›„ì— `for await` ë£¨í”„ë¥¼ í†µí•´ ìˆœì°¨ì ìœ¼ë¡œ ê°’ë“¤ì„ `thumbnails`ì— ëŒ€ìž…í•´ì£¼ê³  ìžˆìŠµë‹ˆë‹¤.

**`AsyncSequence` í”„ë¡œí† ì½œ**ì„ ì±„íƒí•œ ê°’ì„ ë‹¤ë£¨ê³  ìžˆë‹¤ë©´ `for await` ë£¨í”„ë¥¼ ì‚¬ìš©í•´ë³¼ ê²ƒì„ ê¶Œìž¥í•˜ê³  ìžˆë„¤ìš”.

ìž.. ì—¬ê¸°ê¹Œì§€ ì•Œì•„ë³¸ `async-let` ê³¼ `Grouped Tasks`ëŠ” **Structured Task**ë¼ëŠ” ê°ìžì˜ hierarchyê°€ ì •ëˆëœ Taskë“¤ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì´ì˜€ìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì–¸ì œë‚˜ ì •ëˆëœ ë°©ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” ê±´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— SwiftëŠ” **Unstructured Tasks**ë¼ëŠ” APIë¥¼ ì¶”ê°€ë¡œ ì œê³µí•˜ê³  ìžˆìŠµë‹ˆë‹¤.

### Unstructured Tasks

Hierarchyê°€ ì •ëˆë˜ì§€ ì•Šì€ Taskì—ëŠ” ì–´ë–¤ Taskë“¤ì´ ìžˆì„ê¹Œìš”?

ë¨¼ì €, **Parent Taskê°€ ì¡´ìž¬í•˜ì§€ ì•Šì„** ìˆ˜ ìžˆìŠµë‹ˆë‹¤. **asyncí•˜ì§€ ì•Šì€ ì»¨í…ìŠ¤íŠ¸**ì—ì„œ **asyncí•œ Taskë¥¼ ì‹œìž‘**í•´ì•¼í•  ë•Œê°€ ì´ëŸ° ê²½ìš°ì£ .

ë˜ Taskê°€ í•˜ë‚˜ì˜ scopeë¥¼ ë„˜ì–´ **ì—¬ëŸ¬ scopeì—ì„œ ì´ë£¨ì–´ì§€ë„ë¡** í•  í•„ìš”ê°€ ìžˆì„ ë•Œë„ ìžˆì„ê²ë‹ˆë‹¤.

ë³´í†µ `delegate` íŒ¨í„´ì„ ì‚¬ìš©í•  ë•Œ í”ížˆ ì¼ì–´ë‚˜ëŠ” ì¼ì´ë¼ê³  í•˜ë„¤ìš”.

![](https://i.imgur.com/hP2cM4D.png)

ìœ„ ì˜ˆì‹œë¥¼ ë´…ì‹œë‹¤..

`delegate` í•¨ìˆ˜ì¸ `collectionView(willDisplay:, forItemAt)` í•¨ìˆ˜ëŠ” UI ë ˆì´ì–´ì˜ í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— asyncí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” `fetchThumbnails()` í•¨ìˆ˜ëŠ” async í•¨ìˆ˜ì´ì£ .

ì´ëŸ´ ë•Œê°€ ë°”ë¡œ **Unstructured Task**ë¥¼ ì‚¬ìš©í•  ë•Œìž…ë‹ˆë‹¤.

![](https://i.imgur.com/kHwb1FR.png)

ê°„ë‹¨í•˜ê²Œ async ì²˜ë¦¬ê°€ í•„ìš”í•œ ê³³ì€ `Task`ë¡œ ê°ì‹¸ì¤ë‹ˆë‹¤.

ëŸ°íƒ€ìž„ë™ì•ˆ ì´ **Taskë¥¼ ìƒì„±í•˜ëŠ” ë¶€ë¶„**ì„ ë§ˆì£¼ì¹˜ê²Œ ë˜ë©´, **ìˆ˜í–‰í•˜ëŠ” scopeì™€ ê°™ì€ actor**ì—ì„œ ì‹¤í–‰ë˜ë„ë¡ ì˜ˆì•½ì„ í•´ë‘¡ë‹ˆë‹¤.

ì˜ˆì‹œì˜ ê²½ìš°ì—ëŠ” `MainActor`ì—ì„œ ì‹¤í–‰ì´ ë  ê²ë‹ˆë‹¤.

ì´ë ‡ê²Œ ì‚¬ìš©í•˜ê¸° ê°„íŽ¸í•˜ë‹¤ë©´ ë‹¨ì ë„ ë‹¹ì—°ížˆ ìžˆê² ì£ ?

Taskì˜ ìƒëª…ì£¼ê¸°ê°€ scopeì— ì¢…ì†ë˜ì§€ ì•Šê³  synchronousí•œ ì½”ë“œ ì¤‘ê°„ì—ì„œë„ í˜¸ì¶œì´ ë  ìˆ˜ ìžˆê¸° ë•Œë¬¸ì— Structured Taskì—ì„œ ìžë™ìœ¼ë¡œ ìˆ˜í–‰ë  ìˆ˜ ìžˆì—ˆë˜ **ì·¨ì†Œ**ì™€ `await`ë¥¼ ê°œë°œìžê°€ ì§ì ‘ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

![](https://i.imgur.com/uld4DAv.png)

ì´ ê²½ìš°, Taskë¥¼ ìƒì„±í•œ ë’¤ì— `thumbnailTasks`ë¼ëŠ” ë”•ì…”ë„ˆë¦¬ì— ì €ìž¥í•˜ì˜€ìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ ë‚˜ì¤‘ì—ë„ ì–¸ì œë“ ì§€ ì ‘ê·¼í•´ì„œ ìž‘ì—…ì„ ì·¨ì†Œí•  ìˆ˜ ìžˆê² ì£ ?

`defer`ë¬¸ì„ ì‚¬ìš©í•´ **Taskê°€ ëë‚œ ì‹œì ì— ì €ìž¥ëœ Taskë¥¼ í•´ì œ**í•¨ìœ¼ë¡œì¨ **ì´ë¯¸ ì™„ë£Œëœ Taskë¥¼ ì·¨ì†Œí•˜ëŠ” ì¼ë„ ë°©ì§€**í•´ë‘” ê²ƒì„ ë³¼ ìˆ˜ ìžˆë„¤ìš”.

> ðŸ™‹ ì–´ë¼ ê·¸ëŸ°ë°.. ê°™ì€ ë°ì´í„°ì— ì—¬ëŸ¬ Taskê°€ ë™ì‹œì— ì ‘ê·¼í•˜ë©´ ì•ˆëœë‹¤ê³  í•˜ì§€ ì•Šì•˜ë‚˜ìš”?

ë§žìŠµë‹ˆë‹¤.. í•˜ì§€ë§Œ ì´ ê²½ìš°ì—ëŠ” `@MainActor`, ì¦‰ ë©”ì¸ì“°ë ˆë“œì—ì„œ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— ì ˆëŒ€ë¡œ ë™ì‹œì— ì¼ì–´ë‚  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.

ì…€ì´ í™”ë©´ì—ì„œ ë²—ì–´ë‚˜ë©´ ìž‘ì—…ì„ ì·¨ì†Œí•´ë„ ë˜ê² ì£ .

![](https://i.imgur.com/bDfgWq7.png)

ë‹¤ìŒê³¼ ê°™ì´ `task.cancel()` ë¡œ Taskë¥¼ ì·¨ì†Œí•´ì¤„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### Detached Tasks

ì–´ë¼ ë­ê°€ í•˜ë‚˜ ë˜ ìžˆì£ â€¦?

Unstructured TasksëŠ” ì–´ë–¤ ìŠ¤ì½”í”„ì—ì„œë„ ìˆ˜í–‰ë  ìˆ˜ ìžˆëŠ” Taskì˜€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì–´ë–¤ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹œìž‘ë˜ì—ˆëŠ”ì§€ëŠ” ì¤‘ìš”í•œ ìš”ì†Œì˜€ìŠµë‹ˆë‹¤.

í•´ë‹¹ scopeì˜ ë³€ìˆ˜ë„ ì‚¬ìš©í•´ì•¼ í•˜ê³ ,

**Detached Tasks**ëŠ” ê·¸ ì–´ë–¤ ê²ƒë„ **ìƒê´€ì´ ì—†ì„ ë–„** ì‚¬ìš©í•˜ëŠ” Taskìž…ë‹ˆë‹¤.

Detached TasksëŠ” **ì»¨í…ìŠ¤íŠ¸ë¡œë¶€í„° ë…ë¦½ì **ìž…ë‹ˆë‹¤.

ì‹œìž‘ëœ scopeì—ì„œ **ì•„ë¬´ ê°’ë„ ê°€ì ¸ì˜¤ì§€ ì•ŠìŠµë‹ˆë‹¤.**

ì‹¬ì§€ì–´ ê°™ì€ actorì—ì„œ ì‹¤í–‰ë˜ë„ë¡ ë˜ì–´ìžˆì§€ë„ ì•Šì•„ì„œ **ê°™ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°–ì§€ë„ ì•ŠìŠµë‹ˆë‹¤.**

![](https://i.imgur.com/HnQ4DHp.png)

ìœ„ ì˜ˆì‹œëŠ” ì¸ë„¤ì¼ì„ ìƒì„±í•œ í›„ì— ë¡œì»¬ ë””ìŠ¤í¬ì— ìºì‹±ì„ í•˜ëŠ” ìž‘ì—…ì„ Detached Taskì—ì„œ ìž‘ì—…í•˜ë„ë¡ í•˜ëŠ” ì½”ë“œìž…ë‹ˆë‹¤.

ìºì‹±ì€ `@MainActor`ì—ì„œ ì²˜ë¦¬ë  í•„ìš”ê°€ ì „í˜€ ì—†ì£ .

ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§ˆ í•„ìš”ë„ ì—†ìŠµë‹ˆë‹¤.

`Task.detached(priority:)` ë¥¼ í†µí•´ì„œ ê°„ë‹¨í•˜ê²Œ **ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë…ë¦½**ëœ Detached Taskë¥¼ ë§Œë“¤ì–´ì¤„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

![](https://i.imgur.com/4nmJx28.png)

Detached Taskì— **Task Group**ì„ ì‚¬ìš©í•´ì„œ hierarchyë¥¼ ë§Œë“¤ì–´ì¤„ ìˆ˜ë„ ìžˆìŠµë‹ˆë‹¤.

ì—¬ëŸ¬ê°€ì§€ ë°±ê·¸ë¼ìš´ë“œ ìž‘ì—…ì´ í•„ìš”í•˜ì§€ë§Œ ì—°ê²°ëœ ìž‘ì—…ì´ í•„ìš”í•  ë•Œ ì•„ì£¼ ìœ ìš©í•˜ê² ì£ !

### ì •ë¦¬

![](https://i.imgur.com/vnsVMkB.png)

## Actor

ëë‚œ ì¤„ ì•Œì•˜ì£ ..?

í•˜ì§€ë§Œ ì•„ì§ ë§Žì´ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ðŸ¤¯

ìœ„ì—ì„œ `Actor`ë¼ëŠ” í‚¤ì›Œë“œê°€ ì‚¬ìš©ë˜ì—ˆì—ˆì£ ..?

ì´ê²Œ ë­”ì§€ë„ ì•Œì•„ë´ì•¼ì£ ..

Actorê°€ ë­”ì§€ ì•Œì•„ë³´ë ¤ë©´ ë§ˆì°¬ê°€ì§€ë¡œ ì´ë¯¸ í•œ ë²ˆ ì‚´íŽ´ë³¸ **Data Race Issue**ì™€ ê´€ë ¨ë˜ì–´ ìžˆë‹¤ëŠ” ê²ƒì„ ì•Œê³  ì‹œìž‘í•´ì•¼í•©ë‹ˆë‹¤.

**Data Race**ëŠ” **ì—¬ëŸ¬ ê°œì˜ Taskì—ì„œ ë™ì‹œì— í•˜ë‚˜ì˜ mutable ê°’ì— ì ‘ê·¼**í•˜ë ¤ê³  í•˜ë©´ ë°œìƒí•˜ëŠ” ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í• ê¹Œìš”?

**ë³€í•˜ì§€ ì•ŠëŠ” ë°ì´í„°**ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ **ì—¬ëŸ¬ Taskì— ê±¸ì³ ì‚¬ìš©ë˜ì§€ ì•Šë„ë¡** í•˜ë©´ í•´ê²°ë˜ê² ì£ ?

![](https://i.imgur.com/PiEJOBA.png)

ê·¸ëŸ¬ë©´ ì´ë ‡ê²Œ í•˜ë©´ ë˜ê² ë„¤ìš”!

`let`ìœ¼ë¡œ ê°’ì´ ê³ ì •ëœ ê°’ì„ ê° Taskì—ì„œ **`mutable`í•œ ê°’ìœ¼ë¡œ ë³µì‚¬**í•œ ë’¤ ìž‘ì—…ì„ í•´ì£¼ë©´ ë˜ê² ì£ .

ì•„ë‡¨ ì•ˆëìŠµë‹ˆë‹¤. ðŸ™…â€â™‚ï¸

ì—ëŸ¬ëŠ” ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ Taskë§ˆë‹¤ ë³µì‚¬ëœ ê°’ì€ ì„œë¡œì˜ ê°’ì— ì˜í–¥ì„ ì£¼ì§€ ëª»í•˜ê±°ë“ ìš”.

ê·¸ëŸ¬ë©´ ì´ë ‡ê²Œ ì •ë¦¬í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤: **ê° Taskë“¤ì´ ê³µìœ í•  ìˆ˜ ìžˆëŠ” `mutable` Taskê°€ í•„ìš”í•˜ë‹¤!**

SwiftëŠ” ì´ë¯¸ ê·¸ëŸ° featureë“¤ì„ ê°–ê³  ìžˆìŠµë‹ˆë‹¤.

ì´ëŸ° ë¬¸ì œëŠ” ì˜¤ëž˜ëœ ë¬¸ì œê±°ë“ ìš”..

`mutable` stateë¥¼ ë™ê¸°í™”í•˜ëŠ” ìž‘ì—…ì€ ë¡œìš°ë ˆë²¨ ë‹¨ê³„ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” **Atomics**, **Locks**, ë” ë†’ì€ ë ˆë²¨ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” **Serial DIspatch Queues**ê°€ ìžˆìŠµë‹ˆë‹¤.

ì´ë“¤ì€ ëª¨ë‘ ê°™ì€ ì—­í• ì„ í•˜ê³  ê°™ì€ ë¬¸ì œë¥¼ ê°–ê³  ìžˆìŠµë‹ˆë‹¤.

Shared mutable stateì— Data Race ì—†ì´ ì ‘ê·¼í•  ìˆ˜ ìžˆì§€ë§Œ, ì‚¬ìš©ë²•ì´ ì¡°ê¸ˆì´ë¼ë„ ì–´ê¸‹ë‚˜ë©´ ë°”ë¡œ ì•±ì´ í¬ëŸ¬ì‰¬ëœë‹¤ëŠ” ê²ƒì´ì£ .

**Actors**ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  shared mutable stateì˜ ë™ê¸°í™”ë¥¼ ì¢€ ë” ì‰½ê²Œ ì´ë£° ìˆ˜ ìžˆë„ë¡ ë“±ìž¥í–ˆìŠµë‹ˆë‹¤.

**Actors**ëŠ” stateë¥¼ **ë‹¤ë¥¸ ëª¨ë“  í”„ë¡œê·¸ëž¨ì—ì„œ ë¶„ë¦¬**í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  í•´ë‹¹ stateì— ì ‘ê·¼í•˜ë ¤ë©´ ë¬´ì¡°ê±´ **actor ë‚´ë¶€**ì— ë“¤ì–´ê°€ì•¼ë§Œ í•˜ì£ .

**Actor**ëŠ” ì¡°ê¸ˆ íŠ¹ì´í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤.

ìƒˆë¡œìš´ íƒ€ìž…ì´ê±°ë“ ìš”.

![](https://i.imgur.com/4uqjN9J.png)

ë§ˆì¹˜ `struct`, `enum`, `classì™€` ê°™ì´ **í”„ë¡œí¼í‹°**, **ë©”ì„œë“œ**, **ìƒì„±ìž** ë“±ì„ ê°€ì§‘ë‹ˆë‹¤.

`protocol`ê³¼ `extension` ë˜í•œ ì‚¬ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ë˜, actorëŠ” shared mutable stateì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ ë§Œí¼ `class`ì™€ ê°™ì€ **ì°¸ì¡° íƒ€ìž…**ìž…ë‹ˆë‹¤.

ì‚¬ìš©ë²•ì€ `class`ì™€ ë™ì¼í•©ë‹ˆë‹¤.

í•œ ê°€ì§€ ì£¼ì˜í•  ì ì´ ìžˆë‹¤ë©´ `class`ì™€ëŠ” ë‹¤ë¥´ê²Œ **ìƒì†**ì„ ì§€ì›í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤!

ê·¸ë¦¬ê³  ê°€ìž¥ ì¤‘ìš”í•œ ì ì€ actorì—ì„œ ì •ì˜ëœ ê°’ë“¤ì€ **ë™ì‹œì— ì ‘ê·¼ë˜ì§€ ì•Šë„ë¡ ë³´ìž¥**ë˜ì–´ ìžˆë‹¤~ë¼ëŠ” ì ìž…ë‹ˆë‹¤.

![](https://i.imgur.com/uZlj9lu.png)

ìœ„ì˜ ì˜ˆì‹œì— ì ìš©í•´ë³´ë©´ ì´ë ‡ê²Œ ë©ë‹ˆë‹¤.

ê°™ì€ ê°’ì— ì ‘ê·¼í•˜ì§€ë§Œ, ì ˆëŒ€ ë™ì‹œì— ì ‘ê·¼í•  ìˆ˜ëŠ” ì—†ê¸° ë•Œë¬¸ì— ìˆœì„œëŒ€ë¡œ 2, 1ì´ë‚˜ 1, 2ê°€ ì¶œë ¥ë ê²ë‹ˆë‹¤.

í•˜ì§€ë§Œ suspendëœ ìž‘ì—…ì´ actor ì•ˆì—ì„œ ì–Œì „ížˆ ì°¨ë¡€ë¥¼ ê¸°ë‹¤ë¦´ ê²ƒì´ë¼ëŠ” ë³´ìž¥ì€ ë˜ëŠ” ê±¸ê¹Œìš”?

ìš°ë¦¬ëŠ” ì´ë¯¸ ê·¸ëŸ° ì—­í• ì„ í•˜ëŠ” í‚¤ì›Œë“œë¥¼ ì•Œê³  ìžˆìŠµë‹ˆë‹¤.

![](https://i.imgur.com/Xpv0i3w.png)

actorì˜ ì™¸ë¶€ì—ì„œëŠ” `await` í‚¤ì›Œë“œë¥¼ í†µí•´ í•´ë‹¹ ìž‘ì—…ì´ **suspendable**í•˜ë‹¤ëŠ” ê²ƒì„ ëª…ì‹œí•´ì¤„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ actorì˜ ë‚´ë¶€ì—ì„œëŠ” ì´ì™€ ê°™ì€ í‚¤ì›Œë“œëŠ” í•„ìš”ê°€ ì—†ì£ .

ëª¨ë“  ì½”ë“œê°€ **synchronousí•˜ê²Œ ì‹¤í–‰**ë˜ê¸° ë•Œë¬¸ì— ë™ì‹œì„± í”„ë¡œê·¸ëž˜ë°ì˜ ë¬¸ì œë¥¼ ì‹ ê²½ì“°ì§€ ì•Šê³  ìž‘ì—…í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### Actor Reentrancy

![](https://i.imgur.com/KBfgXuf.png)

ìœ„ ì½”ë“œëŠ” ì´ë¯¸ì§€ë¥¼ ìºì‹±í•˜ëŠ” ìž‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” `actor`ìž…ë‹ˆë‹¤.

ë¬¸ì œëŠ” `await`ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤.

ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê³¼ì •ì€ ì‹œê°„ì´ ì˜¤ëž˜ ì†Œìš”ë˜ëŠ” ìž‘ì—…ì´ë‹ˆ `await`ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì˜¬ë°”ë¥¸ ì ‘ê·¼ìž…ë‹ˆë‹¤.

![](https://i.imgur.com/twvj2ww.png)

í•˜ì§€ë§Œ ë™ì‹œì— ë‘ êµ°ë°ì—ì„œ **ê°™ì€ urlì˜ ì´ë¯¸ì§€**ë¥¼ ë°›ì•„ì˜¤ê¸¸ ì›í•˜ê³ , í•˜ë‚˜ì˜ ìž‘ì—…ì´ ìˆ˜í–‰ë˜ëŠ” ë™ì•ˆ **ì„œë²„ì˜ ì´ë¯¸ì§€ê°€ êµì²´**ë˜ëŠ” ìƒí™©ì´ ìžˆë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?

ë‘ ìž‘ì—…ì€ ë™ì‹œì— ìš”ì²­ëìŒì—ë„ ë¶ˆêµ¬í•˜ê³  **ë‹¤ë¥¸ ì´ë¯¸ì§€**ë¥¼ ë°›ì•„ì˜¤ê²Œ ë ê²ë‹ˆë‹¤.

![](https://i.imgur.com/hZhXsLf.png)

ì´ ê²½ìš°ì—ëŠ”, ì´ë¯¸ urlì— í•´ë‹¹í•˜ëŠ” ì´ë¯¸ì§€ê°€ ìžˆë‹¤ë©´ ê·¸ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í•˜ê³ , ì—†ë‹¤ë©´ ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¥¼ ë„£ëŠ” ê²ƒìœ¼ë¡œ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.

ì´ì™€ ê°™ì´ actor ë‚´ë¶€ì—ì„œ `await`ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ìˆ¨ê²¨ì§„ ë²„ê·¸ë¥¼ ìœ ë°œí•  ìˆ˜ ìžˆê¸° ë•Œë¬¸ì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

ì´ëŸ° ê³¼ì •ì„ actorì— ìž¬ì§„ìž…í•˜ì—¬ ìž‘ì—…ì„ ìˆ˜í–‰í•œë‹¤ê³  í•´ì„œ **Actor Reentrancy**ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

ë‹¤ìŒ ì„¸ ê°€ì§€ë¥¼ í•­ìƒ ìƒê°í•´ê°€ë©° ì½”ë“œë¥¼ ì§œë´…ì‹œë‹¤.

1. ë˜ë„ë¡ synchronousí•˜ê²Œ ë°ì´í„°ë¥¼ mutate ì‹œí‚¨ë‹¤.
2. `await`ì—ì„œ suspendëœ ë™ì•ˆ stateê°€ ë°”ë€” ìˆ˜ ìžˆìŒì„ ìƒê°í•œë‹¤.
3. `await` í›„ì— ì¡°ê±´ë¬¸ ë“±ì„ í†µí•´ stateê°€ ì˜ˆìƒë²”ìœ„ ì•ˆì¸ì§€ ì²´í¬í•œë‹¤.

### Actor Isolation

ActorëŠ” ë‹¤ë¥¸ í”„ë¡œê·¸ëž¨ë“¤ê³¼ **ë…ë¦½ì **ìœ¼ë¡œ ìžˆëŠ” ì¡´ìž¬ë¼ê³  í–ˆì—ˆì£ ?

ë”°ë¼ì„œ ì™¸ë¶€ì—ì„œ actorì— ì ‘ê·¼í•  ë–„ëŠ” ì´ëŸ° ë…ë¦½ì„±ì„ í•´ì¹˜ë©´ì„œ ì ‘ê·¼í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.

> ì—¬ê¸°ì„œë¶€í„° ì¡°ê¸ˆ ì•„ë“í•´ì§‘ë‹ˆë‹¤.. ì£¼ì˜í•˜ì„¸ìš”â€¦ ðŸ« 

- **Protocol**

![](https://i.imgur.com/UfZjadS.png)

ì´ ê²½ìš° `Equatable` ë©”ì„œë“œëŠ” `static` ì´ê³  íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ” ë‘ actor íƒ€ìž… ê°’ì˜ ì™¸ë¶€ì— ìžˆìœ¼ë‹ˆê¹Œ ê°€ëŠ¥í•œ ë¬¸ë²•ìž…ë‹ˆë‹¤.

![](https://i.imgur.com/GhUS1Y5.png)

ë°˜ë©´ ì´ ê²½ìš°ì—ëŠ” í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

`hash(into:)` í•¨ìˆ˜ëŠ” **actor ë‚´ë¶€**ì— ë“¤ì–´ê°€ê³ , **asyncí•˜ì§€ë„ ì•Šê¸° ë•Œë¬¸**ìž…ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì´ìƒí•œ ì ì´ ìžˆìŠµë‹ˆë‹¤. ðŸ˜•

actor ë‚´ë¶€ì— ë“¤ì–´ê°€ëŠ” ê²ƒì€ ë§žì§€ë§Œ, ì‹¤ì œë¡œ actorê°€ ê°–ê³ ìžˆëŠ” ê°’ì„ ë³€ê²½í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆê±°ë“ ìš”..

![](https://i.imgur.com/9WaS0jv.png)

ê·¸ëŸ° ê²½ìš°ì—ëŠ” `nonisolated` í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ í•´ê²°í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ëì´ ì•„ë‹™ë‹ˆë‹¤..

ì´ ê²½ìš°ì—ëŠ” ì‚¬ìš©í•˜ëŠ” actorì˜ í”„ë¡œí¼í‹° `idNumber`ê°€ **immutable**í•œ ê°’ì´ê±°ë“ ìš”.

í•˜ì§€ë§Œ **mutable**í•œ ê°’ì„ ì‚¬ìš©í•˜ë ¤ê³  í•˜ë©´â€¦?

![](https://i.imgur.com/YfVeSeO.png)

ì–´ê¹€ì—†ì´ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

ì™¸ë¶€ì—ì„œ mutableí•œ ê°’ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì€ **Data Race**ë¥¼ ìœ ë°œí•  ìˆ˜ ìžˆê±°ë“ ìš”.

- **Closure**

ì´ë²ˆì—ëŠ” í´ë¡œì € ì•ˆì—ì„œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì˜ ê²½ìš°ë¥¼ ì‚´íŽ´ë´…ì‹œë‹¤.

![](https://i.imgur.com/yqAMbvI.png)

ìœ„ ì˜ˆì‹œëŠ” ì•„ë¬´ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.

ë…ë¦½ëœ ê³µê°„ì— ìžˆëŠ” `read()` í•¨ìˆ˜ ì•ˆì— ìžˆëŠ” *(ë§ˆì°¬ê°€ì§€ë¡œ ë…ë¦½ëœ ê³µê°„ì— ìžˆëŠ”)* `readSome()` í•¨ìˆ˜ê°€ **synchronous**í•˜ê¸° ë•Œë¬¸ì— ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì´ì£ !

![](https://i.imgur.com/joyF9HO.png)

ê·¸ë ‡ë‹¤ë©´ ì´ ê²½ìš°ëŠ” ì–´ë–¨ê¹Œìš”..

**Detached Task**ì— `read()` í•¨ìˆ˜ê°€ ìžˆê¸° ë•Œë¬¸ì— ì´ ê²½ìš°ì—ëŠ” í´ë¡œì € ì•ˆì˜ ìž‘ì—…ë“¤ì´ **ë…ë¦½ëœ ê³µê°„ì— ìžˆì§€ ì•Šê³  ë°–ìœ¼ë¡œ** ë‚˜ê°€ê²Œ ë©ë‹ˆë‹¤.

ë•Œë¬¸ì— í•´ë‹¹ í´ë¡œì €ëŠ” actorì— ìžˆì§€ ì•Šê³ , `await` í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ **ë¹„ë™ê¸°ì **ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

![](https://i.imgur.com/ka2pSN8.png)

ìž ì´ ê²½ìš°ë¥¼ ë´…ì‹œë‹¤..

`Book`ì´ë¼ëŠ” ì¸ìŠ¤í„´ìŠ¤ëŠ” `class` íƒ€ìž…ìž…ë‹ˆë‹¤. ì°¸ì¡° íƒ€ìž…ì´ë‹ˆê¹Œ actor ì•ˆì— ìžˆì§€ ëª»í•˜ê³  **ì™¸ë¶€**ì— ìœ„ì¹˜í•´ìžˆì£ .

actor ì•ˆì— ì°¸ì¡° íƒ€ìž…ì˜ ê°’ì´ ìžˆëŠ” ê²ƒ ìžì²´ëŠ” ì•„ë¬´ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.

ë¬¸ì œëŠ” í•´ë‹¹ ê°’ì— **ì ‘ê·¼**ì„ í•  ë•Œ ë°œìƒí•˜ê² ì£ ? (Data Race)

ì—¬ê¸°ì„œ ìµìˆ™í•œ í‚¤ì›Œë“œê°€ ë“±ìž¥í•©ë‹ˆë‹¤.

`Sendable`

`Sendable` íƒ€ìž…ì€ ë‹¤ë¥¸ ì—¬ëŸ¬ actorë“¤ ì‚¬ì´ì—ì„œ í•¨ê»˜ ì‚¬ìš©ë  ìˆ˜ ìžˆëŠ” íƒ€ìž…ìž…ë‹ˆë‹¤.

ì–´ë–¤ ê°’ì„ ê°ìžì˜ actorë¡œ ë³µì‚¬í•˜ê³ , **ë³µì‚¬ëœ ê°’ì„ ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬**í•  ìˆ˜ ìžˆë‹¤ë©´ í•´ë‹¹ ê°’ì€ `Sendable`í•˜ë‹¤ê³  í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

**ê°’ íƒ€ìž…**ê³¼ **Actor íƒ€ìž…**ì€ ê¸°ë³¸ì ìœ¼ë¡œ `Sendable`í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ **í´ëž˜ìŠ¤(ì°¸ì¡° íƒ€ìž…)** ì˜ ê²½ìš°ì—ëŠ” ê³ ë ¤í•´ì•¼í•  ì‚¬í•­ì´ ìžˆì£ ..

1. í´ëž˜ìŠ¤ì— ìžˆëŠ” **ëª¨ë“  ê°’ë“¤ì´ immutable(`let`)** í•œ ê²½ìš°
2. í´ëž˜ìŠ¤ **ë‚´ë¶€ì ìœ¼ë¡œ ë™ê¸°í™”(`NSLock`, ...)ë¥¼ êµ¬í˜„**í•œ ê²½ìš°

í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ í´ëž˜ìŠ¤ëŠ” ê·¸ë ‡ì§€ ì•Šê¸° ë•Œë¬¸ì— Sendableì´ ì•„ë‹ˆë¼ê³  í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

í•¨ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œëŠ” Sendableí•˜ì§€ ì•Šì§€ë§Œ `@Sendable` í•¨ìˆ˜ì™€ ê°™ì€ ìƒˆë¡œìš´ íƒ€ìž…ì˜ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ Sendableí•©ë‹ˆë‹¤.

![](https://i.imgur.com/lQtLpWi.png)

Sendableì€.. ì˜ˆìƒí•˜ì…¨ê² ì§€ë§Œ ì‚¬ì‹¤ **í”„ë¡œí† ì½œ**ìž…ë‹ˆë‹¤.

Swiftì—ì„œ concurrentí•œ ìž‘ì—…ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” **Sendable í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•œ ê°’**ë“¤ì„ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ê²ƒì´ì£ ..!

ìž.. ë‹¤ì‹œ í´ë¡œì €ë¡œ ëŒì•„ê°€ë´…ì‹œë‹¤.

**í´ë¡œì €**ê°€ `Sendable`í•˜ë ¤ë©´ ì–´ë–¤ ê²½ìš°ì—¬ì•¼ í• ê¹Œìš”?

ê°„ë‹¨í•©ë‹ˆë‹¤. í´ë¡œì €ê°€ **ìº¡ì²˜í•˜ëŠ” ëª¨ë“  ê°’ë“¤ì´ Sendable**í•´ì•¼í•˜ì£ .

ë˜ ìº¡ì²˜í•œ ê°’ë“¤ì´ **mutable(`var`)** í•˜ë©´ ì•ˆë©ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ Data Raceê°€ ë°œìƒí• í…Œë‹ˆê¹Œìš”..

ë§ˆì§€ë§‰ìœ¼ë¡œ í´ë¡œì €ê°€ **synchronous**í•œ ê²½ìš°ì— **actorì—ì„œ ë…ë¦½ëœ í˜•íƒœì´ë©´ ì•ˆë©ë‹ˆë‹¤.**

ì™¸ë¶€ì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì§€ë‹ˆê¹Œìš”!

### Main Actor

ë§ˆì§€ë§‰ìœ¼ë¡œ ì‚´íŽ´ë³¼ ê²Œ ìžˆìŠµë‹ˆë‹¤.

**Main Actor**ë¼ëŠ” íŠ¹ìˆ˜í•œ actorì¸ë°ìš”, ì´ë¯¸ ì „ì— í•œ ë²ˆ ì–¸ê¸‰ëœ ì ì´ ìžˆì—ˆì£ ?

ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìž‘ì—…ì„ í•˜ë‹¤ê°€ ë‹¤ì‹œ ë©”ì¸ì“°ë ˆë“œë¡œ ë„˜ì–´ì™€ UIë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•˜ëŠ” ìƒí™©..

ì•„ì£¼ ìµìˆ™í•˜ì£ ?

```swift
DispatchQueue.main.async {
  updateButton()
}
```

ë³´í†µ ìœ„ì™€ ê°™ì´ `DispatchQueue.main`ì„ ì‚¬ìš©í•´ì˜¤ê³¤ í–ˆìŠµë‹ˆë‹¤.

![](https://i.imgur.com/CcWieeY.png)

`@MainActor`ëŠ” í•´ë‹¹ ìž‘ì—…ì´ **ë©”ì¸ì“°ë ˆë“œ**ì—ì„œ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ëª…ì‹œí•˜ëŠ” í‚¤ì›Œë“œìž…ë‹ˆë‹¤.

`DispatchQueue.main` ëŒ€ì‹  ì‚¬ìš©í•˜ì—¬ ëª…ì‹œì ìœ¼ë¡œ ë©”ì¸ì“°ë ˆë“œì—ì„œ ë™ìž‘í•´ì•¼í•œë‹¤ëŠ” ê²ƒì„ ì»´íŒŒì¼ëŸ¬ì—ê²Œ ì•Œë ¤ì¤ì‹œë‹¤..!

> References

[WWDC21 - Swift concurrency: Behind the Scenes](https://developer.apple.com/videos/play/wwdc2021/10254/)

[WWDC21 - Explore structured concurrency in Swift](https://developer.apple.com/videos/play/wwdc2021/10134/)

[WWDC21 - Protect mutable state with Swift actors](https://developer.apple.com/videos/play/wwdc2021/10133/)

[naljin - Swift async / await & concurrency](https://sujinnaljin.medium.com/swift-async-await-concurrency-bd7bcf34e26f)