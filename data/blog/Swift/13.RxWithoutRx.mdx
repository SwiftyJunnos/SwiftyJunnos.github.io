---
title: 'ğŸ Swift - Rx ì—†ì´ Reactive Binding í•´ë³´ê¸°'
date: '2022-10-21'
tags: ['Swift']
draft: false
summary: 'Rxì—†ì´ Rxì™€ ê°™ì€ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³¼ê¹Œìš”?'
---

# Rx ì—†ì´ View â¡ï¸ ViewModel Bindingí•˜ê¸°

Rxë¼ëŠ” ë†ˆ ê³µë¶€í•  ë• ì–´ë ¤ì› ëŠ”ë°..
í•œ ë²ˆ ì¨ë³´ë‹ˆê¹Œ ì—†ì´ ê¸°ëŠ¥ êµ¬í˜„ì„ í•  ë•Œ ê°ˆì¦ì´ ê³„ì†í•´ì„œ ì¼ì–´ë‚˜ëŠ” í˜„ìƒì„ ê²ªê³  ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜ì¡´í•˜ëŠ” ê²ƒì€ ì¢‹ì§€ ì•Šìœ¼ë‹ˆê¹Œ Rx ì—†ì´ ë°ì´í„° ë°”ì¸ë”©ì„ í•˜ëŠ” ë°©ë²•ì„ ê³µë¶€í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

> ì½”ë“œì˜ ê²½ìš° ê²€ìƒ‰í•´ë³¸ ê±°ì˜ ëª¨ë“  ê²Œì‹œë¬¼ì—ì„œ ë™ì¼í•œ í˜•íƒœë¡œ ì‚¬ìš©ë˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ë‚´ë¶€ì ì¸ ë™ì‘ ê³¼ì •ë„ ëª¨ë¥¸ì±„ë¡œ ê°€ì ¸ë‹¤ì“°ê¸´ ì‹«ì–´ì„œ ê³µë¶€ ê²¸ ì‘ì„±í•œ ê²Œì‹œë¬¼ì…ë‹ˆë‹¤!

ì²´í¬ ë¦¬ìŠ¤íŠ¸ ì•±ì„ ë§Œë“ ë‹¤ê³  ê°€ì •í•©ì‹œë‹¤.
í•  ì¼ì„ ì™„ë£Œí•  ë•Œë§ˆë‹¤ ê·¸ ë‚  ì¼ì˜ ì™„ë£Œìœ¨ Labelì„ ê³„ì†í•´ì„œ ë°”ê¿”ì£¼ê³  ì‹¶ì–´ìš”.
ë”± Rxë¥¼ ì‚¬ìš©í•˜ë©´ í¸ë¦¬í•œ ìƒí™©ì´ì§€ë§Œ ë‹¤ë¥¸ ê¸°ëŠ¥ì„ ì°¾ì•„ë´…ì‹œë‹¤.

ê°’ì´ ë°”ë€” ë•Œë§ˆë‹¤ ìˆ˜í–‰í•˜ëŠ” ë™ì‘..
ì •í™•íˆ í•´ë‹¹ ê¸°ëŠ¥ì„ í•˜ëŠ” ì¹œêµ¬ê°€ ìˆì—ˆë˜ ê²ƒ ê°™ì•„ìš”.

ë°”ë¡œ `didSet`ì…ë‹ˆë‹¤.

## didSet

```swift
var donePercentage: Int = 0 {
  didSet {
    print(oldValue)
  }
}
```

`donePercentage`ì˜ ê°’ì´ ë°”ë€” ë•Œë§ˆë‹¤ `didSet`ì— ìˆëŠ” `print` í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤.
ì´ `didSet`ì„ í‚¤ì›Œë“œë¡œ ì¡ê³  ì‹œì‘í•´ë³´ê² ìŠµë‹ˆë‹¤.

## Observable

Rxì—ì„œ ìš°ë¦¬ëŠ”

```swift
viewModel.todos
  .subscribe(onNext: { todo in
    print(todo.count)
  })
  .disposed(by: self.disposeBag)
```

ì´ëŸ° ì‹ìœ¼ë¡œ `Observable`í•œ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì£¼ê³  `subscribe`í•˜ì—¬ í•„ìš”í•œ ë™ì‘ë“¤ì„ ì²˜ë¦¬í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

ë¨¼ì € í•„ìš”í•œ `Observable` íƒ€ì…ì„ ì°¨ê·¼ì°¨ê·¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

## value: T

```swift
class Observable<T> {
  var value: T

  init(_ value: T) {
    self.value = value
  }
}
```

`Observable`ì€ ëª¨ë“  íƒ€ì…ì— ëŒ€í•´ì„œ ê´€ì°°ì´ ê°€ëŠ¥í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— `Generic` íƒ€ì…ì„ `T`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  ìƒì„±ìë¥¼ í†µí•´ ì•Œë§¹ì´ì¸ `value` ê°’ì„ ë„£ì–´ì£¼ì—ˆì£ .

ì´ `value` ê°’ì´ ë°”ë€” ë•Œë§ˆë‹¤ ì–´ë–¤ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ì£¼ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— `didSet`ì„ ì‚¬ìš©í•´ì¤ì‹œë‹¤.

```swift
var value: T {
  didSet {
    // ì‹¤í–‰í•  í•¨ìˆ˜
  }
}
```

## listener (í´ë¡œì €)

ë‹¤ì‹œ Rxì˜ ê²½ìš°ë¥¼ ë´ë³¼ê¹Œìš”?

ì € `didSet` ì•ˆì— ë“¤ì–´ê°€ê²Œ ë  í•¨ìˆ˜ë¥¼ ì°¾ì•„ë´…ì‹œë‹¤.

```swift
.subscribe(onNext: { todo in
  print(todo)
})
```

`subscribe`ë¼ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  í´ë¡œì €ì˜ í˜•íƒœë¡œ í•¨ìˆ˜ë¥¼ ì „ë‹¬ë°›ì•„ ì‹¤í–‰í•˜ëŠ” ê²ƒ ê°™ë„¤ìš”.

ê·¸ë ‡ë‹¤ë©´ ì•ˆì— ë“¤ì–´ê°ˆ í•¨ìˆ˜ë¥¼ ë‹´ì„ í´ë¡œì € ë³€ìˆ˜ë¥¼ ì •ì˜í•´ì¤ì‹œë‹¤.

```swift
var listener: ((T) -> Void)?
```

`return` ë°›ëŠ” ê°’ì€ ì—†ìœ¼ë‹ˆ `Void`ë¡œ ì£¼ê³  `value` ê°’ì„ ë°›ì•„ ì²˜ë¦¬í•´ì£¼ì–´ì•¼ í•˜ë‹ˆ `input` íŒŒë¼ë¯¸í„°ë¡œ `T`(ì œë„ˆë¦­ íƒ€ì…)ì„ ë°›ì•„ì¤ì‹œë‹¤.

ì´ì œ ì´ `listener` í´ë¡œì €ë¥¼ `Observable` ì½”ë“œì— ì ìš©ì‹œì¼œì¤ì‹œë‹¤.

```swift
class Observable<T> {
  var value: T {
    didSet {
      self.listener?(value)
    }
  }

  var listener: ((T) -> Void)?

  init(_ value: T) {
    self.value = value
  }
}
```

## subscribe

`View`ìª½ì—ì„œ `subscribe` ì•ˆì—ì„œ í´ë¡œì €ë¡œ ë°›ëŠ” í•¨ìˆ˜ë¥¼ `listener`ì— ë‹´ê³  ìˆë‹¤ê°€ `didSet`ì´ í˜¸ì¶œë˜ë©´ ì‹¤í–‰ë˜ì•¼í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ íŒŒë¼ë¯¸í„°ë¡œ `@escaping` í´ë¡œì €ë¥¼ ë°›ì•„ì£¼ê³  í´ë˜ìŠ¤ ë‚´ë¶€ì˜ `listener`ì— ë‹´ì•„ì¤ì‹œë‹¤.

```swift
func subscribe(listener: @escaping (T) -> Void) {
  listener(value)
  self.listener = listener
}
```

ì´ ë•Œ `listener(value)`ì™€ ê°™ì´ í•œ ë²ˆ ì‹¤í–‰í•´ì¤¬ê¸° ë•Œë¬¸ì—, `subscribe`ì™€ ë™ì‹œì— ë¬´ì¡°ê±´ í•œ ë²ˆì€ ì‹¤í–‰ë©ë‹ˆë‹¤.

bindingê³¼ ë™ì‹œì— ì‹¤í–‰ì„ í•˜ì§€ ì•Šê³  ì‹¶ì€ ê²½ìš°ì—ëŠ” ë¹¼ì£¼ì–´ë„ ì•„ë¬´ ë¬¸ì œ ì—†ìŠµë‹ˆë‹¤.

## ì¢…í•©

ì´ì œ ì½”ë“œë“¤ì„ í•©ì³ë´…ì‹œë‹¤!

```swift
class Observable<T> {
  var value: T {
    didSet {
      self.listener?(value)
    }
  }

  var listener: ((T) -> Void)?

  init(_ value: T) {
    self.value = value
  }

  func subscribe(listener: @escaping (T) -> Void) {
    listener(value)
    self.listener = listener
  }
}
```

## ì‚¬ìš©

```swift
class HomeViewModel {
  var todoData: Observable<[ToDo]> = Observable([])
}

class HomeViewController: UIViewController {
  private var viewModel = HomeViewModel()

  lazy var progressLabel = UILabel().then { ... }

  override func viewDidLoad() {
    self.viewDidLoad()
    self.viewModel.todoData.subscribe { todo in
      DispatchQueue.main.async {
        self.progressLabel.text = todo.count
      }
    }

    DispatchQueue.main.asyncAfter(deadline: .now() + 1) {
      self.viewModel.todoData.value = [
        ToDo(title: "Test", state: .completed)
      ]
    }
  }
}
```
