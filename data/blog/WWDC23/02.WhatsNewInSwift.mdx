---
title: 'ğŸŠ WWDC23 - What's new in Swift'
date: '2023-06-06'
tags: ['Swift', 'WWDC23']
draft: false
summary: 'ê°„í¸ ë¡œê·¸ì¸ì˜ ì²« ê±¸ìŒ, ì• í”Œë¡œ ë¡œê·¸ì¸'
---

# WWDC23 - Whatâ€™s new in Swift

Swiftì˜ ìƒˆë¡œìš´ feature, ë§¤í¬ë¡œê°€ ë„ˆë¬´ ê¶ê¸ˆí•´ì„œ í•´ë‹¹ ì„¸ì…˜ë¶€í„° ì°¾ì•„ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ë°”ë¡œ ì‹œì‘í•´ë³´ì£ ..!

## Expressive Code

### Using if/else and switch Statements as Expressions

ì™€ìš°..
ì‹œì‘ë¶€í„° í° ì†Œì‹ì´ë„¤ìš”..
`if-else` êµ¬ë¬¸ê³¼ `switch` êµ¬ë¬¸ì„ í‘œí˜„ì‹ ìœ¼ë¡œì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì†Œì‹ì…ë‹ˆë‹¤.

```swift
let bullet =
  isRoot && (count == 0 || !willExpand) ? ""
    : count == 0    ? "- "
    : maxDepth <= 0 ? "â–¹ " : "â–¿ "
```

ë‹¤ì†Œ ê³¼ì¥ë˜ê¸´ í–ˆì§€ë§Œ ë³µì¡í•œ ì¡°ê±´ì— ì˜í•´ ë‹¤ì–‘í•œ ê°’ì„ `let` ë³€ìˆ˜ì— ë„£ì–´ì£¼ê³  ì‹¶ì„ ë•ŒëŠ” ìœ„ì™€ ê°™ì´ ì‚¼í•­ì—°ì‚°ìë¥¼ ê²¹ê²¹ì´ ìŒ“ì•„ê°€ë©° ì‚¬ìš©í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ì œ `if-else` êµ¬ë¬¸ìœ¼ë¡œ ì½ê¸° ì‰½ê²Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```swift
let bullet = 
  if isRoot && (count == 0 || !willExpand) { "" }
  else if count == 0 { "- " }
  else if maxDepth <= 0 { "â–¹ " }
  else { "â–¿ " }
```

ì´ ë°©ì‹ì´ íŠ¹íˆë‚˜ íš¨ê³¼ë¥¼ ë³´ëŠ” ê³³ì€ ì „ì—­ ë³€ìˆ˜ë‚˜ ì €ì¥ í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•  ë•Œì…ë‹ˆë‹¤.

```swift
let attributedName = {
  if let displayName, !displayName.isEmpty {
    AttributedString(markdown: displayName)
  } else {
    "Untitled"
  }
}()      
```

ì „ì—­ ë³€ìˆ˜ë‚˜ ì €ì¥ í”„ë¡œí¼í‹°ì— ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ê°’ì„ ë„£ì–´ì£¼ê¸° ìœ„í•´ì„œëŠ” ì´ë ‡ê²Œ ë°”ë¡œ í˜¸ì¶œë˜ëŠ” í´ë¡œì €ë¥¼ í†µí•´ì•¼ë§Œ í–ˆìŠµë‹ˆë‹¤.

```swift
let attributedName =
    if let displayName, !displayName.isEmpty {
    AttributedString(markdown: displayName)
  } else {
    "Untitled"
  }
```

í•˜ì§€ë§Œ ì´ì œ `if-else` êµ¬ë¬¸ì„ í‘œí˜„ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í´ë¡œì €ê°€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.

### Result Builders

Result Builderê°€ ë­ëƒë©´ìš”..

ì €ë„ ì´ë²ˆì— ì²˜ìŒ ì•Œì•„ë³´ê²Œ ë˜ì—ˆëŠ”ë°ìš”.. WWDC21ì—ì„œ ë°œí‘œë˜ì—ˆë˜ ë‚´ìš©ì´ë”ë¼êµ¬ìš”..!?

```swift
image.constraints { view in
  view.centerXAnchor == container.centerXAnchor
  view.topAnchor == container.topAnchor + 20
  view.widthAnchor == container.widthAnchor -- 20
  view.heightAnchor == view.widthAnchor * 0.6      
}
```

ë§ˆì¹˜ ì´ë ‡ê²Œ SwiftUIì˜ í˜•íƒœì²˜ëŸ¼ **ì„ ì–¸í˜•ìœ¼ë¡œ ê°’ì„ ì„¤ì •**í•´ì¤„ ìˆ˜ ìˆëŠ” ë¬¸ë²•ì…ë‹ˆë‹¤.

**DSL(Domain Specific Language)** ë¼ê³  ë¶ˆë¦¬ëŠ”ë°ìš”..

ì œê°€ ì˜ ëª¨ë¥´ê¸° ë•Œë¬¸ì—â€¦ ğŸ˜…

ì•„ë¬´íŠ¼ íƒ€ì… ì²´í‚¹ì´ ë¹¨ë¼ì§€ê³  ì—ëŸ¬ê°€ ì¢€ ë” ì •í™•í•œ ì§€ì ì— í‘œì‹œëœë‹¤ê³  í•©ë‹ˆë‹¤.

### Type Parameter Packs

ì´ ë¶€ë¶„ì€ **Generic**ê³¼ ê´€ë ¨ëœ ë‚´ìš©ì…ë‹ˆë‹¤.

Swiftì˜ ëª¨ë“  ê³³ì€ Genericì´ë¼ê³ ë„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë°°ì—´ë§Œë´ë„ ì‚¬ì‹¤ì€ `Array<Element>`ë¼ëŠ” Genericì„ í™œìš©í•œ íƒ€ì…ì´ì£ !?

```swift
struct Request<Result> { ... }

struct RequestEvaluator {
  func evaluate<Result>(_ request: Request<Result>) -> Result
}

func evaluate(_ request: Request<Bool>) -> Bool {
  return RequestEvaluator().evaluate(request)
}
```

ì—¬ê¸° `Bool` íƒ€ì…ì˜ ê°’ì„ í•˜ë‚˜ë§Œ ë°›ëŠ” í•¨ìˆ˜ `evaluate`ê°€ ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì—¬ëŸ¬ê°œì˜ ê°’ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ê³  ì‹¶ì„ ë•Œë„ ìˆê² ì£ ?

```swift
let value = RequestEvaluator().evaluate(request)
let (x, y) = RequestEvaluator().evaluate(r1, r2)
let (x, y, z) = RequestEvaluator().evaluate(r1, r2, r3)
```

ë¬¸ì œëŠ” ì´ë ‡ê²Œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´..

```swift
func evaluate<Result>(_:) -> (Result)
func evaluate<R1, R2>(_:_:) -> (R1, R2)
func evaluate<R1, R2, R3>(_:_:_:) -> (R1, R2, R3)
func evaluate<R1, R2, R3, R4>(_:_:_:_:)-> (R1, R2, R3, R4)
func evaluate<R1, R2, R3, R4, R5>(_:_:_:_:_:) -> (R1, R2, R3, R4, R5)
func evaluate<R1, R2, R3, R4, R5, R6>(_:_:_:_:_:_:) -> (R1, R2, R3, R4, R5, R6)
```

ì´ë ‡ê²Œ ë”ì°í•˜ê²Œ ê° íŒŒë¼ë¯¸í„°ì˜ ê°œìˆ˜ì— ë§ëŠ” í•¨ìˆ˜ë“¤ì„ ì—¬ëŸ¬ë²ˆ ì˜¤ë²„ë¡œë“œí•˜ë©° ì •ì˜í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

![](https://i.imgur.com/BNkOqNg.png)

ì´ê±¸ ë³´ìë§ˆì RxSwiftì˜ `combineLatest`ê°€ ìƒê°ë‚˜ë”êµ°ìš”â€¦

ë”± ì´ëŸ´ë•Œì˜ ê²½ìš°ì…ë‹ˆë‹¤.

ì´ ë°©ë²•ì€ ë³´ê¸°ì—ë„ ì•ˆì¢‹ì„ ë¿ë”ëŸ¬, **ì œê³µí•˜ëŠ” íŒŒë¼ë¯¸í„°ì˜ ê°œìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ìª½ì—ì„œ ë›°ì–´ë„˜ìœ¼ë©´** ë‹¹ì—°í•˜ê²Œë„ ì»´íŒŒì¼ëŸ¬ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Swiftì˜ **Generic**ì— **ì œê³µëœ ì¸ìì˜ ê°œìˆ˜ë³´ë‹¤ ë§ì€ ìˆ˜ì˜ ê°’**ì„ ë°›ì•„ë‚¼ ìˆ˜ ìˆëŠ” ìƒˆë¡œìš´ ë¬¸ë²•ì´ ë„ì…ë˜ì—ˆìŠµë‹ˆë‹¤.

ìƒˆë¡œìš´ `each` í‚¤ì›Œë“œëŠ” Generic íƒ€ì…ì„ ì¶©ì¡±í•˜ëŠ” **ë‹¤ì–‘í•œ ê°œìˆ˜ì˜ ì¸ìë“¤ì„ â€œpackedâ€ëœ ìƒíƒœ** ë¡œ ë°›ì„ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

```swift
func evaluate<each Result>(_: repeat Request<each Result>) -> (repeat each Result)   
```

í•˜ë‚˜ì˜ íŒŒë¼ë¯¸í„° `Request<Result>` ëŒ€ì‹  ì—¬ëŸ¬ê°œì˜ íŒŒë¼ë¯¸í„°ë¥¼ ë°˜ë³µí•´ì„œ ë°›ëŠ”ë‹¤ëŠ” ì˜ë¯¸ë¡œ `repeat Request<each Result>` ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

ë°˜í™˜í•˜ëŠ” ê°’ì€ ì¸ìê°€ í•˜ë‚˜ì¼ ê²½ìš° í•˜ë‚˜ì˜ ê°’ì„, ì—¬ëŸ¬ ê°œì¼ ê²½ìš° ì—¬ëŸ¬ ê°œì˜ ê°’ì€ Tuple `(repeat each Result)` ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì‚¬ìš©í•˜ëŠ” ìª½ì—ì„œëŠ” ì–´ë–¨ê¹Œìš”?

```swift
let results = RequestEvaluator.evaluate(r1, r2, r3)
```

**Type Parameter Packs API**ë¥¼ ì‚¬ìš©í–ˆëŠ”ì§€ ì¡°ì°¨ ì•Œ ìˆ˜ ì—†ì„ ì •ë„ë¡œ ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤..!

## Swift Macros

ëŒ€ë§ì˜ ë§¤í¬ë¡œì…ë‹ˆë‹¤..

`assert`ì—ì„œë¶€í„° ì‹œì‘í•˜ê³  ìˆë„¤ìš”.

`assert`ëŠ” ì¡°ê±´ë¬¸ì´ `false`ì¼ ë•Œ, í”„ë¡œê·¸ë¨ì„ ìë™ìœ¼ë¡œ ì¢…ë£Œì‹œí‚¤ì£ .

```swift
assert(max(a, b) == c)
```

![](https://i.imgur.com/07v4MCp.png)

ë¬¸ì œëŠ” ìœ„ì™€ ê°™ì€ ë°©ì‹ì€ í”„ë¡œê·¸ë¨ì„ ê·¸ëƒ¥ ì¢…ë£Œì‹œì¼œë²„ë¦¬ê³ , ì¢…ë£Œëœ ë¼ì¸ë§Œì„ ë¡œê·¸ì— ë‚¨ê¸´ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì• í”Œì€ ë‹¤ë¥¸ ì—¬ëŸ¬ê°€ì§€ `assert` ë°©ì‹ë“¤ì„ ì¶”ê°€í•´ì¤¬ìŠµë‹ˆë‹¤.

![](XCAssertEqual(max(a, b), c))

![](https://i.imgur.com/midJKz4.png)

`XCAssertEqual`ì€ ì¢€ ë” ë‚˜ì€ ë¡œê·¸ë¥¼ ë‚¨ê²¨ì¤ë‹ˆë‹¤. ì•„ê¹Œë³´ë‹¤ëŠ” í›¨ì”¬ ë‚«ê¸´ í•˜ì§€ë§Œ ì—¬ì „íˆ `a`, `b`, í˜¹ì€ `max(a, b)` ì¤‘ì—ì„œ ì–´ë–¤ ê°’ì´ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ëŠ”ì§€ëŠ” ì—¬ì „íˆ ì•Œ ìˆ˜ê°€ ì—†ì£ .

í•˜ì§€ë§Œ ì´ì œëŠ” **Macro**ë¥¼ ì‚¬ìš©í•´ì„œ ì´ë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
#assert(max(a, b) == c)
```

![](https://i.imgur.com/ehe3hwP.png)

ë§¤í¬ë¡œëŠ” ë‹¤ë¥¸ APIë“¤ê³¼ ë¹„ìŠ·í•˜ê²Œ íŒ¨í‚¤ì§€ì˜ í˜•íƒœë¡œ `import`í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œ ì‚¬ìš©í•œ `#assert` ë§¤í¬ë¡œëŠ” PowerAssertë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„¤ìš”.

ğŸ“ [PowerAssert](https://github.com/kishikawakatsumi/swift-power-assert)

### Macro Declarations

ì´ë¦„ì´ ë§¤í¬ë¡œë¼ë©´ ë‚´ê°€ ì§ì ‘ ì›í•˜ëŠ” í˜•íƒœì˜ ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì–´ì•¼ê² ì£ ?

`macro` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ë§¤í¬ë¡œë¥¼ ì •ì˜í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
public macro assert(_ condition: Bool)
```

í•¨ìˆ˜ì™€ ìƒë‹¹íˆ ë¹„ìŠ·í•˜ê²Œ ìƒê²¼ì£ ..?

í•¨ìˆ˜ì™€ ë™ì¼í•˜ê²Œ ì •ì˜í•´ì¤„ ìˆ˜ ìˆê³ , í•¨ìˆ˜ì™€ ë§ˆì°¬ê°€ì§€ë¡œ íƒ€ì… ì²´í¬ë„ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì´ `assert` ë§¤í¬ë¡œë¥¼

```swift
#assert(max(a, b))
```

ì´ë ‡ê²Œ ì˜ ëª» ì‚¬ìš©í•˜ë©´?

![](https://i.imgur.com/K5FdL8w.png)

```swift
public macro assert(_ condition: Bool) = #externalMacro(
  module: "PowerAssertPlugin",
  type: "PowerAssertMacro"
)     
```

ëŒ€ë¶€ë¶„ì˜ ë§¤í¬ë¡œëŠ” **â€œExternal Macrosâ€** ë¼ê³  í•©ë‹ˆë‹¤.

ì»´íŒŒì¼ëŸ¬ëŠ” ë§¤í¬ë¡œë¥¼ `String`ìœ¼ë¡œ ì œê³µë˜ëŠ” `module` ì •ë³´ì™€ `type` ì •ë³´ë¥¼ í†µí•´ ì‹ë³„í•œë‹¤ê³  í•˜ë„¤ìš”..

![](https://i.imgur.com/UoYsO85.png)

ë§¤í¬ë¡œëŠ” ì»´íŒŒì¼ëŸ¬ í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ì‘ë™í•˜ë©° ì•±ê³¼ëŠ” **ë³„ë„ì˜ í”„ë¡œê·¸ë¨** ìœ¼ë¡œì¨ ì‹¤í–‰ëœë‹¤ê³  í•©ë‹ˆë‹¤.

ì»´íŒŒì¼ëŸ¬ëŠ” í”ŒëŸ¬ê·¸ì¸ì—ê²Œ ë§¤í¬ë¡œë¥¼ ì „ë‹¬í•˜ê³ , í”ŒëŸ¬ê·¸ì¸ì´ ë§¤í¬ë¡œì— ëŒ€ì‘ë˜ëŠ” ì†ŒìŠ¤ì½”ë“œë¥¼ ì»´íŒŒì¼ëŸ¬ì—ê²Œ ì œê³µí•˜ê³  ìˆë„¤ìš”.

ë§¤í¬ë¡œì—ê²Œ í•„ìš”í•œ ë§ˆì§€ë§‰ ì •ë³´ëŠ” ê·¸ë“¤ì˜ **ì—­í• (role)** ì…ë‹ˆë‹¤.

### Freestanding Macros

```swift
@freestanding(expression)
public macro assert(_ condition: Bool) = #externalMacro(
  module: "PowerAssertPlugin",
  type: "PowerAssertMacro"
)        
```

`#assert` ë§¤í¬ë¡œëŠ” `@freestanding(expression)` ë§¤í¬ë¡œì¸ë°ìš”..

**freestanding** ì€ â€œ#â€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ëŒ€ì‘ë˜ëŠ” ì½”ë“œë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì‚½ì…í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.

**expression** ì€ ê²°ê³¼ê°’ì´ ìˆëŠ” ê·¸ ì–´ëŠê³³ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš©ë˜ì—ˆë‹¤ê³  í•˜ë„¤ìš”.

```swift
@freestanding(exrpession)
public macro Predicate<each Input>(
  _ body: (repeat each Input) -> Bool
) -> Predicate<repeat each Input>

let pred = #Predicate<Person> {
  #0.favoriteColor == .blue
}
let blueLovers = people.filter(pred)    
```

expression ë§¤í¬ë¡œì—ëŠ” `#Predicate` ë¼ëŠ” ë§¤í¬ë¡œë„ ìˆìŠµë‹ˆë‹¤.

`#Predicate` ë§¤í¬ë¡œëŠ” í´ë¡œì € ì•ˆì—ì„œ type-safeí•˜ê²Œ Predicateë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤ê³  í•˜ë„¤ìš”.

### Attached Macros

ë˜ í˜•íƒœì˜ ë§¤í¬ë¡œë„ ìˆìŠµë‹ˆë‹¤.

ì˜ˆì‹œë¡œ ì‚¬ìš©í•  `enum`ì„ ì‚¬ìš©í•  ê²½ìš°ì¸ë°ìš”.

```swift
enum Path {
  case relative(String)
  case absolute(String)
}

extension Path {
  var isAbsolute: Bool {
    if case .absolute = self { true }
    else { false }
  }
}

extension Path {
  var isRelative: Bool {
    if case .relative = self { true }
    else { false }
  }
}

let absPaths = paths.filter { $0.isAbsolute }        
```

`enum`ì˜ `case`ë¥¼ ê²€ì‚¬í•  ë•Œ ë³´í†µ ì´ë ‡ê²Œ ë§ì´ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

ì´ëŸ° ë°©ì‹ì€ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. `case`ê°€ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì ì  ë” ê¸¸ì–´ì§€ëŠ” ë°©ì‹ì˜ ì½”ë“œë¼ëŠ” ê²ƒì´ì£ .

```swift
@CaseDetection
enum Path {
  case relative(String)
  case absolute(String)
}

let absPaths = paths.filter { $0.isAbsolute }
```

`@CaseDetctio`nì€ **â€œAttached Macrosâ€** ì…ë‹ˆë‹¤.

Property Wrapperì™€ ë™ì¼í•˜ê²Œ **â€œ@â€œ** ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë„¤ìš”!

ì´ `@CaseDetection` ë§¤í¬ë¡œëŠ” ì´ì „ì˜ `isAbsolute`ì™€ `isRelative` í”„ë¡œí¼í‹°ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ì¤ë‹ˆë‹¤.

![](https://i.imgur.com/4WYMXt5.png)
**
Attached Macros** ëŠ” ë‹¤ì„¯ ê°€ì§€ ì¢…ë¥˜ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆê³ , ê°ê°ì˜ ì—­í• ì€ ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤.

- **member**
  - `type` / `extension`ìœ¼ë¡œ ìƒˆë¡œìš´ ì •ì˜ë¥¼ ì¶”ê°€
  - ex) `@CaseDetection`

- **peer**
  - ì •ì˜ëœ í‘œí˜„ê³¼ í•¨ê»˜ ë‹¤ë¥¸ í‘œí˜„ìœ¼ë¡œì¨ ì •ì˜ë¥¼ ì¶”ê°€
  - ex) `async` ë©”ì„œë“œì™€ ê°™ì€ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” completion handler ë²„ì „ì˜ ë©”ì„œë“œ ì¶”ê°€

- **accessor**
  - í”„ë¡œí¼í‹°ì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹ì„ ì¶”ê°€ (Property Wrapperì™€ ìœ ì‚¬)
  - ex) ì €ì¥ í”„ë¡œí¼í‹°ë¥¼ ì—°ì‚° í”„ë¡œí¼í‹°ë¡œ ë³€ê²½

- **memberAttribute**
  - `type` / `extension`ìœ¼ë¡œ ì†ì„±(attribute)ë¥¼ ì¶”ê°€

- **conformance**
  - `type` / `extension`ìœ¼ë¡œ í”„ë¡œí† ì½œì„ ì¶©ì¡±ì‹œí‚¤ê¸° ìœ„í•œ ìš”ì†Œ ì¶”ê°€

ì¼ë°˜ì ì¸ APIì™€ ë‹¤ë¥´ê²Œ ë§¤í¬ë¡œê°€ ì¢‹ì€ ì ì€, ì½”ë“œì—ì„œ ë°”ë¡œ **ì–´ë–¤ ì½”ë“œ** ê°€ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì§€ í™•ì¸í•  ìˆ˜ ìˆê³ , **ë””ë²„ê·¸ ê³¼ì •ì—ì„œ ì§„ì…** í•  ìˆ˜ ìˆìœ¼ë©°, ë§¤í¬ë¡œ ì˜ì—­ ë°”ê¹¥ìœ¼ë¡œ ë³µë¶™í•˜ëŠ” ê²ƒìœ¼ë¡œ **ì‰½ê²Œ ìˆ˜ì •** í•  ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

**Attached Macros** ë“¤ì€ ë™ì‹œì— ì—¬ëŸ¬ê°œê°€ ì‚¬ìš©ë ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì˜ˆì‹œë¡œ SwiftUIì˜ ì½”ë“œë¥¼ ë“¤ê³  ìˆëŠ”ë°ìš”.. ë¬´ìŠ¨ ì˜ë¯¸ì¸ì§€ëŠ” ì•Œ ê²ƒ ê°™ì•„ì„œ í•œ ë²ˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

```swift
// Observation in SwiftUI
final class Person: ObservableObject {
  @Published var name: String
  @Published var age: Int
  @Published var isFavorite: Bool
}

struct ContentView: View {
  @ObservedObject var person: Person
    
  var body: some View {
    Text("Hello, \(person.name)")
  }
}
```

ì´ëŸ° í˜•íƒœì˜ í´ë˜ìŠ¤ê°€ ìˆëŠ”ë°ìš”, `Person`ì˜ ê° í”„ë¡œí¼í‹°ë“¤ì˜ ë³€í™”ë¥¼ ë°›ì•„ `ContentView`ì˜ ë‚´ìš©ì„ ì—…ë°ì´íŠ¸í•´ì£¼ëŠ” ì½”ë“œ ê°™ìŠµë‹ˆë‹¤.

ë¬¸ì œëŠ” ë°˜ë³µë˜ëŠ” `@Published`, `ObservableObject` í”„ë¡œí† ì½œ ë“± í•„ìš”í•œ ë¶€ê°€ì‘ì—…ë“¤ì´ ë„ˆë¬´ ë§ë‹¤ëŠ” ê²ƒì´ì£ .

ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•˜ë©´ ì´ ê³¼ì •ë“¤ì„ í•˜ë‚˜ë¡œ ì¶•ì†Œì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
// Observation in SwiftUI
@Observable final class Person {
  var name: String
  var age: Int
  var isFavorite: Bool
}

struct ContentView: View {
  var person: Person
    
  var body: some View {
    Text("Hello, \(person.name)")
  }
}
```

`@Observable` í•˜ë‚˜ë©´ ëª¨ë“  ì‘ì—…ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤.

ë‚´ë¶€ë¥¼ í•œ ë²ˆ ì‚´í´ë³¼ê¹Œìš”?

```swift
@attached(member, names: ...)
@attached(memberAttribute)
@attached(conformance)
public macro Observable() = #externalMacro(...).
```

1. `member` roleì„ í†µí•´ ìƒˆë¡œìš´ í”„ë¡œí¼í‹°ë“¤ê³¼ ë©”ì„œë“œë“¤ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
2. `memberAttribute` roleì„ í†µí•´ `@ObservationTracked` ë§¤í¬ë¡œë¥¼ ê° ì €ì¥ í”„ë¡œí¼í‹°ì— ì¶”ê°€í•˜ê³  `getter`ì™€ `setter`ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
3. `Observable` í”„ë¡œí† ì½œì„ ì±„íƒí•©ë‹ˆë‹¤.

ë§¤í¬ë¡œë¥¼ í¼ì¹œ í˜•íƒœì˜ ì½”ë“œëŠ” ì´ë ‡ìŠµë‹ˆë‹¤.

```swift
@Observable final class Person: Observable {
  @ObservationTracked var name: String { get { â€¦ } set { â€¦ } }
  @ObservationTracked var age: Int { get { â€¦ } set { â€¦ } }
  @ObservationTracked var isFavorite: Bool { get { â€¦ } set { â€¦ } }
  
  internal let _$observationRegistrar = ObservationRegistrar<Person>()
  internal func access<Member>(
    keyPath: KeyPath<Person, Member>
  ) {
    _$observationRegistrar.access(self, keyPath: keyPath)
  }
  internal func withMutation<Member, T>(
    keyPath: KeyPath<Person, Member>,
    _ mutation: () throws -> T
  ) rethrows -> T {
    try _$observationRegistrar.withMutation(of: self, keyPath: keyPath, mutation)
  }
}
```

ë§¤í¬ë¡œì— ëŒ€í•´ì„œëŠ” í•œ ë²ˆ ê´€ë ¨ ì„¸ì…˜ì„ ì‚´í´ë³´ë©´ì„œ ê³µë¶€í•´ë´ì•¼ê² ë„¤ìš”.

ìƒˆë¡œìš´ íŒ¨ëŸ¬ë‹¤ì„ì˜ ì‹œì‘ì¼ ë“¯í•œ ëŠë‚Œ..!

## Swift Foundation

ìµœê·¼ ì• í”Œì´ Foundation ì½”ë“œë“¤ì„ Swiftë¡œ ë‹¤ì‹œ ì“°ëŠ” í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í–ˆë‹¤ê³  í•©ë‹ˆë‹¤.

ê¸°ì¡´ì˜ C, Obj-C ì½”ë“œë“¤ì„ Swiftë¡œ êµì²´í•˜ê³  ìˆë‹¤ê³  í•˜ë„¤ìš”..

ì´ë²ˆ ë²„ì „ì—ëŠ” `Date`, `Calendar`, `Locale`, `AttributedString`, JSON `encode` / `decode`ê°€ Swiftë¡œ ë‹¤ì‹œ ì“°ì—¬ì¡Œë‹¤ê³  í•©ë‹ˆë‹¤.

![](https://i.imgur.com/dHcf3vk.png)

ë„¤.. ê·¸ë ‡ë‹¤ê³  í•©ë‹ˆë‹¤..

ë„˜ì–´ê°€ì£ !

## Ownership

ì–´ë–¤ ê°’ì„ ì–´ë–¤ ì½”ë“œê°€ ì†Œìœ í•˜ê³  ìˆëŠ” ì§€ì— ëŒ€í•œ ì¶”ì ì´ ê°€ëŠ¥í•´ì¡Œë‹¤ê³  í•©ë‹ˆë‹¤.

ì €ëŠ” ì½”ë“œ ì‘ì„±ìê°€ ëˆ„êµ°ì§€ ì‹œê·¸ë‹ˆì²˜ ê°™ì€ ê±¸ ë‚¨ê²¨ë‘ëŠ” ê±´ ì¤„ ì•Œì•˜ëŠ”ë°, ì „í˜€ ë‹¤ë¥¸ ê¸°ëŠ¥ì´ì˜€ë„¤ìš”.

```swift
struct FileDescriptor {
  private var fd: CInt
  
  init(descriptor: CInt) { self.fd = descriptor }

  func write(buffer: [UInt8]) throws {
    let written = buffer.withUnsafeBufferPointer {
      Darwin.write(fd, $0.baseAddress, $0.count)
    }
    // ...
  }

  func close() {
    Darwin.close(fd)
  }
}
```

ì´ ì½”ë“œëŠ” ìœ„í—˜ì„±ì´ ìˆìŠµë‹ˆë‹¤.

íŒŒì¼ ìˆ˜ì •ì„ ë§ˆì¹œ í›„ì— `close()`ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†í›„í•˜ì£ .

`FileDescriptor`ë¥¼ í´ë˜ìŠ¤ë¡œ ë°”ê¾¸ê³  `deinit` ì‹œì ì— `close()`ë¥¼ í˜¸ì¶œí•´ì¤˜ë„ ë˜ì§€ë§Œ, í´ë˜ìŠ¤ëŠ” reference íƒ€ì…ì´ê¸° ë•Œë¬¸ì— í•˜ë‚˜ì˜ íŒŒì¼ì„ ê´€ë¦¬í•˜ëŠ” ì¸¡ë©´ì—ì„œëŠ” ìœ„í—˜ì„±ì´ í½ë‹ˆë‹¤.

```swift
struct FileDescriptor: ~Copyable {
  private var fd: CInt
  
  init(descriptor: CInt) { self.fd = descriptor }

  func write(buffer: [UInt8]) throws {
    let written = buffer.withUnsafeBufferPointer {
      Darwin.write(fd, $0.baseAddress, $0.count)
    }
    // ...
  }
  
  consuming func close() {
    Darwin.close(fd)
  }
  
  deinit {
    Darwin.close(fd)
  }
}
```

ê·¸ë˜ì„œ ë“±ì¥í•œ ê²ƒì´ **Non-Copyable** `struct` ì…ë‹ˆë‹¤.

**~Copyable** ì„ ë¶™ì—¬ì£¼ë©´, í´ë˜ìŠ¤ì™€ ë§ˆì°¬ê°€ì§€ë¡œ `deinit`ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

ì¶”ê°€ì ìœ¼ë¡œ `consuming` ì´ë¼ëŠ” í‚¤ì›Œë“œë„ ë“±ì¥í–ˆëŠ”ë°ìš”, í•´ë‹¹ í‚¤ì›Œë“œê°€ ë‹¬ë¦° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•¨ìœ¼ë¡œì¨ êµ¬ì¡°ì²´ì— ëŒ€í•œ ì†Œìœ ê¶Œì„ í¬ê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Non-Copyable êµ¬ì¡°ì²´ëŠ” ë³µì‚¬ë  ìˆ˜ ì—†ìœ¼ë‹ˆ, ì†Œìœ ê¶Œì„ í¬ê¸°í•˜ê²Œ ë˜ë©´ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” ê°’ì´ ë˜ê² ì£ ?

ê·¸ë˜ì„œ `consuming` í•¨ìˆ˜ëŠ” í´ë˜ìŠ¤ë¥¼ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œí•˜ëŠ” ê²ƒì²˜ëŸ¼ êµ¬ì¡°ì²´ë¥¼ **ë©”ëª¨ë¦¬ì—ì„œ í•´ì œ** ì‹œí‚µë‹ˆë‹¤.

## Whatâ€™s new in Swift Concurrency

**Custom Actor Executors** ë¼ëŠ” ë…€ì„ì´ ìƒˆë¡­ê²Œ ë‚˜ì™”ìŠµë‹ˆë‹¤.

ê¸°ì¡´ì˜ Actorë¼ëŠ” ë†ˆì€ ììœ ë¡­ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë…€ì„ì€ ì•„ë‹ˆì˜€ì£ ?

ì´ì œ Actorë¥¼ íŠ¹ì • **DispatchQueue** ì— í• ë‹¹ì‹œí‚¬ ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.

```swift
actor MyConnection {
  private var database: UnsafeMutablePointer<sqlite3>
  private let queue: DispatchSerialQueue

  nonisolated var unownedExecutor: UnownedSerialExecutor { queue.asUnownedSerialExecutor() }

  init(filename: String, queue: DispatchSerialQueue) throws { â€¦ }
  
  func pruneOldEntries() { â€¦ }
  func fetchEntry<Entry>(named: String, type: Entry.Type) -> Entry? { â€¦ }
}

await connection.pruneOldEntries()
```

`unownedExecutor`ë¥¼ ì´ë ‡ê²Œ ì§€ì •í•´ì£¼ë©´, ëª¨ë“  Synchronizationì´ í•´ë‹¹ queueì—ì„œë§Œ ì´ë£¨ì–´ì§„ë‹¤ê³  í•˜ë„¤ìš”.

ë‹¨ìˆœíˆ `await connection.pruneOldEntries()`ë¥¼ í˜¸ì¶œí•´ì£¼ëŠ” ê²ƒ ë§Œìœ¼ë¡œë„ ì§€ì •ëœ `queue`ì—ì„œ `async`í•˜ê²Œ ë™ì‘í•œë‹¤ëŠ” ê²ƒì´ì£ !

ì´ì œ Realmì„ ë‹¤ë£¨ê¸° ì¢€ ë” ì‰¬ì›Œì§€ëŠ” ê±¸ê¹Œìš”.. ìµœê·¼ì— ì´ê±¸ë¡œ ê³ ë¯¼ì„ ë§ì´ í–ˆëŠ”ë° ë§ì´ì£ ..

```swift
// Executor protocols

protocol Executor: AnyObject, Sendable {
  func enqueue(_ job: consuming ExecutorJob)
}

protocol SerialExecutor: Executor {
  func asUnownedSerialExecutor() -> UnownedSerialExecutor
  func isSameExclusiveExecutionContext(other executor: Self) -> Bool
}

extension DispatchSerialQueue: SerialExecutor { â€¦ }
```

ì•„ë¬´íŠ¼ ì´ ìƒˆë¡œìš´ ë™ì‘ì€ DispatchQueueê°€ ìƒˆë¡œìš´ `SerialExecutor` í”„ë¡œí† ì½œì„ ë”°ë¥´ê¸° ë•Œë¬¸ì— ê°€ëŠ¥í–ˆë‹¤ê³  í•©ë‹ˆë‹¤.

`isSameExclusiveExecutionContext(other executor:) -> Bool`ì„ í†µí•´ ì´ë¯¸ í•´ë‹¹ ì½”ë“œê°€ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì§€ë¥¼ ê²€ì‚¬í•˜ê³ , `asUnownedSerialExecutor() -> UnownedSerialExecutor`ë¥¼ í†µí•´ `Executor`ì˜ `unowned` ì°¸ì¡°ë¥¼ ê°€ì ¸ì˜¨ë‹¤ê³  í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ê°€ì¥ ì¤‘ìš”í•œ `enqueue(_ job:)` ë¥¼ í†µí•´ `Executor`ì˜ **Job** ë“¤ì„ ê´€ë¦¬í•œë‹¤ê³  í•˜ë„¤ìš”.

ì—¬ê¸°ì„œ **Job** ì´ë€ `Executor`ì—ì„œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•  ë™ê¸° Taskë¼ê³  í•©ë‹ˆë‹¤.

ì†”ì§íˆ ë¬´ìŠ¨ ë§ì¸ì§€ ë„ˆë¬´ í—·ê°ˆë¦¬ë„¤ìš”â€¦ ğŸ˜…

ê²°ë¡ ì€ ì´ì œ â€œ**Actor** ì—ì„œ **DispatchQueue** ë¥¼ ì§€ì •í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ì´ëŠ” DispatchQueueê°€ ìƒˆë¡œìš´ `SerialExecutor` í”„ë¡œí† ì½œì„ ë”°ë¥´ê¸° ë•Œë¬¸ì´ë‹¤. `SerialExecutor` í”„ë¡œí† ì½œì€ dispatch asyncë¥¼ í¬í•¨í•œ ì—¬ëŸ¬ **Job** ë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ `queue` ë¥¼ í†µí•´ ìˆ˜í–‰í•´ë‚˜ê°€ëŠ” ì‘ì—…ì„ í•œë‹¤.â€ ë¼ê³  ì´í•´í•˜ê³  ë„˜ì–´ê°€ë ¤ê³  í•©ë‹ˆë‹¤.

---

ì™€ìš°..

ë’¤ë¡œ ê°ˆìˆ˜ë¡ ì •ì‹ ì´ ì•„ë“í•´ì§ˆ ë»” í–ˆì§€ë§Œ.. í•œ ë²ˆ ì­‰ í›‘ì–´ë³´ê¸´ í–ˆìŠµë‹ˆë‹¤..

ë‹¹ì¥ ì €ì—ê²Œ ì œì¼ ì¤‘ìš”í–ˆë˜ ë‚´ìš©ë“¤ì€

1. Macros
2. Type Parameter Packs
3. DispatchQueue in Actor

ì´ë ‡ê²Œì¸ ê²ƒ ê°™ì•„ìš”!

íŠ¹íˆë‚˜ ë§¤í¬ë¡œëŠ” ì œëŒ€ë¡œ í•œ ë²ˆ ì‚´í´ë´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤..