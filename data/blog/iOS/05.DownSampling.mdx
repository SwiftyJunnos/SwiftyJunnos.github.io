---
title: 'ğŸ“± iOS - ë‹¤ìš´ìƒ˜í”Œë§'
date: '2022-12-26'
tags: ['Swift', 'iOS']
draft: false
summary: 'ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ê³ í•´ìƒë„ ì´ë¯¸ì§€ëŠ” ì“¸ ëª¨ ì—† ë‹¤.'
---

# ë‹¤ìš´ìƒ˜í”Œë§ìœ¼ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì¸ ì´ë¯¸ì§€ ì²˜ë¦¬í•˜ê¸°

ì´ì „ ê²Œì‹œë¬¼ì—ì„œ ì•Œì•„ë³´ì•˜ë˜ `PHPicker`ë¥¼ ì‚¬ìš©í•´ì„œ ì´ë¯¸ì§€ë¥¼ ì²˜ë¦¬í•˜ë˜ ì¤‘ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ë¥¼ ë§ˆì£¼ì³¤ìŠµë‹ˆë‹¤.

![](https://i.imgur.com/PIZF0mw.png)

Swiftê°€ í—ˆìš©í•œ 4,194,304 ë°”ì´íŠ¸ë³´ë‹¤ í° ë°ì´í„°ë¥¼ UserDefaultsì— ì €ì¥í•  ìˆ˜ ì—†ë‹¤ëŠ” ì—ëŸ¬ì…ë‹ˆë‹¤.

UserDefaultsëŠ” ì‘ì€ ë°ì´í„°ë“¤ì„ ì €ì¥í•  ëª©ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê²ƒì´ê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì€ ì—ëŸ¬ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ í˜„ìƒì¸ ë“¯ í•©ë‹ˆë‹¤.

ì§€ê¸ˆ ì €ì¥í•˜ë ¤ëŠ” ì´ë¯¸ì§€ëŠ” ì›ë³¸ ì´ë¯¸ì§€ ê·¸ ìì²´ì˜€ìœ¼ë‹ˆ ë‹¹ì—°íˆ ìš©ëŸ‰ì´ ì»¸ì„ ê²ƒì´ê³ , ì´ë¯¸ì§€ì˜ ìš©ëŸ‰ì„ ì¤„ì´ë ¤ë©´ ë³´í†µ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ê² ë‹¤ëŠ” ìƒê°ë¶€í„° í•˜ê² ì£ ?

**ì´ë¯¸ì§€ í¬ê¸°ì˜ ì¶•ì†Œ**ëŠ” ê°€ì¥ ì§ê´€ì ìœ¼ë¡œ ì´ë¯¸ì§€ ìš©ëŸ‰ì„ ì¤„ì´ê³  ë©”ëª¨ë¦¬ ê°€ìš©ë¥ ë„ ë†’ì´ëŠ” ì¢‹ì€ ë°©ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì €ë„ ì´ë¯¸ì§€ë¥¼ ì¤„ì¼ ìˆ˜ ìˆëŠ” ë°©ë²•ë¶€í„° ì°¾ì•„ë³´ê²Œ ë˜ì—ˆì£ .

## ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆì‹œì˜ CPUì™€ ë©”ëª¨ë¦¬ ë™ì‘

í•˜ì§€ë§Œ ê³µë¶€ë¥¼ í•œ ì§€ ì–¼ë§ˆ ì§€ë‚˜ì§€ ì•Šì•„ ë‹¨ìˆœíˆ ì´ë¯¸ì§€ë¥¼ ì¤„ì´ëŠ” ë°©ë²•ì€ ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹ˆê³ , ì˜¤íˆë ¤ ì•±ì´ ê¸°ê¸°ì— ê³¼ë¶€í•˜ë¥¼ ë” ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤.

ê·¸ ê¹Œë‹­ì€ 2018ë…„ì— ì§„í–‰ëœ WWDC2018ì—ì„œ ì°¾ì•„ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

[Image and Graphics Best Practices - WWDC18 - Videos - Apple Developer](https://developer.apple.com/wwdc18/219)

ì´ë¯¸ ì´ë¯¸ì§€ ì²˜ë¦¬ ê²Œì‹œë¬¼ë“¤ì—ì„œ ë§ì´ ë‹¤ë£¨ê³  ìˆê³  iOSì˜ í™”ë©´ í‘œí˜„ ë°©ë²•ì„ í•™ìŠµí•´ë³¼ ìˆ˜ ìˆëŠ” ì„¸ì…˜ì…ë‹ˆë‹¤.

ì•„ë˜ëŠ” `UIGraphicsImageRenderer`ë¥¼ ì‚¬ìš©í•˜ì—¬ `PHPicker`ë¥¼ í†µí•´ ë°›ì€ ì´ë¯¸ì§€ ì—¬ëŸ¬ê°œì˜ í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

![](https://i.imgur.com/qZZB9BM.png)

```swift
var images: [UIImage] = []

var result in results {
  result.itemProvider.loadObject(ofClass: UIImage.self) { object, error in
    guard let image = object as? UIImage else { return }
    guard let resizedImage: UIImage = UIGraphicsImageRenderer(size: CGSize(width: 2_000, height: 2_000)).image { context in
      image.draw(in: CGRect(origin: CGPoint.zero, size: newSize))
    } else { return }
    images.append(resizedImage)
  }
}
```

ë‹¨ìˆœíˆ ë³´ê¸°ì—ëŠ” ì•„ë¬´ëŸ° ë¬¸ì œê°€ ì—†ì–´ë³´ì´ì£ .

ë¬¸ì œëŠ” ë‘ ë²ˆì— ê±¸ì³ì„œ ë°œìƒí•©ë‹ˆë‹¤.

### 1. ì›ë³¸ì„ ë¡œë“œí•œë‹¤.

```swift
guard let image = object as? UIImage else { return }
```

ì²« ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤.

ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆë¥¼ ì¤„ì´ëŠ” ëª©ì ì´ ë¬´ì—‡ì´ì˜€ë‚˜ìš”?

ë©”ëª¨ë¦¬ì— ë¶€í•˜ë¥¼ ëœ ì£¼ê¸° ìœ„í•´ì„œì˜€ì£ .

ìœ„ ë°©ë²•ì€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ë§Œ ëœë‹¤ë©´ ê·¸ ì´í›„ì—ëŠ” ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì„ ë‚®ì¶°ì¤„ê²ë‹ˆë‹¤.

ê·¸ëŸ°ë° ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ê¸° ìœ„í•´ì„œ ìš°ì„  ì›ë³¸ ì´ë¯¸ì§€ë¥¼ í•œ ë²ˆ ë¡œë“œí•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ í•œ ë²ˆ ë¡œë“œí•˜ëŠ” ê³¼ì •ì—ì„œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ë“¤ì„ ì¢…ë£Œì‹œí‚¤ê±°ë‚˜ ì‹¬í•˜ë©´ ì•± ìì²´ë¥¼ ì¢…ë£Œì‹œí‚¤ëŠ” í˜„ìƒì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‹¤ì œë¡œ ìœ„ ì½”ë“œë§Œ ë´ë„ `PHPicker`ëŠ” ì„ íƒí•œ ë°ì´í„°ë¥¼ `UIImage` íƒ€ì…ìœ¼ë¡œì„œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

êµ³ì´ í¬ê¸°ê°€ í° ê·¸ ë°ì´í„°ë¥¼ ì•„ë¬´ëŸ° ì²˜ë¦¬ ì—†ì´ `UIImage`ë¡œ ë°”ë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©í•˜ê³  ìˆì—ˆë˜ ê²ƒì´ì£ !

### 2. ì‘ì€ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ê·¸ë¦°ë‹¤.

```swift
image.draw(in: CGRect(origin: .zero, size: newSize))
```

ë‘ ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤.

ìœ„ ë°©ë²•ì€ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì™€ ê·¸ ì´ë¯¸ì§€ì˜ ì‘ì€ ë²„ì „ì„ `draw` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ê·¸ë ¤ì¤˜ì•¼ í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

ê·¸ë˜í”½ ì‘ì—…ì„ í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— CPUì™€ ë©”ëª¨ë¦¬ ë‘ í•˜ë“œì›¨ì–´ ëª¨ë‘ì—ê²Œ ì‘ì—…ì„ ë¶€ì—¬í•˜ëŠ” ê²ƒì´ê³ , ì´ ë˜í•œ ë©”ëª¨ë¦¬ ë¶€í•˜ë¥¼ ì¤„ì´ëŠ” ê²ƒê³¼ëŠ” ê±°ë¦¬ê°€ ë¨¼ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë‹¤ìš´ ìƒ˜í”Œë§

ê·¸ëŸ¬ë©´ ë‹¨ìˆœíˆ ì´ë¯¸ì§€ë¥¼ ë¦¬ì‚¬ì´ì§• í•˜ëŠ” ë°©ë²• ì™¸ì— ì–´ë–¤ ë°©ë²•ì´ ìˆì„ê¹Œìš”?

![](https://i.imgur.com/QEsP6KF.png)

ë°”ë¡œ ë°ì´í„°ë¥¼ `UIImage`ë¡œ ë°”ë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ `CGImage` íƒ€ì…ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë””ì½”ë”©í•  íŒŒì¼(data buffer) ìì²´ì˜ ì‚¬ì´ì¦ˆë¥¼ ì¤„ì´ëŠ” ë‹¤ìš´ìƒ˜í”Œë§ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

ë‹¤ë§Œ ì´ ë°©ë²•ì€ `Core Graphics`ì´ë¼ëŠ” í•œ ì¸µ ë” low-levelí•œ ë‚´ìš©ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œê°€ ì¢€ ë” ê¸¸ê³  ë³µì¡í•©ë‹ˆë‹¤.

```swift
func downsample(at url: URL, to pointSize: CGSize, scale: CGFloat) -> Data? {

  let sourceOptions = [kCGImageSourceShouldCache: false] as CFDictionary

  guard let source = CGImageSourceCreateWithURL(url as CFURL, sourceOptions) else { return nil }

  let maxDimensionInPixels = max(pointSize.width, pointSize.height) * scale

  let downsampleOptions = [
    kCGImageSourceCreateThumbnailFromImageAlways: true,
    kCGImageSourceCreateThumbnailWithTransform: true,
    kCGImageSourceThumbnailMaxPixelSize: maxDimensionInPixels
  ] as CFDictionary

  guard let cgImage = CGImageSourceCreateThumbnailAtIndex(source, 0, downsampleOptions) else { return nil }

  let data = NSMutableData()

  guard let imageDestination = CGImageDestinationCreateWithData(data, UTType.jpeg.identifier as CFString, 1, nil) else { return nil }

  let isPNG: Bool = {
    guard let utType = cgImage.utType else { return false }
    return (utType as String) == UTType.png.identifier
  }()

  let destinationProperties = [
    kCGImageDestinationLossyCompressionQuality: isPNG ? 1.0 : 0.75
  ] as CFDictionary

  CGImageDestinationAddImage(imageDestination, cgImage, destinationProperties)
  CGImageDestinationFinalize(imageDestination)

  return data as Data
}
```

> ì–´ì§ˆì–´ì§ˆí•˜ì¥¬..? ğŸ˜µ

ë³µì¡í•´ ë³´ì´ì§€ë§Œ ë‘ íŒŒíŠ¸ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•œ ë²ˆ ì‚´í´ë´…ì‹œë‹¤.

### 1. CGImage ìƒì„±

```swift
let sourceOptions = [kCGImageSourceShouldCache: false] as CFDictionary
guard let source = CGImageSourceCreateWithURL(url as CFURL, sourceOptions) else { return nil }

let maxDimensionInPixels = max(pointSize.width, pointSize.height) * scale
let downsampleOptions = [
  kCGImageSourceCreateThumbnailFromImageAlways: true,  
  kCGImageSourceShouldCacheImmediately: true,
  kCGImageSourceCreateThumbnailWithTransform: true,
  kCGImageSourceThumbnailMaxPixelSize: maxDimensionInPixels
] as CFDictionary

guard let cgImage = CGImageSourceCreateThumbnailAtIndex(source, 0, downsampleOptions) else { return nil }
```

downsamplingì˜ í•µì‹¬ì´ ë˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.

ì‚¬ì‹¤ìƒ í•„ìˆ˜ì ì¸ ë¡œì§ë“¤ì€ ì´ ì•ˆì— ë‹¤ ìˆìŠµë‹ˆë‹¤.

Option flagë¥¼ ì •ì˜í•´ì£¼ê³  í•´ë‹¹ ì˜µì…˜ì„ í†µí•´ `CGImage`ë¥¼ ìƒì„±í•´ì£¼ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

- `kCGImageSourceShouldCache: false`
ì´ë¯¸ì§€ ì†ŒìŠ¤ì— ëŒ€í•œ ì°¸ì¡°ê°’ë§Œì„ ìƒì„±í•˜ê³  CGImageSourceê°€ ìƒì„±ë˜ëŠ” ì¦‰ì‹œ ë””ì½”ë”©ì„ ì§„í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

- `kCGImageSourceShouldCacheImmediately: true`
ì•ì„  ì˜µì…˜ê³¼ëŠ” ë°˜ëŒ€ë¡œ ë‹¤ìš´ìƒ˜í”Œë§ ë¡œì§ì´ ì‹œì‘ë¨ê³¼ ë™ì‹œì— ë””ì½”ë”© ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

- `kCGImageSourceCreateThumbnailWithTransform: true`
ë‹¤ìš´ìƒ˜í”Œë§ëœ ì´ë¯¸ì§€ë¥¼ ì›ë³¸ ì´ë¯¸ì§€ì™€ ê°™ì€ í˜•íƒœë¥¼ ê°–ë„ë¡ í•©ë‹ˆë‹¤.

### 2. PNG í€„ë¦¬í‹° ë³´ì¡´

```swift
let data = NSMutableData()

guard let imageDestination = CGImageDestinationCreateWithData(data, UTType.jpeg.identifier as CFString, 1, nil) else { return nil }

let isPNG: Bool = {
  guard let utType = cgImage.utType else { return false }
  return (utType as String) == UTType.png.identifier
}()

let destinationProperties = [
  kCGImageDestinationLossyCompressionQuality: isPNG ? 1.0 : 0.75
] as CFDictionary

CGImageDestinationAddImage(imageDestination, cgImage, destinationProperties)
CGImageDestinationFinalize(imageDestination)

return data as Data
```

ì´ ë¶€ë¶„ì€ ì‚¬ì‹¤ ì„ íƒì ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ ë˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.

PNG í™•ì¥ìëŠ” ë³´í†µ ìŠ¤í¬ë¦°ìƒ·ê³¼ ê°™ì´ ì´ë¯¸ì§€ì˜ í’ˆì§ˆì´ ì¤‘ìš”í•œ ì´ë¯¸ì§€ë“¤ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ì´ë¯¸ì§€ì˜ í’ˆì§ˆì´ ì†ìƒëœë‹¤ë©´ ì´ë¯¸ì§€ì— í¬í•¨ëœ í…ìŠ¤íŠ¸ ë“±ì˜ ì‹œì¸ì„±, ê°€ë…ì„±ì´ ì¤‘ìš”í•œ ìš”ì†Œë“¤ì— ì˜í–¥ì´ ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

PNG í™•ì¥ìë¼ë©´ 1.0ì˜ ì†ìƒ ì—†ëŠ” ì••ì¶•ì„, ê·¸ ì™¸ì˜ í™•ì¥ìë¼ë©´ 0.75ì˜ ì••ì¶•ë¥ ë¡œ ë°ì´í„°ë¥¼ ë””ì½”ë”©í•˜ì˜€ìŠµë‹ˆë‹¤.

## PHPickerì™€ì˜ ì‚¬ìš©

ì´ì „ `PHPicker`ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

```swift
itemProvider.loadObject(ofClass: UIImage.self) { image, error in
  // do something
}
```

ì´ë²ˆ ê²Œì‹œë¬¼ì—ì„œ ì‚¬ìš©í•œ ë°©ë²•ì€ `URL` íƒ€ì…ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë°›ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```swift
itemProvider.loadFileRepresentation(forTypeIdentifier: UTType.image.identifier) { url, error in
  // do something
}
```
