---
title: 'ðŸ“± iOS - Sign in with Apple'
date: '2023-06-20'
tags: ['Swift', 'iOS']
draft: false
summary: 'ê°„íŽ¸ ë¡œê·¸ì¸ì˜ ì²« ê±¸ìŒ, ì• í”Œë¡œ ë¡œê·¸ì¸'
---

# Sign in with Apple

ì˜¤ëŠ˜ì€ ì• í”Œë¡œ ë¡œê·¸ì¸ì„ êµ¬í˜„í•´ë³¼ê²ë‹ˆë‹¤!

ë°”ë¡œ ê°€ë³¼ê¹Œìš”~

## HIG

ì• í”Œë¡œ ë¡œê·¸ì¸ì€ ì• í”Œì˜ SDKë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹ˆ ì• í”Œì´ ì œì‹œí•œ ë””ìžì¸ ê°€ì´ë“œë¥¼ ìž˜ ë”°ë¼ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. Sign in with Appleì— ëŒ€í•œ HIG ë¬¸ì„œëŠ” [ì—¬ê¸°](https://developer.apple.com/design/human-interface-guidelines/sign-in-with-apple#Creating-a-custom-Sign-in-with-Apple-button)ì— ìžˆìŠµë‹ˆë‹¤.

### Offering Sign in with Apple

ì• í”Œë¡œ ë¡œê·¸ì¸ì„ êµ¬í˜„í•˜ë©´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì ë“¤ì„ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤.

1. ë¡œê·¸ì¸ì„ í•¨ìœ¼ë¡œì¨ ì‚¬ìš©ìžê°€ ì´ë“ì„ ì–»ì„ ìˆ˜ ìžˆëŠ” ê²½ìš°ì—ë§Œ ì• í”Œë¡œ ë¡œê·¸ì¸ì„ ì œê³µí•  ê²ƒ
2. ë¡œê·¸ì¸ì˜ ì‹œì ì„ ë¯¸ë£° ìˆ˜ ìžˆë‹¤ë©´ ìµœëŒ€í•œ ë¯¸ë£° ê²ƒ
3. ê°€ìž…ì´ í•„ìš”í•˜ë‹¤ë©´ ê°€ìž… ì´í›„ì— SDK ë¡œê·¸ì¸ì„ ì„ íƒí•  ìˆ˜ ìžˆë„ë¡ í•  ê²ƒ
4. ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ ì• í”Œë¡œ ë¡œê·¸ì¸ì— ì—°ê²°ë  ìˆ˜ ìžˆë„ë¡ êµ¬í˜„í•  ê²ƒ
5. ì»¤ë¨¸ìŠ¤ ì•±ì¼ ê²½ìš°, ë¬¼í’ˆì„ ì‹¤ì œë¡œ êµ¬ë§¤í•˜ê¸° ì§ì „ì— ë¡œê·¸ì¸ì„ ìš”êµ¬í•  ê²ƒ
6. ì• í”Œë¡œ ë¡œê·¸ì¸ì´ ì„±ê³µí•¨ê³¼ ë™ì‹œì— ì‚¬ìš©ìžê°€ ê³„ì •ì„ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” í™”ë©´ìœ¼ë¡œ ë°˜ê²¨ì¤„ ê²ƒ
7. ì• í”Œë¡œ ë¡œê·¸ì¸ë˜ì–´ ìžˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•ˆë‚´í•  ê²ƒ

ì¤‘ìš”í•œ ì ì€ ì‚¬ìš©ìžë“¤ì´ ê°€ìž…ì„ í•˜ëŠ” ê²ƒì„ ì›í•˜ì§€ëŠ” ì•Šìœ¼ë‹ˆ, **ê°€ìž…ì´ í•„ìš”í•œ ì´ìœ ë¥¼ ì„¤ëª…** í•˜ê³  **ì‘ë‹¹í•˜ëŠ” ê°€ì¹˜ë¥¼ ì œê³µ** í•´ì•¼ í•œë‹¤. ë¡œê·¸ì¸ ì‹œì ì€ **ìµœëŒ€í•œ ëŠ¦ì¶”ëŠ” ê²ƒ** ì´ ì¢‹ê³  ì´ì „/ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ **ì‚¬ìš©í•˜ë˜ ê³„ì •ê³¼ì˜ ì—°ë™** ì´ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤.

### Collecting Data

ì• í”Œë¡œ ë¡œê·¸ì¸ì„ ì´ìš©í•˜ë©´ ì‚¬ìš©ìžì˜ ì´ë¦„ê³¼ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì œê³µë°›ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ê²½ìš°ì— ë”°ë¼ ì¶”ê°€ì ì¸ ì •ë³´ê°€ í•„ìš”í•  ë•Œê°€ ìžˆê² ì£ . (ìƒì¼ì´ë‚˜ ê±°ì£¼ì§€ ê°™ì€)
ì´ëŸ´ ë•Œë¥¼ ìœ„í•œ ê°€ì´ë“œë¼ì¸ë„ ì œê³µí•˜ê³  ìžˆìŠµë‹ˆë‹¤.

1. ë¶€ê°€ ì œê³µ ì •ë³´ê°€ í•„ìˆ˜ì ì¸ì§€, ê¶Œìž¥ì¸ì§€ë¥¼ ëª…í™•í•˜ê²Œ ì „ë‹¬í•  ê²ƒ
2. ì‚¬ìš©ìžê°€ ì§ì ‘ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìž…ë ¥í•˜ê²Œ í•˜ì§€ ë§ ê²ƒ
3. ì‚¬ìš©ìžê°€ ì´ë©”ì¼ ê°€ë¦¬ê¸° ì˜µì…˜ì„ ì œê³µí•  ê²½ìš°, ì‹¤ì œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ìš”êµ¬í•˜ì§€ ë§ ê²ƒ
4. ë¶€ê°€ì ì¸ ì •ë³´ë¥¼ ìš”êµ¬í•˜ê¸° ì „ì— ì•±ì„ ì‚¬ìš©í•´ ë³¼ ìˆ˜ ìžˆë„ë¡ í•  ê²ƒ
5. ë°ì´í„° ìˆ˜ì§‘ì— ëŒ€í•´ íˆ¬ëª…í•  ê²ƒ

ì‚¬ì‹¤ ëŒ€ë¶€ë¶„ ë„ì˜ì ìœ¼ë¡œ ì•Œê³  ìžˆëŠ” ë¶€ë¶„ë“¤ì´ì£ ?
4ë²ˆì˜ ê²½ìš°ê°€ ëˆˆì— ë„ëŠ”ë°, â€œì¼ë‹¨ ë‘˜ëŸ¬ë³´ê¸°â€ ì˜µì…˜ì´ ìƒìš© ì•±ì— ì ì  ë§Žì•„ì§€ëŠ” ì´ìœ ê°€ ì•„ë‹ê¹Œ ì‹¶ìŠµë‹ˆë‹¤.

### Displaying Buttons

ìž ì´ì œ ì‹¤ì œë¡œ ì–´ë–¤ ë””ìžì¸ì„ ìš”êµ¬í•˜ëŠ” ì§€ ì‚´íŽ´ë³¼ê¹Œìš”..

ì• í”Œë¡œ ë¡œê·¸ì¸ì€ ì• í”Œì´ ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê°€ìž¥ ì‰½ê³  ì¢‹ì€ ë°©ë²•ìž…ë‹ˆë‹¤.

![](https://i.imgur.com/XLjgmuj.png)

ì´ ëª¨ì–‘ì˜ ë²„íŠ¼ ì—¬ê¸°ì €ê¸°ì„œ ë§Žì´ ë³´ì…¨ìž–ì•„ìš”? ðŸ˜‹
í•˜ì§€ë§Œ ì•±ì˜ ê¸°íšì´ë‚˜ ë””ìžì¸ì— ë”°ë¼ ë‹¤ë¥¸ í˜•íƒœë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œë„ ìžˆê² ì£ ?
ì• í”Œì´ ì œê³µí•˜ëŠ” ê°€ì´ë“œë¼ì¸ë§Œ ë”°ë¥¸ë‹¤ë©´, ì»¤ìŠ¤í…€ìœ¼ë¡œ ì œìž‘í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

1. ë‹¤ë¥¸ ë¡œê·¸ì¸ ì˜µì…˜ë“¤ê³¼ ë™ì¼í•œ ì‚¬ì´ì¦ˆë¥¼ ê°€ì§ˆ ê²ƒ
2. ë¡œê·¸ì¸ ë²„íŠ¼ì„ ì°¾ê¸°ìœ„í•´ ìœ ì €ê°€ ìŠ¤í¬ë¡¤í•  ì¼ì´ ì—†ì„ ê²ƒ

ì´ ë‘ê°€ì§€ í•µì‹¬ ê°€ì´ë“œë¼ì¸ì„ ìƒê°í•˜ë©° ì„¸ë¶€ ë‚´ìš©ë“¤ì„ ì‚´íŽ´ë´…ì‹œë‹¤.

ì»¤ìŠ¤í…€ ì• í”Œë¡œ ë¡œê·¸ì¸ ë²„íŠ¼ì—ì„œ ê°€ìž¥ ì¤‘ìš”í•œ ì ì€ ë‹¹ì—°í•˜ê²Œë„ **í•´ë‹¹ ë²„íŠ¼ì´ â€œì• í”Œë¡œ ë¡œê·¸ì¸â€ ê¸°ëŠ¥ì„ í•œë‹¤ëŠ” ê²ƒì„ ëª…ì‹œ** í•´ì£¼ëŠ” ê²ƒìž…ë‹ˆë‹¤.
ì• í”Œì´ ì œê³µí•˜ëŠ” ë²„íŠ¼ê³¼ ê°™ì´ â€œì• í”Œë¡œ ë¡œê·¸ì¸â€ íƒ€ì´í¬ì™€ ë¡œê³ ë¥¼ í•¨ê»˜ ë„£ê±°ë‚˜, ì• í”Œ ë¡œê³  ë‹¨ì¼ì˜ ë²„íŠ¼ì„ ë„£ëŠ” ì‹ìœ¼ë¡œ ë§ì´ì£ .
ì°¸ê³ ë¡œ ì• í”Œì´ ì œê³µí•˜ëŠ” ë””ìžì¸ ë¦¬ì†ŒìŠ¤(ì• í”Œ ë¡œê³ ì™€ ê°™ì€)ë“¤ì€ [ì—¬ê¸°](https://developer.apple.com/design/resources/)ì„œ ì–»ì„ ìˆ˜ ìžˆë‹µë‹ˆë‹¤.

ì• í”Œ ë¡œê³ ë¥¼ ì‚¬ìš©í•˜ëŠ” ë§Œí¼ ê°€ì´ë“œë¼ì¸ë„ êµ‰ìž¥ížˆ ë§ŽìŠµë‹ˆë‹¤..
ë¸Œëžœë“œê°€ ì§ì ‘ì ìœ¼ë¡œ ë…¸ì¶œë˜ëŠ” ë²„íŠ¼ì¸ë§Œí¼ ë¸Œëžœë“œì— ëŒ€í•œ í†µì¼ì„±ì„ ì§€í‚¤ê¸° ìœ„í•´ì„œê² ì£ ?
ì°¬ì°¬ížˆ ì½ì–´ë³´ë©´ì„œ ê·¸ë ‡êµ¬ë‚˜~ ì •ë„ë¡œ ë´ë„ ê´œì°®ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

![](https://i.imgur.com/yCbe7Li.png)

- **ë¡œê³ **

1. ë¡œê³  ìžì²´ë¥¼ ë²„íŠ¼ìœ¼ë¡œ ì“°ì§€ë§ê³ , ë²„íŠ¼ ì•ˆì— ë¡œê³ ê°€ í¬í•¨ë˜ëŠ” í˜•íƒœë¡œ êµ¬ì„±í•  ê²ƒ
2. ë²„íŠ¼ì˜ ë†’ì´ì™€ ë¡œê³ ì˜ ë†’ì´ë¥¼ ë™ì¼í•˜ê²Œ ì„¤ì •í•  ê²ƒ
3. ë¡œê³  íŒŒì¼ì„ ìž˜ë¼ì„œ ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ
4. ìƒí•˜ë‹¨ì— íŒ¨ë”©ì„ ì¶”ê°€í•˜ì§€ ë§ ê²ƒ

- **ë²„íŠ¼ ì†ì„±**

1. ë²„íŠ¼ íƒ€ì´í‹€ì€ â€œSign in with Appleâ€, â€œSign up with Appleâ€, â€œContinue with Appleâ€ë§Œ ì‚¬ìš©í•  ê²ƒ
2. ë¡œê³ ì™€ í…ìŠ¤íŠ¸ê°€ í¬í•¨ëœ ë²„íŠ¼ì€ í•­ìƒ ì‚¬ê°í˜•ì˜ í˜•íƒœë¥¼ ìœ ì§€í•˜ê³ , ë¡œê³ ë§Œ ìžˆëŠ” ë²„íŠ¼ì€ ì‚¬ê°í˜•ì´ë‚˜ ì›í˜•ì¼ ê²ƒ
3. ë¡œê³ ì™€ íƒ€ì´í‹€ ìƒ‰ìƒì€ ê²€ì • í˜¹ì€ í°ìƒ‰ì¼ ê²ƒ (ì»¤ìŠ¤í…€ ì»¬ëŸ¬ ì‚¬ìš© ê¸ˆì§€)
4. íƒ€ì´í‹€ í°íŠ¸ëŠ” ë³€ê²½ì´ ê°€ëŠ¥ (weightì™€ size í¬í•¨)
5. ëŒ€ë¬¸ìž ìžìœ¨ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥ (ëª¨ë“  ê¸€ìžë¥¼ ëŒ€ë¬¸ìžë¡œ í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥)
6. ë°°ê²½ í˜•íƒœ(ì§ˆê°, ê·¸ëž˜ë””ì–¸íŠ¸)ëŠ” ì•±ì— ë§žê²Œ ë³€í˜• ê°€ëŠ¥ (ë‹¨ í°ìƒ‰, ê²€ì • ìƒ‰ìƒì€ ìœ ì§€í•  ê²ƒ)
7. Corner RadiusëŠ” ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì— ë§žê²Œ ë³€ê²½ ê°€ëŠ¥
8. í…Œë‘ë¦¬ì™€ ê·¸ë¦¼ìžë„ ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì— ë§žê²Œ ë³€ê²½ ê°€ëŠ¥

## Implementing Sign in with Apple

ìž ì´ì œ ë””ìžì¸ì ìœ¼ë¡œ ê³ ë ¤í•´ì•¼í•  ì ë“¤ì€ ì•Œì•˜ìœ¼ë‹ˆ ì‹¤ì œë¡œ ì•±ì— ì ìš©í•´ë´…ì‹œë‹¤.

### Capability ì¶”ê°€

![](https://i.imgur.com/RUeUptV.png)

ì•± í™˜ê²½ ì„¤ì •ì˜ Signing & Capabilities íƒ­ì—ì„œ **â€œ+ Capabilityâ€** ë²„íŠ¼ì„ í†µí•´ Sign in with Appleì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.
ê·¸ë¦¬ê³  Apple Developerì˜ [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list)ì—ì„œ ì• í”Œë¡œ ë¡œê·¸ì¸ì„ ì¶”ê°€í•´ì¤„ ì•±ì˜ Identifierì— ì°¾ì•„ë“¤ì–´ê°‘ì‹œë‹¤.

![](https://i.imgur.com/ZORGuC3.png')

ê·¸ë¦¬ê³  ì´ë ‡ê²Œ í”„ë¡œì íŠ¸ ì„¤ì •ê³¼ ë™ì¼í•˜ê²Œ **â€œSign in with Appleâ€** Capabilityë¥¼ ì¼œì¤ë‹ˆë‹¤.

![](https://i.imgur.com/QMrOBgC.png)

í™˜ê²½ ì„¤ì •ì€ ë³´í†µ ì—¬ê¸°ì„œ ëë‚˜ì§€ë§Œ..
ì €ì˜ ê²½ìš°ì—ëŠ” ê¹ƒí—ˆë¸Œ ì•¡ì…˜ì„ ì‚¬ìš©í•˜ê³  ìžˆì–´ì„œ í”„ë¡œë¹„ì €ë‹ì„ ìžë™ìœ¼ë¡œ ê´€ë¦¬í•´ì£¼ëŠ” ì˜µì…˜ì„ êº¼ë‘ì—ˆê¸° ë•Œë¬¸ì— ì§ì ‘ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

App IDì— Capabilityë¥¼ ì¼œì¤€ ë’¤ì— Profiles íƒ­ì—ì„œ ì—…ë°ì´íŠ¸ëœ í”„ë¡œë¹„ì „ íŒŒì¼ì„ ë‹¤ìš´ë°›ì•„ì¤ë‹ˆë‹¤.

![](https://i.imgur.com/EmWVN5a.png)

![](https://i.imgur.com/8vbD8aq.png)

ë‹¤ìš´ë¡œë“œí•œ í”„ë¡œë¹„ì „ íŒŒì¼ì„ importí•˜ê³  ì •ìƒì ìœ¼ë¡œ ì ìš©ì´ ëë‹¤ë©´..! ë¡œì»¬ì—ì„œëŠ” ì„¸íŒ…ì´ ëë‚œê²ë‹ˆë‹¤.
ì €ì™€ ê°™ì´ ê¹ƒí—ˆë¸Œ ì•¡ì…˜ì— í”„ë¡œë¹„ì „ì„ ë“±ë¡í•´ë‘ì‹  ë¶„ë“¤ì€ ì•”í˜¸í™” & ì—…ë¡œë“œë„ ë‹¤ì‹œ í•´ì•¼í•œë‹¤ëŠ” ê²ƒì„ ìžŠì§€ ë§ì•„ì£¼ì„¸ìš”!

### Add a Sign in with Apple Button

ìž ì´ì œ ì§„ì§œ ì§„ì§œ êµ¬í˜„ì— ë“¤ì–´ê°‘ì‹œë‹¤.

ìš°ì„  í•„ìš”í•œ í”„ë ˆìž„ì›Œí¬ë¥¼ `import` í•´ì¤ë‹ˆë‹¤.

```swift
import AuthenticationServices
```

ì• í”Œë¡œ ë¡œê·¸ì¸ì„ íŠ¸ë¦¬ê±°í•´ì¤„ ë²„íŠ¼ë¶€í„° ë§Œë“¤ì–´ì•¼ê² ì£ ?
ì• í”Œì´ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´, [ASAuthorizationAppleIDButton](https://developer.apple.com/documentation/authenticationservices/asauthorizationappleidbutton)ì„ ì‚¬ìš©í•´ì¤ì‹œë‹¤.

```swift
func setupProviderLoginView() {
  let authorizationButton = ASAuthorizationAppleIDButton()
  authorizationButton.addTarget(self, action: #selector(handleAuthorizationAppleIDButtonPress), for: .touchUpInside)
  self.loginProviderStackView.addArrangedSubview(authorizationButton)
}
```

![](https://i.imgur.com/wBXNcN8.png)

ì €ëŠ” ë””ìžì´ë„ˆë‹˜ì´ ë§Œë“¤ì–´ì£¼ì‹  ì´ ì»¤ìŠ¤í…€ ë²„íŠ¼ì„ ì‚¬ìš©í•´ë³¼ê²Œìš”!
`#selector` ì— ë“¤ì–´ê°€ëŠ” ë©”ì„œë“œì˜ ê¸°ëŠ¥ë§Œ ë™ì¼í•˜ë©´ ë˜ë‹ˆ ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ë‚˜ ì»¤ìŠ¤í…€ ë²„íŠ¼ì´ë‚˜ ë™ì¼í•˜ê²Œ ì§„í–‰í•´ì¤ì‹œë‹¤.

### Request Authorization with Apple ID

ì´ì œ ë²„íŠ¼ì˜ ì•¡ì…˜ì— í•´ë‹¹ë˜ëŠ” `handleAuthorizationiAppleIDButtonPress()` ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ë´…ì‹œë‹¤.

```swift
func handleSignInWithApple() {
  let provider = ASAuthorizationAppleIDProvider()
  let request = provider.createRequest()
  request.requestedScopes = [.fullName, .email]

  let authorizationController = ASAuthorizationController(authorizationRequests: [request])
  authorizationController.delegate = self
  authorizationController.presentationContextProvider = self
  authorizationController.performRequests()
}
```

ì¼ë‹¨ `Provider` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ì£¼ê³ , ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ ë³´ë‚´ì•¼ í•˜ê¸° ë•Œë¬¸ì— `createRequest()` ì™€ ìš”êµ¬í•˜ëŠ” Scopeë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

```swift
extension ASAuthorization.Scope {
  @available(iOS 13.0, *)
  public static let fullName: ASAuthorization.Scope

  @available(iOS 13.0, *)
  public static let email: ASAuthorization.Scope
}
```

ì‚¬ì‹¤ Scopeë¼ê³  í•´ë´ì•¼ ë‘ ê°œê°€ ì „ë¶€ìž…ë‹ˆë‹¤. ðŸ˜…
ì €í¬ëŠ” ì´ë©”ì¼ê³¼ ì´ë¦„ ë‘˜ ë‹¤ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ë‘ ê°œ ëª¨ë‘ ìš”êµ¬ Scopeì— ì¶”ê°€í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

`request` ì„¸íŒ…ì´ ëë‚¬ë‹¤ë©´, `ASAuthorizationController` ì¸ìŠ¤í„´ìŠ¤ì˜ `delegate` ì™€ `presentationContextProvider` ì˜ ìœ„ìž„ìžë¥¼ ì„¤ì •í•´ì£¼ê³  `performRequests` ë¡œ ì‹¤ì œ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ ë³´ë‚´ì¤ë‹ˆë‹¤.

> ASAuthorizationControllerDelegate ì±„íƒ ê´€ë ¨ íŠ¸ëŸ¬ë¸”!

ìž.. ê·¸ëŸ°ë° ìœ„ìž„ìžë¥¼ ì„¤ì •í•´ì¤„ ë•Œ ë¶„ëª… ì• í”Œì´

![](https://i.imgur.com/TTPVlQF.png)

ì´ ë‘ ê°€ì§€ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ì£¼ì–´ì•¼ í•œë‹¤ê³  í–ˆê±°ë“ ìš”..?

![](https://i.imgur.com/3gBI9Ob.png)

ì €ëŠ” ê·¼ë° ì™œ ì´ëŸ° ì• ë“¤ì´ ë‚˜ì˜¬ê¹Œìš”â€¦

ì¡°ê¸ˆ ì°¾ì•„ë³´ë‹ˆ ì´ ì¹œêµ¬ë“¤ì€ `NSObjectProtocol` ì´ë¼ëŠ” í”„ë¡œí† ì½œì— í•„ìš”í•œ ìš”ì†Œë“¤ì´ì˜€ìŠµë‹ˆë‹¤.

```swift
@available(iOS 13.0, *)
public protocol ASAuthorizationControllerDelegate : NSObjectProtocol {
  optional func authorizationController(controller: ASAuthorizationController, didCompleteWithAuthorization authorization: ASAuthorization)

  optional func authorizationController(controller: ASAuthorizationController, didCompleteWithError error: Error)
}
```

`ASAuthorizationControllerDelegate` ê°€ `NSObjectProtocol` ì„ ì±„íƒí•˜ê³  ìžˆê±°ë“ ìš”.

![](https://i.imgur.com/UiXXeZc.png)

ê³µì‹ ë¬¸ì„œì—ì„œ Obj-C ì˜¤ë¸Œì íŠ¸ë“¤ì— ëª¨ë‘ í•„ìš”í•œ í”„ë¡œí† ì½œì´ë¼ê³  í•©ë‹ˆë‹¤.
ê·¸ëž˜ì„œ ë¬¸ì œëŠ”.. ì €ëŠ” `Reactor` ë¼ëŠ” ì»¤ìŠ¤í…€ ë ˆì´ì–´ ìœ„ì—ì„œ ìž‘ì—…í•˜ê³  ìžˆì—ˆë‹¤ëŠ” ê²ƒì´ì£ .. `Reactor` ëŠ” `NSObjectProtocol` ì„ ì±„íƒí•˜ê³  ìžˆì§€ ì•Šê±°ë“ ìš”..! ðŸ˜ 
ê·¸ëž˜ì„œ ì´ ë¡œì§ì„ ì–´ë””ì„œ êµ¬í˜„í•´ì¤˜ì•¼ í•˜ëŠëƒ..?
ì–´ë””ê² ì–´ìš” ë·°ì»¨íŠ¸ë¡¤ëŸ¬ì£ ..
`UIViewController` ëŠ” `NSObject` ì˜ ì„œë¸Œí´ëž˜ìŠ¤ì´ê³ , NS`Object ê°€ `NSObjectProtocol` ì„ ì±„íƒí•˜ê³  ìžˆìŠµë‹ˆë‹¤..

ê¹¨ì•Œê°™ì´ `didCompleteWithAuthorization` ê³¼ `didCompleteWithError` ë©”ì„œë“œëŠ” `optional` ì´ì˜€ë„¤ìš”..
ê·¸ëž˜ì„œ XCodeê°€ ì œì•ˆí•˜ëŠ” í”„ë¡œí† ì½œ ì¶©ì¡± ê¸°ëŠ¥ìœ¼ë¡œëŠ” ì¶”ê°€ê°€ ì•ˆëë˜ ê²ƒìž…ë‹ˆë‹¤..! ðŸ˜…

```swift
extension AuthSignInViewController: ASAuthorizationControllerDelegate, ASAuthorizationControllerPresentationContextProviding {
  public func presentationAnchor(for controller: ASAuthorizationController) -> ASPresentationAnchor {
    return self.view.window!
  }

  func handleSigninWithApple() {
    let provider = ASAuthorizationAppleIDProvider()
    let request = provider.createRequest()
    request.requestedScopes = [.fullName, .email]

    let authorizationController = ASAuthorizationController(authorizationRequests: [request])
    authorizationController.delegate = self
    authorizationController.presentationContextProvider = self
    authorizationController.performRequests()
  }
}
```

ê·¸ëž˜ì„œ ì´ë ‡ê²Œ ë·°ì»¨ìœ¼ë¡œ ë¡œì§ë“¤ì„ ì˜®ê²¨ì£¼ê³  ì´ì–´ì„œ ìž‘ì—…í•´ë³´ê² ìŠµë‹ˆë‹¤.

ë¨¼ì € í•„ìˆ˜ì ìœ¼ë¡œ ì¶©ì¡±í•´ì•¼í•˜ëŠ” `ASAuthorizationControllerPresentationContextProviding` í”„ë¡œí† ì½œì˜ `presentationAnchor` ë©”ì„œë“œë¶€í„° êµ¬í˜„í•´ì¤ë‹ˆë‹¤.

ì• í”Œë¡œ ë¡œê·¸ì¸ì´ ìˆ˜í–‰ë˜ê¸° ìœ„í•œ `UIWindow` ë¥¼ ë°›ê¸° ìœ„í•œ ê°„ë‹¨í•œ ë©”ì„œë“œë¼ì„œ í˜„ìž¬ ë·°ì»¨ì˜ ìœˆë„ìš°ë¥¼ ì œê³µí•´ì£¼ëŠ” ê²ƒìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•´ì¤ì‹œë‹¤.

ì—¬ê¸°ê¹Œì§€ ëë‹¤ë©´ ì• í”Œë¡œ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ, ì• í”Œë¡œ ë¡œê·¸ì¸ í™”ë©´ì´ ë‚˜ì™€ì•¼í•©ë‹ˆë‹¤.

ê³¼ì—°â€¦!

![](https://i.imgur.com/vidw9xn.gif)

ì•—.. ðŸ«£
ì• í”Œ ë¡œê·¸ì¸ í•´ì£¼ê³ ìš”.. ë‹¤ì‹œ..

![](https://i.imgur.com/e4kcbE5.gif)

ì˜¤..! ëì–´ìš” ëì–´ìš” ðŸŽ‰

### Handle User Credentials

ì´ì œ ì‚¬ìš©ìžê°€ ë¡œê·¸ì¸ì„ í–ˆì„ ë•Œ ì‹¤ì œë¡œ ë°›ê²Œ ë˜ëŠ” ê°’ì„ ì•±ì—ì„œ ì²˜ë¦¬í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

ë¡œê·¸ì¸ì´ ì„±ê³µí–ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” `didCompleteWithAuthroization` delegate í•¨ìˆ˜ë¶€í„° êµ¬í˜„í•´ì¤ì‹œë‹¤.
ì´ í•¨ìˆ˜ì—ì„œëŠ” ì œê³µë˜ëŠ” `userIdentifier`, `fullName`, `email` ì˜ ê°’ì„ ì‚¬ìš©í•´ **ì•±ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê³„ì •** ì„ ë“±ë¡í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
ì‰½ê²Œ ë§í•´ì„œ ì œê³µë˜ëŠ” ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ íšŒì›ê°€ìž… ì ˆì°¨ë¥¼ í†µê³¼ì‹œì¼œì£¼ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ì£ .

ì• í”Œì´ ì œê³µí•˜ëŠ” ì˜ˆì‹œì—ì„œëŠ” `AppleIDCredential` ê³¼ `ASPasswordCredential` ì˜ ë‘ ê°€ì§€ ë°©ë²•ì„ ì œì‹œí•˜ê³  ìžˆìŠµë‹ˆë‹¤.
ì—¬ê¸°ì„œ `ASPasswordCredential` ì€ iCloudì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ì—°ë™í•  ë•Œ ì‚¬ìš©ë˜ëŠ” Credentialì´ê¸° ë•Œë¬¸ì— ì œì™¸í•˜ê³  ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

```swift
public func authorizationController(
  controller: ASAuthorizationController,
  didCompleteWithAuthorization authorization: ASAuthorization
) {
  guard let appleIDCredential = authorization.credential as? ASAuthorizationAppleIDCredential else { return }

  let userIdentifier = appleIDCredential.user
  let fullName = appleIDCredential.fullName
  let email = appleIDCredential.email

  // Handle Sign Up Task
  
}
```

ìž ì´ë ‡ê²Œ `AppleIDCredential`ì„ ì´ìš©í•´ì„œ ì‚¬ìš©ìžì— ëŒ€í•œ ì •ë³´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
ì´ ë°ì´í„°ë“¤ì„ ì–´ë–»ê²Œ ì‚¬ìš©í•´ì„œ íšŒì›ê°€ìž…ì„ ì‹œí‚¬ ì§€.. ëŠ” ì•±ê³¼ ì„œë²„ì˜ í™˜ê²½ë§ˆë‹¤ ë‹¤ë¥´ê² ì£ ..?

ì• í”Œ ë¡œê·¸ì¸ì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ì—ëŠ” `didCompleteWithError` í•¨ìˆ˜ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.

```swift
public func authorizationController(
  controller: ASAuthorizationController,
  didCompleteWithError error: Error
) {
  // Handle Error
  print(error)
}
```

### Request Existing Credentials

ìœ„ì˜ ê²½ìš°ëŠ” ì• í”Œ ë¡œê·¸ì¸ì„ ì´ìš©í•´ â€œì²˜ìŒâ€ ê°€ìž…í•  ë•Œì˜ ê²½ìš°ì˜€ìŠµë‹ˆë‹¤.
ê·¸ëŸ°ë° ë¡œê·¸ì•„ì›ƒì´ë‚˜ ì•±ì„ ì‚­ì œ í•œ ë’¤ ë‹¤ì‹œ ì„¤ì¹˜í•´ì„œ ë¡œê·¸ì¸ì„ í•  ë•ŒëŠ”ìš”?
ì´ì „ì˜ ê³„ì • ì •ë³´ë“¤ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìžˆì–´ì•¼ê² ì£ !

ê·¸ëŸ´ ë•ŒëŠ” í•œ ë²ˆ ê°€ìž…í–ˆë˜ ì• í”Œ ë¡œê·¸ì¸ì— ë‹¤ì‹œ í•œ ë²ˆ ë¡œê·¸ì¸í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.

ê·¼ë°ìš”.. ì‚¬ì‹¤ ì´ì „ì— êµ¬í˜„í–ˆë˜ `handleSignInWithApple()` í•¨ìˆ˜ì™€ ìƒë‹¹ížˆ ìœ ì‚¬í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

```swift
func handleSignInWithApple() {
  let provider = ASAuthorizationAppleIDProvider()
  let request = provider.createRequest()

  let authorizationController = ASAuthorizationController(authorizationRequests: [request])
  authorizationController.delegate = self
  authorizationController.presentationContextProvider = self
  authorizationController.performRequests()
}
```

### Check User Credentials at Launch

ì´ì œ ì• í”Œ ë¡œê·¸ì¸ì„ ë‹¤ êµ¬í˜„í–ˆìœ¼ë‹ˆ ìžë™ ë¡œê·¸ì¸ë„ êµ¬í˜„í•´ë´…ì‹œë‹¤.

ì•±ì˜ ì‹œìž‘ êµ¬ê°„ì—ì„œ (ë³´í†µ AppDelegateë‚˜ SceneDelegateê² ì£ ?) `getCredentialState(forUserID:completion:)` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ì‚¬ìš©ìžì˜ ì• í”Œ ì•„ì´ë””ì™€ ì•±ì˜ ì—°ë™ ìƒí™©ì„ ì²´í¬í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

```swift:AppDelegate.swift
func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {

  let appleIDProvider = ASAuthorizationAppleIDProvider()
  appleIDProvider.getCredentialState(forUserID: KeychainItem.currentUserIdentifier) { (credentialState, error) in
    switch credentialState {
    case .authorized:
      break // The Apple ID credential is valid.
    case .revoked, .notFound:
      // The Apple ID credential is either revoked or was not found, so show the sign-in UI.
      DispatchQueue.main.async {
        self.window?.rootViewController?.showLoginViewController()
      }
    default:
      break
    }
  }
  return true
}
```

> í .. `getCredentialState` ì— ì• í”Œ ì•„ì´ë””ê°€ í•„ìš”í•˜ë„¤ìš”..?

~~ì œê°€ ì›ëž˜ `AppleIDCredential` ì¤‘ `userIdentifier` ëŠ” ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë ¤ê³  í–ˆì—ˆëŠ”ë°.. ì—¬ê¸°ì„œ í•„ìš”í•˜ë„¤ìš”..?~~
~~ê·¸ëž˜ì„œ í•´ë‹¹ ì•„ì´ë””ë¥¼ í‚¤ì²´ì¸ìœ¼ë¡œ ì €ìž¥í•´ë‘ëŠ” ë¡œì§ì´ ì¶”ê°€ì ìœ¼ë¡œ í•„ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.~~

~~í•´ë‹¹ ë‚´ìš©ê¹Œì§€ ì ìš© í›„ì— ë§ˆì € ê¸€ì„ ìž‘ì„±í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.. ðŸ¥²~~

ì €ëŠ” í‚¤ì²´ì¸ì— `userIdentifier`, `email`, `password` ë¥¼ ì €ìž¥í•˜ê³  ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë° ë¬¸ì œê°€ ìƒê²¼ì–´ìš”..!

í•´ë‹¹ ë‚´ìš©ì€ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…ìœ¼ë¡œ ë‹¤ìŒ ê²Œì‹œë¬¼ì—ì„œ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤.

> References

[Apple Developer - Implementing User Authentication with Sign in with Apple](https://developer.apple.com/documentation/sign_in_with_apple/implementing_user_authentication_with_sign_in_with_apple)

[WWDC19 - Introducing Sign in with Apple](https://developer.apple.com/wwdc19/706)
