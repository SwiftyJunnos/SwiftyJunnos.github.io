---
title: 'ğŸ“± iOS - CollectionViewì˜ Cell/Viewì—ì„œì˜ subscribe ë¬¸ì œ'
date: '2023-04-11'
tags: ['Swift', 'iOS']
draft: false
summary: 'ë²„ê·¸ëŠ” ì‚¬ì†Œí•œ ì‹¤ìˆ˜ì—ì„œ ìƒê¸´ë‹¤.'
---

# â“ CollectionViewì˜ HeaderViewë¥¼ êµ¬ë…í•˜ëŠ” ê³¼ì •ì—ì„œ ë¬¸ì œ ë°œìƒ

`HeaderView`ì˜ ë²„íŠ¼ì„ `tap`í•˜ë©´ ë°”ì¸ë”©ëœ `Action`ì´ ì—¬ëŸ¬ë²ˆ ë°œìƒí•˜ëŠ” ë¬¸ì œ ë°œìƒ

![](https://i.imgur.com/weOyyG5.gif)

```swift
configureSupplementaryView: { dataSource, collectionView, kind, indexPath in
  let sectionItem = dataSource[indexPath.section]
  let header = collectionView.dequeueReusableSupplementaryView(
    ofKind: kind,
    for: indexPath) as HeaderView
  header.reactor = HeaderViewReactor(section: sectionItem.model)
  header.rx.rightButtonDidTap
    .map { Reactor.Action.rightButtonDidTap(sectionItem.model) }
    .bind(to: self.reactor!.action)
    .disposed(by: self.disposeBag)
  return header
}
```

í•´ë‹¹ `HeaderView`ëŠ” ìœ„ì™€ ê°™ì´ í• ë‹¹ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

## ì˜ì‹¬ 1.`DashboardFlow`ì˜ ë³µì œ?

í•´ë‹¹ ë¬¸ì œê°€ ë°œìƒí•œ ì‹œì ì´ `DashboardFlow`ë¥¼ ê±´ë“œë¦´ ë•Œì˜€ê³ , í™•ì‹ ì„ ê°–ì§€ ëª»í•œ ìƒíƒœì—ì„œ ì‘ì—…ì„ í•˜ê³  ìˆì—ˆê¸° ë•Œë¬¸ì— ìš°ì„ ì ìœ¼ë¡œ ì˜ì‹¬í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‹¤ì œë¡œ ë‹¤ë¥¸ `Flow`ë¡œ ì´ë™ í›„ì— ë‹¤ì‹œ ëŒì•„ì™€ ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë©´ íšŸìˆ˜ê°€ ì¦ê°€í•˜ëŠ” í˜„ìƒì„ ë°œê²¬í•˜ì˜€ê¸°ì— ì˜ì‹¬ì„ í‚¤ì›Œê°€ê³  ìˆì—ˆì§€ë§Œâ€¦

![](https://i.imgur.com/J3ZXoPW.png)

ë©”ëª¨ë¦¬ ìŠ¤ëƒ…ìƒ·ì„ ì‚´í´ë³¸ ê²°ê³¼ `DashboardFlow`ëŠ” ë‹¨ í•œ ê°œë§Œ ìƒì„±ë˜ì–´ìˆë‹¤..

ì¶”ê°€ì ìœ¼ë¡œ ì˜ì‹¬ë˜ë˜ ë¶€ë¶„ì¸ `.contribute(withNext: self.rootViewController)` ë¶€ë¶„ì„ ì£¼ì„ì²˜ë¦¬í•˜ê³  ì•±ì„ ì‹¤í–‰í•´ë„ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ ë³´ì•„ ì´ ë¶€ë¶„ì€ ë¬¸ì œê°€ ì•„ë‹Œ ê²ƒìœ¼ë¡œ ë³´ì„..!

## ì˜ì‹¬ 2. ëª¨ë“  `HeaderView`ì˜ `Action`ì´ íŠ¸ë¦¬ê±°ë˜ì—ˆë‹¤..?

`HomeViewReactor`ì˜ í•´ë‹¹ `Action`ì„ ë°›ëŠ” ë¶€ë¶„ì—ì„œ ë¡œê¹…ì„ í•´ë³´ì•˜ë‹¤.

```swift
case .rightButtonDidTap(let sectionType):
  let type = "\(sectionType)"
  os_log(.debug, "\(type)")
  switch sectionType {
  case .upcoming:
    self.steps.accept(AppStep.reminderIsRequired)
  case .timeline:
    self.steps.accept(AppStep.filterIsRequired(self.currentSortType.value))
  }
  return .empty()
}
```

![](https://i.imgur.com/4wPULeh.png)

ê·¸ë¬ë”ë‹ˆ ë‘ ê°œì˜ ì„¹ì…˜(`timeline`, `upcoming`)ì—ì„œ ê° ë‘ ë²ˆì”© ë¡œê¹…ì´ ë˜ê³  ìˆëŠ” ê²ƒì„ ë°œê²¬í•˜ì˜€ë‹¤.

ì•„ë‹ˆ ê·¸ëŸ°ë°.. 

```swift
configureSupplementaryView: { dataSource, collectionView, kind, indexPath in
  let sectionItem = dataSource[indexPath.section]
  let header = collectionView.dequeueReusableSupplementaryView(
    ofKind: kind,
    for: indexPath) as HeaderView
  header.reactor = HeaderViewReactor(section: sectionItem.model)
  header.rx.rightButtonDidTap
    .map { Reactor.Action.rightButtonDidTap(sectionItem.model) }
    .bind(to: self.reactor!.action)
    .disposed(by: self.disposeBag)
  return header
}
```

`drive`ë¡œ êµ¬ë…í•˜ê³  ìˆëŠ” ê²ƒë„ ì•„ë‹ˆê³  `bind`ë¡œ êµ¬ë…í•˜ê³  ìˆì–´ì„œ ìŠ¤íŠ¸ë¦¼ì´ ê³µìœ ë˜ëŠ” ê²ƒë„ ì•„ë‹Œë° ì™œ ëª¨ë“  í—¤ë”ì—ì„œ `Action`ì´ íŠ¸ë¦¬ê±° ë˜ëŠ”ê±°ì§€..?

# â— ì‹¤ë§ˆë¦¬ ë°œê²¬

![](https://i.imgur.com/idEfexs.png)

ê·¸ëŸ¬ë˜ ì¤‘ í—¬í”„ë¥¼ ìš”ì²­í•œ íŒ€ì›ì—ê²Œ ë°›ì€ ëŒ“ê¸€â€¦!

ì• ì´ˆì— êµ¬ë…ì´ ì—¬ëŸ¬ë²ˆ ë˜ê³  ìˆë‹¤ëŠ” ì œë³´â€¦!

ë°”ë¡œ í…ŒìŠ¤íŠ¸ ëŒì…..

```swift
self.collectionView.rx.didEndDisplayingSupplementaryView
  .asDriver(onErrorRecover: { _ in return .empty()})
  .drive(with: self, onNext: { _, endDisplayingView in
    print(endDisplayingView)
.disposed(by: self.disposeBag)
```

ìœ„ ì²˜ëŸ¼ `HeaderView`ê°€ í™”ë©´ì—ì„œ ì‚¬ë¼ì§ˆ ë•Œë§ˆë‹¤ ë¡œê¹…ì„ í•˜ê³  ì‹¤í–‰ì„ í•´ë³´ì•˜ë‹¤.

![](https://i.imgur.com/fkY0pV8.png)

![](https://i.imgur.com/zDwYTH9.png)

ìš°ì„  `HomeVC`ê°€ ë¡œë“œ ë˜ë©° ë‘ ë²ˆì”© ì¶œë ¥ì´ ë˜ê³ ..

![](https://i.imgur.com/GCsSh4w.gif)

![](https://i.imgur.com/tQb5MQA.gif)

> ê¸°ë³¸ 2íšŒ + `endDisplaying` 1íšŒ â†’ 3íšŒ

![](https://i.imgur.com/UvWqOgH.gif)

> ê¸°ë³¸ 2íšŒ + `endDisplaying` 3íšŒ â†’ 5íšŒ

`HeaderView`ë¥¼ `didEndDisplaying` ì‹œí‚¬ ë•Œë§ˆë‹¤ í•´ë‹¹ í˜„ìƒì˜ íšŸìˆ˜ê°€ ì¦ê°€í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤..

ì–´ë–»ê²Œ ì°¾ì•˜ëŒ€â€¦

ê·¸ë˜ì„œ ì›ì¸ì€ ì•Œì•˜ëŠ”ë° ì–´ë–»ê²Œ í•´ê²°í•˜ì§€..?

# í•´ê²°

![](https://i.imgur.com/OuJBUlk.png)

í˜¹ì‹œë‚˜ ì‹¶ì–´ì„œ `HeaderView` ìì²´ëŠ” ëª‡ê°œì¸ì§€ í™•ì¸í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

ì—¬ëŸ¬ë²ˆ `endDisplaying` ì‹œì¼œì¤€ ë’¤ í™•ì¸í•´ë³´ì•˜ì§€ë§Œ ì •ìƒì ìœ¼ë¡œ ë‘ ê°œë§Œ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ê°€ìˆëŠ” ìƒí™©ì´ë„¤ìš”â€¦

`View` ìì²´ëŠ” ë¬¸ì œê°€ ì—†ì§€ë§Œ `subscribe`ë§Œ ì—¬ëŸ¬ë²ˆ ë˜ê³  ìˆê³ , ê·¸ê²ƒë“¤ì´ ìœ ì§€ë˜ê³  ìˆë‹¤ëŠ” ìƒí™©ì…ë‹ˆë‹¤..

## í•´ê²° ì‹œë„ #1

ê²°êµ­ ë¬¸ì œëŠ” `HeaderView`ëŠ” ì¬ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— `didEndDisplaying` ëœ í›„ ë‹¤ì‹œ `willDisplay` ë  ë•Œë§ˆë‹¤ `configureSupplementaryView`ê°€ ì‹¤í–‰ë˜ì–´ì„œ ìƒˆë¡œìš´ êµ¬ë…ì´ ëŠ˜ì–´ë‚˜ê³  ìˆëŠ” ê²ƒì´ì˜€ìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ `didEndDisplaying`ì´ë‚˜ `willDisplay`ê°€ ë  ë•Œë§ˆë‹¤ êµ¬ë…ì„ í•´ì œí•´ì£¼ë©´ ë˜ëŠ” ê²ƒì´ ì•„ë‹Œê°€..?

```swift
self.collectionView.rx.didEndDisplayingSupplementaryView
  .asDriver(onErrorRecover: { _ in return .empty()})
  .drive(with: self, onNext: { _, endDisplayingView in
    let (view, _, _) = endDisplayingView
    guard let view = view as? HeaderView else { return }
    print(view)
    view.disposeBag = DisposeBag()
  })
  .disposed(by: self.disposeBag)
```

ê·¸ë˜ì„œ ìœ„ì™€ ê°™ì´ ê³ ì³ë³´ì•˜ë‹¤.

![](https://i.imgur.com/ED7xuHs.gif)

í•˜ì§€ë§Œ ì–´ë¦¼ë„ ì—†ì§€..

ìƒˆë¡œìš´ `DisposeBag`ìœ¼ë¡œ ê°ˆì•„ ë¼ì›Œì£¼ëŠ” ê²ƒ ë§Œìœ¼ë¡œëŠ” êµ¬ë…ì´ í•´ì œë˜ì§€ ì•Šê³  ìˆêµ°ìš”..

## í•´ê²° ì‹œë„ #2

í•´ê²° ì‹œë„ #2 ì´ê¸´ í•˜ì§€ë§Œ ë„ì¤‘ì— í•´ê²° ë°©ë²•ì„ ì°¾ì•„ë²„ë ¸ìŠµë‹ˆë‹¤.

```swift
header.rx.methodInvoked(#selector(UICollectionViewDelegate.collectionView(_:didEndDisplayingSupplementaryView:forElementOfKind:at:)))
  .subscribe(onNext: {

  })
  .disposed(by: <#T##DisposeBag#>)
```

ì—¬ê¸°ê¹Œì§€ ì‘ì„±ì„ í–ˆëŠ”ë°ìš”.. `diseposed(by:)`ë¥¼ ì‘ì„±í•˜ëŠ” ë„ì¤‘ì— ê°‘ìê¸° ì˜ë¬¸ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

ì†ì´ ê°€ëŠ”ëŒ€ë¡œ `disposed(by: self.disposeBag)`ë¥¼ ì¹˜ë˜ ì°°ë‚˜â€¦

ë¨¸ë¦¿ì† ì ì¬ì˜ì‹ì´ ì €ë¥¼ í•œ ëŒ€ ì³¤ìŠµë‹ˆë‹¤..

```swift
header.rx.rightButtonDidTap
  .map { Reactor.Action.rightButtonDidTap(sectionItem.model) }
  .subscribe(onNext: {
    self.reactor!.action.onNext($0)
  })
  .disposed(by: self.disposeBag)
```

ë‹¤ì‹œ `subscribe`ë¥¼ í•˜ë˜ ì½”ë“œë¡œ ëŒì•„ê°€ë´…ì‹œë‹¤.

ì—¬ê¸°ì„œ `self`ëŠ” `HeaderView`ê°€ ì•„ë‹ˆë¼ `HomeViewController`ì…ë‹ˆë‹¤.

`HeaderView`ì˜ êµ¬ë…ì€ `HeaderView`ì˜ `dequeueReusable`ì— ë”°ë¼ ë™ì‘í•´ì•¼í•˜ëŠ”ë° ë§ì´ì£ â€¦

ê·¸ë˜ì„œ í•´ê²° ë°©ë²•ì€ ì•„ì£¼ ê°„ë‹¨í•©ë‹ˆë‹¤.

```swift
header.rx.rightButtonDidTap
  .map { Reactor.Action.rightButtonDidTap(sectionItem.model) }
  .subscribe(onNext: {
    self.reactor!.action.onNext($0)
  })
  .disposed(by: header.disposeBag) // ğŸ‘Š ì´ ë¶€ë¶„
```

`self.dispseBag`ì„ `header.disposeBag`ìœ¼ë¡œ ë°”ê¿”ì£¼ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤..

ì˜¤ëŠ˜ë„ ë˜ í•œ ë²ˆ ìƒê°ì—†ì´ í•˜ëŠ” ì½”ë”©ì€ ìœ„í—˜í•˜ë‹¤ëŠ” ê²ƒì„ ëŠë¼ê³  ì§€ë‚˜ê°‘ë‹ˆë‹¤..

# ğŸ‰ í•´ê²°!

![](https://i.imgur.com/6LVYlKL.gif)

ì–í˜¸..!

íœ´.. ë°˜ì„±í•´ë¼ ë‚˜ ìì‹ ..
